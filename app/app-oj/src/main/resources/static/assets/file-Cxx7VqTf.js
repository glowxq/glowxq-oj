import{d as $,r as g,w as D,o as u,x as p,k as n,a as s,bK as P,j as c,z as M,t as O,m as f,u as h,b0 as T,dp as q,c as v,y,P as w,n as I,aV as k,f as r,p as R,_ as j}from"./index-DTkCE7MD.js";import{a as A,u as K}from"./upload-BtJOZC1L.js";const W={class:"note-box"},G={class:"el-upload__text"},H={class:"el-upload__tip"},J={class:"el-upload-list el-upload-list--text"},Q={class:"el-upload-list__item is-success",tabindex:"0"},X={class:"el-upload-list__item-info"},Y={class:"el-upload-list__item-name"},Z=["title"],ee=$({name:"UploadFiles",__name:"file",props:{fileList:{default:()=>[]},type:{default:"image"},tip:{default:""},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!0},limit:{default:1},fileSize:{default:5},accept:{default:""},modelValue:{},height:{default:"150px"},width:{default:"200px"},useOss:{type:Boolean,default:!1},dir:{default:"default"}},emits:["update:modelValue","update:fileList","change"],setup(C,{emit:b}){R(e=>({"55c482d0":e.width,"48fcdd5d":e.height}));const d=C,m=b,o=g([]);D(d.fileList,e=>{o.value=[...e]},{immediate:!0});const i=g(new Map),S=e=>{const t=e.size/1024/1024<d.fileSize;return t||setTimeout(()=>{k({title:"温馨提示",message:`上传文件大小不能超过 ${d.fileSize}M！`,type:"warning"})},0),t},z=()=>{k({title:"温馨提示",message:`当前最多只能上传 ${d.limit} 份文件，请移除后上传！`,type:"warning"})},V=async e=>{const t=typeof e.file.uid=="string"?e.file.uid:Date.now().toString();if(i.value.set(t,0),d.useOss)try{await A(e.file,e.file.name,d.dir,l=>{i.value.set(t,l),e.onProgress({percent:l})},l=>{i.value.delete(t),e.onSuccess(l)},l=>{i.value.delete(t),e.onError(l)})}catch(l){i.value.delete(t),e.onError(l)}else try{const{data:l}=await K({file:e.file});i.value.delete(t),e.onSuccess(l)}catch(l){i.value.delete(t),e.onError(l)}},x=(e,t)=>{e&&(t.url=e.url,t.name=e.filename,m("update:fileList",o.value),m("change",e))},_=e=>{o.value=o.value.filter(t=>t.url!==e.url||t.name!==e.name),m("update:fileList",o.value),m("change",void 0)},B=e=>{const t=document.createElement("a");t.style.display="none",t.href=e.url+"";const l=e.name;t.setAttribute("download",l),document.body.appendChild(t),t.click(),document.body.removeChild(t)};return(e,t)=>{const l=r("el-icon"),E=r("Document"),L=r("el-progress"),F=r("Close"),N=r("el-upload");return u(),p(N,{drag:e.drag,multiple:e.limit>1,limit:e.limit,"list-type":"text",accept:e.accept,class:I(["upload",e.drag?"no-border":""]),"file-list":o.value,"onUpdate:fileList":t[0]||(t[0]=a=>o.value=a),"http-request":V,"before-upload":S,"on-exceed":z,"on-success":x,"on-remove":_},{tip:n(()=>[s("div",H,[P(e.$slots,"tip",{},void 0,!0)])]),file:n(({file:a})=>[s("ul",J,[s("li",Q,[s("div",X,[s("a",Y,[c(l,{class:"el-icon el-icon--document"},{default:n(()=>[c(E)]),_:1}),s("span",{class:"el-upload-list__item-file-name",title:a.name,style:M({width:`calc(${e.width} - 80px)`})},O(a.name),13,Z)])]),a.status==="uploading"?(u(),p(L,{key:0,type:"line","stroke-width":2,percentage:a.percentage,style:{"margin-top":"0.5rem"}},null,8,["percentage"])):f("",!0),a.status==="success"?(u(),p(l,{key:1,class:"el-icon el-icon--remove",onClick:U=>_(a)},{default:n(()=>[c(F)]),_:2},1032,["onClick"])):f("",!0),a.status==="success"?(u(),p(l,{key:2,class:"el-icon el-icon--download",onClick:U=>B(a)},{default:n(()=>[c(h(T))]),_:2},1032,["onClick"])):f("",!0)])])]),default:n(()=>[s("div",W,[c(l,{class:"upload_icon"},{default:n(()=>[c(h(q))]),_:1}),s("div",G,[e.drag?(u(),v(w,{key:0},[t[1]||(t[1]=y(" 拖拽或")),t[2]||(t[2]=s("em",null,"点击上传",-1))],64)):(u(),v(w,{key:1},[y(" 点击上传 ")],64))])])]),_:3},8,["drag","multiple","limit","accept","class","file-list"])}}}),ae=j(ee,[["__scopeId","data-v-9b92cb87"]]);export{ae as U};
