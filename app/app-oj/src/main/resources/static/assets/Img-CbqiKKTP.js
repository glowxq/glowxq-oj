import{d as R,p as W,r as f,bZ as q,b as F,am as S,dG as A,dH as D,f as b,o as r,c as m,P as G,Q,a as n,j as u,k as g,u as w,a$ as Z,m as v,dI as J,T as X,x as V,bK as $,du as Y,n as x,aa as ee,aV as d,_ as le}from"./index-DTkCE7MD.js";import{a as ae,u as te}from"./upload-BtJOZC1L.js";const se={class:"upload-box"},ie={key:0,class:"upload-list"},oe=["src"],ne=["onClick"],re=["onClick"],ue={class:"upload-empty"},de={class:"el-upload__tip"},ce=R({__name:"Img",props:{imageUrl:{default:""},fileList:{default:()=>[]},fileInfo:{default:void 0},api:{},drag:{type:Boolean},disabled:{type:Boolean,default:!1},fileSize:{default:5},height:{default:"150px"},width:{default:"150px"},borderRadius:{},dir:{default:"default"},useOss:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},limit:{default:1},fixedSize:{type:Boolean,default:!1},title:{default:"上传图片"},accept:{default:"image/*"},multiple:{type:Boolean,default:!0},beforeUpload:{default:()=>!0},preView:{type:Boolean,default:!0}},emits:["update:imageUrl","update:fileList","change"],setup(z,{emit:C}){W(e=>({"751d116c":e.width,"62230fba":e.height,"0f82944c":e.borderRadius}));const a=z,I=f("id-"+q()),U=f([]),s=F({get:()=>a.fileList&&a.fileList.length>0?a.fileList:a.imageUrl?[{name:a.imageUrl.split("/").pop()||"image.jpg",url:a.imageUrl}]:U.value,set:e=>{U.value=e,c("update:fileList",e),e.length>0?c("update:imageUrl",e[0].url||""):c("update:imageUrl","")}}),y=f(!1),k=f(""),E=e=>{k.value=e,y.value=!0},i=S(A,void 0),o=S(D,void 0),_=F(()=>a.disabled||(i==null?void 0:i.disabled)),c=C,B=f(0),T=async e=>{try{if(a.useOss)await ae(e.file,e.file.name,a.dir,l=>{var t;B.value=l,(t=e.onProgress)==null||t.call(e,{percent:l})},l=>{const t={name:e.file.name,url:(l==null?void 0:l.url)||""},p=[...s.value,t];s.value=p,c("change",l),o!=null&&o.prop&&(i==null||i.validateField([o.prop])),e.onSuccess(l)},l=>{e.onError(l)});else{const{data:l}=await te({file:e.file,dirTag:a.dir}),t={name:e.file.name,url:(l==null?void 0:l.url)||""},p=[...s.value,t];s.value=p,c("change",l),o!=null&&o.prop&&(i==null||i.validateField([o.prop])),e.onSuccess(l)}}catch(l){e.onError(l)}},M=e=>{ee.confirm("确定要删除这张图片吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const l=[...s.value];l.splice(e,1),s.value=l,d({title:"温馨提示",message:"图片已删除！",type:"success"})}).catch(()=>{})},N=e=>e.type.startsWith("image/"),P=e=>{const l=N(e),t=e.size/1024/1024<a.fileSize;return l?t?a.limit>0&&s.value.length>=a.limit?(d({title:"温馨提示",message:`最多只能上传 ${a.limit} 张图片！`,type:"warning"}),!1):a.beforeUpload&&typeof a.beforeUpload=="function"?a.beforeUpload(e):!0:(d({title:"温馨提示",message:`上传图片大小不能超过 ${a.fileSize}M！`,type:"warning"}),!1):(d({title:"温馨提示",message:"上传图片只能是图片格式！",type:"warning"}),!1)},j=e=>{B.value=0,e&&d({title:"温馨提示",message:"图片上传成功！",type:"success"})},K=()=>{d({title:"温馨提示",message:"图片上传失败，请您重新上传！",type:"error"})};return(e,l)=>{const t=b("el-icon"),p=b("el-upload"),O=b("el-image-viewer");return r(),m("div",se,[s.value.length>0?(r(),m("div",ie,[(r(!0),m(G,null,Q(s.value,(h,L)=>(r(),m("div",{key:L,class:"upload-item"},[n("img",{src:h.url||"",class:"upload-image",alt:"图片预览"},null,8,oe),n("div",{class:"upload-handle",onClick:l[0]||(l[0]=X(()=>{},["stop"]))},[_.value?v("",!0):(r(),m("div",{key:0,class:"handle-icon",onClick:H=>M(L)},[u(t,null,{default:g(()=>[u(w(Z))]),_:1}),l[2]||(l[2]=n("span",null,"删除",-1))],8,ne)),n("div",{class:"handle-icon",onClick:H=>E(h.url||"")},[u(t,null,{default:g(()=>[u(w(J))]),_:1}),l[3]||(l[3]=n("span",null,"查看",-1))],8,re)])]))),128))])):v("",!0),s.value.length<e.limit||e.limit===0?(r(),V(p,{key:1,id:I.value,action:"#",class:x(["upload",_.value?"disabled":"",e.drag?"no-border":""]),multiple:e.multiple,disabled:_.value,"show-file-list":!1,"http-request":T,"before-upload":P,"on-success":j,"on-error":K,drag:e.drag,accept:e.accept},{default:g(()=>[n("div",ue,[$(e.$slots,"empty",{},()=>[u(t,null,{default:g(()=>[u(w(Y))]),_:1}),l[4]||(l[4]=n("span",null,"点击上传",-1))],!0)])]),_:3},8,["id","class","multiple","disabled","drag","accept"])):v("",!0),n("div",de,[$(e.$slots,"tip",{},void 0,!0)]),y.value?(r(),V(O,{key:2,"url-list":[k.value],onClose:l[1]||(l[1]=h=>y.value=!1)},null,8,["url-list"])):v("",!0)])}}}),me=le(ce,[["__scopeId","data-v-a8d3b58e"]]);export{me as U};
