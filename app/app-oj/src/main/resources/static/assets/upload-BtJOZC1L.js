import{h as l,aP as p}from"./index-DTkCE7MD.js";const m=(s,o)=>l.upload(p+"/sys-file/upload",s,o),g=s=>l.post(p+"/sys-file/generatePreUrl",{name:s}),U=async(s,o=s.name,i="default",u,d,r)=>{try{const{data:a}=await g(o);if(!a)throw new Error("获取预签名URL失败");const e=new XMLHttpRequest;return e.open("PUT",a,!0),u&&e.upload.addEventListener("progress",t=>{if(t.lengthComputable){const n=Math.round(t.loaded/t.total*100);u(n)}}),e.onload=()=>{if(e.status>=200&&e.status<300){const t=a.split("?")[0],n=new URL(t).pathname,c={url:t,filename:o,fileName:o,eTag:e.getResponseHeader("ETag")||"",objectName:n,dirTag:i,contextType:s.type,size:s.size,fileId:Date.now()};d&&d(c)}else{const t={status:e.status,method:"PUT",url:a,message:`上传失败: ${e.status}`};r&&r(t)}},e.onerror=()=>{r&&r({status:0,method:"PUT",url:a,message:"网络错误，上传失败"})},e.send(s),e}catch(a){const e={status:0,method:"PUT",url:"",message:a.message||"上传失败"};throw r&&r(e),e}};export{U as a,m as u};
