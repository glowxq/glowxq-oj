import{h as f,aP as b,d as O,r as v,w as H,o as n,x as m,k as c,c as Y,P as I,Q as P,u as h,et as F,eu as R,bc as A,e as B,b4 as U,f as j,g as q,j as M,i as g,a_ as J,y as k,a$ as V,D as Q,b0 as z,b1 as G,aa as K}from"./index-DTkCE7MD.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{u as N}from"./useHandleData-BdxQ-8Ab.js";import{_ as X}from"./TeacherStatisticsForm.vue_vue_type_script_setup_true_lang-B_m2VvVe.js";import{I as Z,d as ee,u as te}from"./common-DxSkM119.js";import"./sortable.esm-Cw1ESr5Y.js";const ae=t=>f.get(b+"/teacher-statistics",t),le=t=>f.post(b+"/teacher-statistics",t),se=t=>f.put(b+"/teacher-statistics",t),E=t=>f.delete(b+"/teacher-statistics",t),oe=t=>{const{id:s}=t;return f.get(b+`/teacher-statistics/${s}`)},ie=(t,s)=>f.upload(b+"/teacher-statistics/import",t,s),re=t=>f.download(b+"/teacher-statistics/export",t),ne=t=>{const{keyword:s}=t;return f.get(b+`/teacher-statistics/remote/${s}`)},ce=O({name:"RemoteSearchSelect",__name:"index",props:{modelValue:[String,Number],placeholder:String,fetchOptions:{type:Function,required:!0},api:{type:Function,default:t=>t},fieldMappings:{type:Object,default:()=>({key:"id",label:"label",value:"value"})}},emits:["update:modelValue"],setup(t,{emit:s}){const o=t,D=s,T=v(o.modelValue),S=v(!1),_=v([]),w=async i=>{if(console.log("remoteMethod triggered with query:",i),i){S.value=!0;try{const p=o.api(i),r=await o.fetchOptions(p);_.value=r.data}catch(p){console.error("Error fetching options:",p)}finally{S.value=!1}}},C=i=>{D("update:modelValue",i)};return H(()=>o.modelValue,i=>{T.value=i}),(i,p)=>(n(),m(h(R),{modelValue:T.value,"onUpdate:modelValue":p[0]||(p[0]=r=>T.value=r),placeholder:t.placeholder,loading:S.value,"remote-method":w,onChange:C,remote:"",filterable:"","remote-show-suffix":"",clearable:""},{default:c(()=>[(n(!0),Y(I,null,P(_.value,r=>(n(),m(h(F),{key:r[t.fieldMappings.key],label:r[t.fieldMappings.label],value:r[t.fieldMappings.value]},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"]))}});function pe(t){const s=A();B(async()=>{await s.getDictByCodes(t)})}const ue={class:"table-box"},ge=O({name:"TeacherStatisticsView",__name:"index",setup(t){pe(["account_status","dynamic_user_options"]);const s=A(),o=v(),D=[{type:"selection",width:80},{prop:"year",label:"统计年限"},{prop:"month",label:"统计月份"},{prop:"duringTime",label:"统计年月"},{prop:"teacherId",label:"教师id"},{prop:"teacherCommonType",label:"讲师区分类型",tag:!0,enum:s.getDictOptions("account_status"),fieldNames:{label:"codeName",value:"id",tagType:"callbackShowStyle"}},{prop:"totalTeaching",label:"授课总数"},{prop:"totalClassCount",label:"服务班次数"},{prop:"totalHours",label:"课时总数"},{prop:"checkStatus",label:"核对状态",tag:!0,enum:s.getDictOptions("account_status"),fieldNames:{label:"codeName",value:"id",tagType:"callbackShowStyle"}},{prop:"checkTime",label:"核对时间"},{prop:"lastSyncTime",label:"最近一次同步时间"},{prop:"remark",label:"备注"},{prop:"operation",label:"操作",width:250,fixed:"right"}],T=[{prop:"year",label:"统计年限",el:"input"},{prop:"month",label:"统计月份",el:"input"},{prop:"duringTime",label:"统计年月",el:"date-picker",span:2,props:{type:"datetimerange",valueFormat:"YYYY-MM-DD HH:mm:ss"}},{prop:"remoteTeacherId",label:"演示：远程搜索",el:"select",render:a=>U(ce,{modelValue:a.modelValue,"onUpdate:modelValue":a["onUpdate:modelValue"],placeholder:"教师id，输入数字触发搜索",fetchOptions:ne,api:e=>({keyword:e}),fieldMappings:{key:"id",label:"teacherId",value:"id"}})},{prop:"teacherCommonType",label:"讲师区分类型",el:"select",enum:s.getDictOptions("account_status"),fieldNames:{label:"codeName",value:"id",tagType:"callbackShowStyle"}},{prop:"totalTeaching",label:"授课总数",el:"input"},{prop:"totalClassCount",label:"服务班次数",el:"input"},{prop:"totalHours",label:"课时总数",el:"input"},{prop:"checkStatus",label:"核对状态",el:"select",fieldNames:{label:"codeName",value:"id",tagType:"callbackShowStyle"}},{prop:"checkTime",label:"核对时间",el:"date-picker",span:2,props:{type:"datetimerange",valueFormat:"YYYY-MM-DD HH:mm:ss"}},{prop:"lastSyncTime",label:"最近一次同步时间",el:"date-picker",span:2,props:{type:"datetimerange",valueFormat:"YYYY-MM-DD HH:mm:ss"}}],S=a=>{let e=_(a);return ae(e)},_=a=>{let e=JSON.parse(JSON.stringify(a));return e.checkTime&&(e.checkTimeStart=e.checkTime[0]),e.checkTime&&(e.checkTimeEnd=e.checkTime[1]),delete e.checkTime,e},w=v(),C=async(a,e={},l=!0)=>{var d,y;if(!l){const x=await oe({id:e==null?void 0:e.id});e=x==null?void 0:x.data}const u={title:a,row:{...e},api:l?le:se,getTableList:(d=o.value)==null?void 0:d.getTableList};(y=w.value)==null||y.acceptParams(u)},i=async a=>{var e;await N(E,{ids:[a.id]},`删除【${a.id}】教师统计`),(e=o.value)==null||e.getTableList()},p=async a=>{var e,l;await N(E,{ids:a},"删除所选教师统计"),(e=o.value)==null||e.clearSelection(),(l=o.value)==null||l.getTableList()},r=v(),L=()=>{var e,l;const a={title:"教师统计",templateName:"教师统计模板",tempApi:ee,importApi:ie,getTableList:(e=o.value)==null?void 0:e.getTableList};(l=r.value)==null||l.acceptParams(a)},$=async()=>{K.confirm("确认导出教师统计数据?","温馨提示",{type:"warning"}).then(()=>{var e;let a=_((e=o.value)==null?void 0:e.searchParam);te(re,"教师统计",a)})};return(a,e)=>{const l=j("el-button"),u=q("auth");return n(),Y("div",ue,[M(W,{ref_key:"proTableRef",ref:o,title:"教师统计",indent:20,columns:D,"search-columns":T,"request-api":S,"row-key":"id"},{tableHeader:c(d=>[g((n(),m(l,{type:"primary",icon:h(J),onClick:e[0]||(e[0]=y=>C("新增教师统计"))},{default:c(()=>e[1]||(e[1]=[k(" 新增 ")])),_:1},8,["icon"])),[[u,"teacher.statistics.create"]]),g((n(),m(l,{type:"danger",icon:h(V),plain:"",disabled:!d.isSelected,onClick:y=>p(d.selectedListIds)},{default:c(()=>e[2]||(e[2]=[k(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[u,"teacher.statistics.remove"]]),g((n(),m(l,{type:"primary",icon:h(Q),plain:"",onClick:L},{default:c(()=>e[3]||(e[3]=[k(" 导入 ")])),_:1},8,["icon"])),[[u,"teacher.statistics.import"]]),g((n(),m(l,{type:"primary",icon:h(z),plain:"",onClick:$},{default:c(()=>e[4]||(e[4]=[k(" 导出 ")])),_:1},8,["icon"])),[[u,"teacher.statistics.export"]])]),operation:c(({row:d})=>[g((n(),m(l,{type:"primary",link:"",icon:h(G),onClick:y=>C("编辑教师统计",d,!1)},{default:c(()=>e[5]||(e[5]=[k(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[u,"teacher.statistics.update"]]),g((n(),m(l,{type:"primary",link:"",icon:h(V),onClick:y=>i(d)},{default:c(()=>e[6]||(e[6]=[k(" 删除 ")])),_:2},1032,["icon","onClick"])),[[u,"teacher.statistics.remove"]])]),_:1},512),M(X,{ref_key:"teacherStatisticsRef",ref:w},null,512),M(Z,{ref_key:"ImportExcelRef",ref:r},null,512)])}}});export{ge as default};
