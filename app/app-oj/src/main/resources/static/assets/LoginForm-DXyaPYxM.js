import{h as X,aP as $,d as G,r as u,aB as U,as as Q,o as A,x as Z,k as m,a as c,i as P,N as Y,j as l,u as x,aQ as ee,c as z,t as te,n as se,m as H,z as O,V as ae,f as h,aR as oe,_ as J,q as ne,a4 as le,s as ie,e as re,F as ce,aK as ue,y as j,aq as de,J as me,aS as pe,P as ve,aT as fe,aU as ge,ab as _e,aV as ye,aW as he}from"./index-DTkCE7MD.js";import{u as we,a as Se}from"./tabs-DcAgpsB1.js";import{b as be}from"./tenant-BWmX3Yn9.js";const xe=()=>X.get($+"/captcha/status",{},{loading:!1}),Ee=()=>X.post($+"/captcha/get",{},{loading:!1}),Le=D=>X.post($+"/captcha/check",D,{loading:!1}),ke={class:"sliderBox"},Te={class:"sliderBox_content"},Ce=["src"],Ie=["src"],Ve=G({name:"SliderCaptcha",__name:"SliderCaptcha",emits:["success"],setup(D,{expose:K,emit:I}){const _=u(!1),t=U({big:"",small:"",requestId:"",posY:0,isSuccess:!1,bigWidth:320,secretKey:""}),a=u(null),w=u(null),d=u(null),E=u(0),i=u(""),r=u(!1),L=u(!1);let v=null;const N=I,S="ontouchstart"in window||navigator.maxTouchPoints>0,V=()=>{k(),_.value=!0},k=async()=>{const{data:n}=await Ee();Object.assign(t,{big:n.bigImageBase64,small:n.smallImageBase64,posY:n.posY,requestId:n.requestId,bigWidth:n.bigWidth,isSuccess:!1,secretKey:n.secretKey}),r.value=!1,i.value="",await ae(b)},B=async()=>{t.isSuccess=!1,r.value=!1,i.value="",await k()},e=()=>{_.value=!1,v&&v(),s()},s=()=>{t.big="",t.small="",t.requestId="",t.posY=0,t.isSuccess=!1,t.secretKey="",t.bigWidth=320},b=()=>{if(!a.value||!d.value||!w.value)return;a.value.style.left="0px",d.value.style.left="0px",d.value.style.top=`${t.posY}px`,E.value=0;const n=w.value.offsetWidth-a.value.offsetWidth;let o=0,p=0,M=0;const R=g=>{o=Math.max(0,Math.min(g-p,n)),a.value.style.left=`${o}px`,d.value.style.left=`${o}px`,E.value=o},f=g=>{p=g instanceof MouseEvent?g.clientX:g.touches[0].clientX,M=Date.now();const y=C=>{const W=C instanceof MouseEvent?C.clientX:C.touches[0].clientX;R(W)},F=async()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",F),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",F);const{iv:C,encryptedData:W}=await oe(o+"",t.secretKey);await q({requestId:t.requestId,startTime:M,moveEncrypted:W,iv:C})};S?(document.addEventListener("touchmove",y),document.addEventListener("touchend",F)):(document.addEventListener("mousemove",y),document.addEventListener("mouseup",F))};S?a.value.addEventListener("touchstart",f):a.value.addEventListener("mousedown",f),v=()=>{var g,y;document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",f),document.removeEventListener("touchend",f),(g=a.value)==null||g.removeEventListener("mousedown",f),(y=a.value)==null||y.removeEventListener("touchstart",f)}},q=async n=>{if(!L.value){L.value=!0;try{const{code:o}=await Le(n),p=((Date.now()-n.startTime)/1e3).toFixed(2);r.value=!0,o==="0000"?(t.isSuccess=!0,i.value=`验证成功, 耗时${p}s`,setTimeout(()=>{N("success"),e()},2e3)):T()}catch{T()}finally{L.value=!1}}},T=()=>{t.isSuccess=!1,i.value="验证失败",r.value=!0,setTimeout(B,2e3)};return Q(()=>{v&&v()}),K({acceptParams:V,dialogVisible:_}),(n,o)=>{const p=h("el-icon"),M=h("el-dialog");return A(),Z(M,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=R=>_.value=R),style:O({width:t.bigWidth+70+"px"}),"close-on-click-modal":!1,onClose:e,"align-center":"","destroy-on-close":"","close-on-press-escape":!1},{default:m(()=>[c("div",ke,[c("div",Te,[P(c("img",{src:"data:image/png;base64,"+t.big,class:"bigImg",alt:"验证码主图"},null,8,Ce),[[Y,t.big]]),c("span",{class:"sliderBox_refresh",onClick:B},[l(p,{class:"el-input__icon"},{default:m(()=>[l(x(ee))]),_:1})]),P(c("img",{src:"data:image/png;base64,"+t.small,class:"smallImg",ref_key:"imgK",ref:d,alt:"验证码拼图"},null,8,Ie),[[Y,t.small]]),r.value?(A(),z("div",{key:0,class:se(["overlay",{success:t.isSuccess,failure:!t.isSuccess}])},[c("span",null,te(i.value),1)],2)):H("",!0)]),c("div",{class:"btnBox",ref_key:"wrap",ref:w},[o[1]||(o[1]=c("div",{class:"sliderBox_text"},"向右滑动，完成验证",-1)),c("div",{class:"sliderBox_track",style:O({width:E.value+"px"})},null,4),c("div",{class:"sliderBox_btn",ref_key:"slider",ref:a},">",512)],512)])]),_:1},8,["modelValue","style"])}}}),Be=J(Ve,[["__scopeId","data-v-54268dd1"]]),qe={class:"login-btn"},Me={key:0,style:{"margin-top":"20px",color:"var(--el-color-warning)"}},Fe=G({__name:"LoginForm",setup(D){const K=ne(),I=le(),_=we(),t=Se(),a=ie(),w=u(!0),d=u(),E=U({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),i=u(!1),r=U({username:"13667700000",password:"123456",clientId:"",grantType:""}),L=async()=>{await v()},v=async()=>{i.value=!0;try{a.reset();const{data:e}=await fe({...r});I.setToken(e.accessToken),I.setUserInfo(e.userInfo),e.menuType&&(a.changeMenuType(e.menuType),e.menuType==="Client"?a.changeLayout("transverse"):e.menuType==="Admin"?a.changeLayout("vertical"):e.menuType==="Common"&&a.changeLayout("columns")),await ge(),_.closeMultipleTab(),t.setKeepAliveName(),K.push(_e),ye({title:he(),message:"欢迎登录 Glowxq-Nexus",type:"success",duration:3e3})}finally{i.value=!1}},N=async()=>{try{const e=await be();e.code==="0000"&&e.data&&(w.value=e.data.enable,console.log("租户功能启用状态:",w.value))}catch(e){console.error("获取租户功能启用状态失败:",e)}},S=u(),V=()=>{d.value&&d.value.validate(async e=>{var s;if(e)try{i.value=!0;const{data:b}=await xe();b?(s=S.value)==null||s.acceptParams():await v()}finally{i.value=!1}})},k=()=>{d.value&&d.value.resetFields()},B=()=>{k()};return re(()=>{N(),document.onkeydown=e=>{var s;if(e=window.event||e,e.code==="Enter"||e.code==="enter"||e.code==="NumpadEnter"){if(i.value||(s=S.value)!=null&&s.dialogVisible)return;V()}}}),(e,s)=>{const b=h("el-icon"),q=h("el-input"),T=h("el-form-item"),n=h("el-form"),o=h("el-button");return A(),z(ve,null,[l(n,{ref_key:"loginFormRef",ref:d,model:r,rules:E,size:"large"},{default:m(()=>[l(T,{prop:"username"},{default:m(()=>[l(q,{modelValue:r.username,"onUpdate:modelValue":s[0]||(s[0]=p=>r.username=p),placeholder:"用户名： admin"},{prefix:m(()=>[l(b,{class:"el-input__icon"},{default:m(()=>[l(x(ce))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(T,{prop:"password",style:{"margin-bottom":"0"}},{default:m(()=>[l(q,{modelValue:r.password,"onUpdate:modelValue":s[1]||(s[1]=p=>r.password=p),type:"password",placeholder:"密码： 123456","show-password":"",autocomplete:"new-password"},{prefix:m(()=>[l(b,{class:"el-input__icon"},{default:m(()=>[l(x(ue))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),c("div",qe,[l(o,{icon:x(de),round:"",size:"large",onClick:k},{default:m(()=>s[2]||(s[2]=[j(" 重置 ")])),_:1},8,["icon"]),l(o,{icon:x(me),round:"",size:"large",type:"primary",loading:i.value,onClick:V},{default:m(()=>s[3]||(s[3]=[j(" 登录 ")])),_:1},8,["icon","loading"])]),x(pe)?(A(),z("div",Me,s[4]||(s[4]=[c("span",null,"如无法登陆请联系作者：glowxq@qq.com",-1)]))):H("",!0),l(Be,{ref_key:"captchaRef",ref:S,onSuccess:L,onClose:B},null,512)],64)}}}),Ne=J(Fe,[["__scopeId","data-v-f79caab8"]]);export{Ne as default};
