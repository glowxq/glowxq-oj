import{P as c}from"./ProblemSourceType-ColSuHcx.js";import{E as w}from"./EnumSelect-C2fXZs6G.js";import{U as B}from"./file-Cxx7VqTf.js";import{b as C}from"./problem-CJE_etNM.js";import{d as P,r as m,aB as k,o as D,x as z,k as r,a as b,j as t,y as U,u as L,W as f,f as i,_ as N}from"./index-DTkCE7MD.js";import"./upload-BtJOZC1L.js";const q={class:"dialog-footer"},H=P({name:"ImportBatchProgramDialog",__name:"ImportBatchProgramDialog",emits:["success"],setup(J,{expose:v,emit:_}){const n=m(!1),u=m(),p=m(!1),d=m([]),l=k({batchFileUrl:"",problemSourceType:c.HOJ.code,needInsertUnExistTag:!1}),y={batchFileUrl:[{required:!0,message:"请上传批量题目压缩包",trigger:"change"}],problemSourceType:[{required:!0,message:"请选择题目来源",trigger:"change"}]},x=o=>{d.value=o},T=o=>{o&&o.url?l.batchFileUrl=o.url:l.batchFileUrl=""},h=async()=>{u.value&&await u.value.validate(async o=>{if(o)try{p.value=!0;const e={batchFileUrl:l.batchFileUrl,problemSourceType:String(l.problemSourceType),needInsertUnExistTag:l.needInsertUnExistTag},s=await C(e);s.code==="0000"?(f.success("批量导入编程题成功"),V()):f.error(s.message||"导入失败")}catch(e){console.error("批量导入失败:",e),f.error("批量导入失败，请检查文件格式是否正确")}finally{p.value=!1}})},V=()=>{n.value=!1,F("success")},F=_;return v({open:()=>{n.value=!0,l.batchFileUrl="",l.problemSourceType=c.HOJ.code,l.needInsertUnExistTag=!1,d.value=[]}}),(o,e)=>{const s=i("el-form-item"),S=i("el-switch"),I=i("el-form"),g=i("el-button"),E=i("el-dialog");return D(),z(E,{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value=a),title:"批量导入编程题",width:"500px","destroy-on-close":""},{footer:r(()=>[b("div",q,[t(g,{onClick:e[3]||(e[3]=a=>n.value=!1)},{default:r(()=>e[6]||(e[6]=[U("取消")])),_:1}),t(g,{type:"primary",onClick:h,loading:p.value},{default:r(()=>e[7]||(e[7]=[U(" 确认导入 ")])),_:1},8,["loading"])])]),default:r(()=>[t(I,{ref_key:"formRef",ref:u,model:l,rules:y,"label-width":"120px","label-position":"right"},{default:r(()=>[t(s,{label:"选择文件",prop:"batchFileUrl"},{default:r(()=>[t(B,{modelValue:l.batchFileUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>l.batchFileUrl=a),accept:".zip",limit:1,"file-size":1e3,"use-oss":!0,dir:"problem/batch-import","file-list":d.value,"onUpdate:fileList":x,onChange:T},null,8,["modelValue","file-list"]),e[5]||(e[5]=b("div",{class:"upload-tip"}," 支持.zip格式的批量编程题压缩包（包含多个题目压缩包的压缩包） ",-1))]),_:1}),t(s,{label:"题目来源",prop:"problemSourceType"},{default:r(()=>[t(w,{enumData:L(c),type:"select",modelValue:l.problemSourceType,"onUpdate:modelValue":e[1]||(e[1]=a=>l.problemSourceType=a)},null,8,["enumData","modelValue"])]),_:1}),t(s,{label:"标签处理",prop:"needInsertUnExistTag"},{default:r(()=>[t(S,{modelValue:l.needInsertUnExistTag,"onUpdate:modelValue":e[2]||(e[2]=a=>l.needInsertUnExistTag=a),"active-text":"自动创建不存在的标签","inactive-text":"忽略不存在的标签"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),G=N(H,[["__scopeId","data-v-449799e4"]]);export{G as default};
