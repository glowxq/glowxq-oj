import{d as H,v as ee,r as w,b as ue,w as W,e as te,f as _,g as pe,o as u,c as V,a as l,j as e,k as t,u as d,X as z,ds as ce,x as L,t as k,m as R,aJ as J,az as Z,y as m,i as me,P as fe,Q as _e,n as ve,aK as X,a8 as ge,W as N,_ as ae,q as ye,aB as j,J as we,dW as be,F as Ve,dX as he,dV as ke,dY as xe,dZ as Ue,a1 as Ie}from"./index-DTkCE7MD.js";import{a as Ce,g as Te,b as le}from"./tenant-BWmX3Yn9.js";import{U as Ke}from"./Img-CbqiKKTP.js";import"./upload-BtJOZC1L.js";const Le={class:"tenant-select-container"},Ne={key:0,class:"tenant-section"},Pe={class:"section-title"},$e={class:"tenant-card"},Se={key:0,class:"selected-tenant"},qe={class:"tenant-logo"},De=["src"],Ee={class:"tenant-info"},Me={class:"tenant-name-wrapper"},ze=["title"],Ae={class:"tenant-meta-tags"},Re={class:"tenant-tag tenant-id"},Ye={class:"tenant-tag tenant-code"},Be={class:"tenant-input-group"},Fe={class:"tenant-buttons"},je={class:"tenant-popover-content"},We={class:"tenant-header"},Je={class:"tenant-title-wrapper"},Xe={class:"current-tenant-name"},Ge={class:"tenant-search"},Oe={class:"tenant-list"},Qe={key:0,class:"tenant-grid"},Ze=["onClick"],He={class:"tenant-item-left"},et={class:"tenant-logo"},tt=["src"],at={class:"tenant-info"},lt={class:"tenant-name-wrapper"},st=["title"],nt={class:"tenant-meta-tags"},ot={class:"tenant-tag tenant-id"},rt={class:"tenant-tag tenant-code"},dt={class:"tenant-item-right"},it={key:1,class:"tenant-empty"},ut={class:"password-dialog-content"},pt={class:"tenant-info-display"},ct={class:"tenant-logo-container"},mt=["src"],ft=["title"],_t={class:"tenant-meta-dialog"},vt={class:"tenant-tag tenant-id"},gt={key:0,class:"password-error"},yt={class:"dialog-footer"},wt=H({__name:"index",props:{modelValue:{}},emits:["update:modelValue","change"],setup(G,{emit:B}){const S=G,q=B,x=ee(),C=w(!0),v=w(null),T=w(!1),U=w([]),g=w(!1),n=w(""),P=w(!1),h=w(null),$=w(""),I=w(""),D=w(!1),Y=ue(()=>{if(!n.value)return U.value;const s=n.value.toLowerCase();return U.value.filter(o=>{var p,E,K;return((p=o.tenantName)==null?void 0:p.toLowerCase().includes(s))||((E=o.tenantCode)==null?void 0:E.toLowerCase().includes(s))||((K=o.tenantId)==null?void 0:K.toLowerCase().includes(s))})}),i=s=>{q("update:modelValue",s)};W(()=>S.modelValue,s=>{if(v.value){const o=v.value.tenantId===s,p=v.value.tenantCode===s;!o&&!p&&(v.value=null,q("change",null))}});const a=async()=>{g.value=!0;try{const s=await Ce();if(s.code==="0000"&&s.data&&(typeof s.data=="object"&&"rows"in s.data&&Array.isArray(s.data.rows)?U.value=s.data.rows:Array.isArray(s.data)&&(U.value=s.data),x.tenantId&&S.modelValue===x.tenantId)){const o=U.value.find(p=>p.tenantId===x.tenantId);o&&f(o,!1)}}catch(s){console.error("获取租户列表失败:",s)}finally{g.value=!1}},y=async()=>{if(!S.modelValue){N.warning("请输入租户标识");return}T.value=!0;try{const s=await Te(S.modelValue);if(s.code==="0000"&&s.data){if(!s.data.enable){N.warning("该租户已被禁用，无法选择");return}s.data.password?(h.value=s.data,$.value="",I.value="",P.value=!0):f(s.data)}else N.error(s.message||"未找到匹配的租户")}catch(s){console.error("搜索租户失败:",s),N.error("搜索租户时发生错误")}finally{T.value=!1}},b=()=>{if(h.value){if(!$.value){I.value="请输入密码";return}I.value="",D.value=!0,setTimeout(()=>{if($.value===h.value.password)P.value=!1,f(h.value);else{I.value="密码错误，请重新输入";const s=document.querySelector(".password-input");s&&(s.classList.add("shake-animation"),setTimeout(()=>{s.classList.remove("shake-animation")},500))}D.value=!1},500)}},f=(s,o=!0)=>{if(!s.enable){N.warning("该租户已被禁用，无法选择");return}q("update:modelValue",s.tenantId),v.value=s,q("change",s),o&&N.success(`已选择租户: ${s.tenantName}`)},A=async()=>{try{const s=await le();s.code==="0000"&&s.data&&(C.value=s.data.enable)}catch(s){console.error("获取租户功能启用状态失败:",s)}};return te(()=>{A(),a()}),(s,o)=>{const p=_("el-icon"),E=_("el-tooltip"),K=_("el-input"),M=_("el-button"),r=_("el-tag"),se=_("el-badge"),ne=_("el-empty"),oe=_("el-popover"),re=_("el-dialog"),de=pe("loading");return u(),V("div",Le,[C.value?(u(),V("div",Ne,[l("div",Pe,[e(p,null,{default:t(()=>[e(d(z))]),_:1}),o[4]||(o[4]=l("span",null,"选择租户",-1)),o[5]||(o[5]=l("span",{class:"required"},"*",-1)),e(E,{content:"租户标识是您账号的重要归属信息",placement:"top",effect:"light","hide-after":0},{default:t(()=>[e(p,{class:"help-icon"},{default:t(()=>[e(d(ce))]),_:1})]),_:1})]),l("div",$e,[v.value?(u(),V("div",Se,[l("div",qe,[v.value.logoUrl?(u(),V("img",{key:0,src:v.value.logoUrl,alt:"logo"},null,8,De)):(u(),L(p,{key:1},{default:t(()=>[e(d(z))]),_:1}))]),l("div",Ee,[l("div",Me,[l("span",{class:"tenant-name",title:v.value.tenantName},k(v.value.tenantName),9,ze)]),l("div",Ae,[l("span",Re,k(v.value.tenantId),1),l("span",Ye,k(v.value.tenantCode),1)])])])):R("",!0),l("div",Be,[e(K,{"model-value":s.modelValue,"onUpdate:modelValue":i,placeholder:"请输入租户标识",clearable:"",class:"tenant-input",onKeyup:J(y,["enter"])},{prefix:t(()=>[e(p,{class:"el-input__icon"},{default:t(()=>[e(d(z))]),_:1})]),_:1},8,["model-value"]),l("div",Fe,[e(M,{onClick:y,loading:T.value,type:"primary",class:"search-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e(d(Z))]),_:1})]),_:1},8,["loading"]),e(oe,{placement:"bottom",trigger:"click",width:450,onShow:a,"popper-class":"tenant-popover"},{reference:t(()=>[e(M,{class:"tenant-select-btn",type:"primary"},{default:t(()=>o[6]||(o[6]=[m("选择")])),_:1})]),default:t(()=>[l("div",je,[l("div",We,[l("div",Je,[e(p,{class:"tenant-icon"},{default:t(()=>[e(d(z))]),_:1}),o[7]||(o[7]=l("span",{class:"tenant-title"},"选择租户",-1)),e(r,{size:"small",type:"info",effect:"plain",class:"tenant-count-tag"},{default:t(()=>[m(" 共 "+k(U.value.length)+" 个租户 ",1)]),_:1})]),d(x).tenantName?(u(),L(se,{key:0,value:1,type:"primary"},{default:t(()=>[l("span",Xe,k(d(x).tenantName),1)]),_:1})):R("",!0)]),l("div",Ge,[e(K,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=c=>n.value=c),placeholder:"搜索租户",clearable:"",class:"tenant-key-input"},{prefix:t(()=>[e(p,{class:"search-prefix-icon"},{default:t(()=>[e(d(Z))]),_:1})]),_:1},8,["modelValue"])]),me((u(),V("div",Oe,[Y.value.length>0?(u(),V("div",Qe,[(u(!0),V(fe,null,_e(Y.value,c=>(u(),V("div",{key:c.id,class:ve(["tenant-item",{"is-active":s.modelValue===c.tenantId,"is-current":d(x).tenantId===c.tenantId}]),onClick:F=>f(c)},[l("div",He,[l("div",et,[c.logoUrl?(u(),V("img",{key:0,src:c.logoUrl,alt:"logo"},null,8,tt)):(u(),L(p,{key:1},{default:t(()=>[e(d(z))]),_:1}))]),l("div",at,[l("div",lt,[l("span",{class:"tenant-name",title:c.tenantName},k(c.tenantName),9,st)]),l("div",nt,[l("span",ot,k(c.tenantId),1),l("span",rt,k(c.tenantCode),1)])])]),l("div",dt,[d(x).tenantId===c.tenantId?(u(),L(r,{key:0,type:"primary",size:"small",effect:"plain"},{default:t(()=>o[8]||(o[8]=[m(" 当前 ")])),_:1})):c.enable?(u(),L(r,{key:1,type:"success",size:"small"},{default:t(()=>o[9]||(o[9]=[m("正常")])),_:1})):(u(),L(r,{key:2,type:"danger",size:"small"},{default:t(()=>o[10]||(o[10]=[m("禁用")])),_:1}))])],10,Ze))),128))])):(u(),V("div",it,[e(ne,{description:"暂无租户信息"})]))])),[[de,g.value]])])]),_:1})])])])])):R("",!0),e(re,{modelValue:P.value,"onUpdate:modelValue":o[3]||(o[3]=c=>P.value=c),title:"租户密码验证",width:"380px","close-on-click-modal":!1,"append-to-body":!0,"destroy-on-close":""},{footer:t(()=>[l("div",yt,[e(M,{onClick:o[2]||(o[2]=c=>P.value=!1),class:"cancel-btn"},{default:t(()=>o[12]||(o[12]=[m("取消")])),_:1}),e(M,{type:"primary",onClick:b,loading:D.value,class:"confirm-btn"},{default:t(()=>o[13]||(o[13]=[m(" 确认 ")])),_:1},8,["loading"])])]),default:t(()=>{var c,F,O,Q;return[l("div",ut,[l("div",pt,[l("div",ct,[(c=h.value)!=null&&c.logoUrl?(u(),V("img",{key:0,src:h.value.logoUrl,alt:"logo",class:"tenant-logo-large"},null,8,mt)):(u(),L(p,{key:1,class:"tenant-logo-placeholder"},{default:t(()=>[e(d(z))]),_:1}))]),l("p",{class:"tenant-name-display",title:(F=h.value)==null?void 0:F.tenantName},k((O=h.value)==null?void 0:O.tenantName),9,ft),l("div",_t,[l("span",vt,k((Q=h.value)==null?void 0:Q.tenantId),1)])]),o[11]||(o[11]=l("p",{class:"password-tip"},"该租户需要密码验证",-1)),e(K,{modelValue:$.value,"onUpdate:modelValue":o[1]||(o[1]=ie=>$.value=ie),type:"password",placeholder:"请输入租户密码","show-password":"",onKeyup:J(b,["enter"]),class:"password-input"},{prefix:t(()=>[e(p,null,{default:t(()=>[e(d(X))]),_:1})]),_:1},8,["modelValue"]),I.value?(u(),V("div",gt,[e(p,null,{default:t(()=>[e(d(ge))]),_:1}),l("span",null,k(I.value),1)])):R("",!0)])]}),_:1},8,["modelValue"])])}}}),bt=ae(wt,[["__scopeId","data-v-7e8d7721"]]),Vt={class:"default-register-container"},ht={class:"form-section"},kt={class:"form-section"},xt={class:"form-grid"},Ut={class:"form-grid"},It={class:"form-grid"},Ct={class:"avatar-wrapper"},Tt={class:"register-actions"},Kt=H({__name:"DefaultRegister",emits:["updateLeftContent"],setup(G,{emit:B}){const S=B,q=ye(),x=ee(),C=w(),v=w(!1),T=w(!0),U=w([]),g=j({username:"",password:"",tenantKey:"",phone:"",email:"",name:"",nickname:"",sex:0,birthday:"",logo:"",address:""}),n=j({...g,confirmPassword:""}),P=i=>{n.phone=i},h=i=>{console.log("租户选择变化:",i)},$=(i,a,y)=>{const b=typeof a=="string"?a:"",f=typeof n.password=="string"?n.password:"";b===""?y(new Error("请再次输入密码")):b.trim()!==f.trim()?y(new Error("两次输入密码不一致")):y()};W(()=>n.password,()=>{var i;n.confirmPassword&&((i=C.value)==null||i.validateField("confirmPassword"))}),W(()=>n.confirmPassword,i=>{var a;i&&((a=C.value)==null||a.validateField("confirmPassword"))});const I=j({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:$,trigger:"blur"}],tenantKey:[{required:!0,message:"请选择或输入租户",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),D=async()=>{if(console.log("handleRegister 被调用"),!C.value){console.error("表单引用为空");return}if(v.value){console.log("正在提交中，请勿重复点击");return}try{await C.value.validate()}catch{console.log("表单验证失败");return}try{g.username=n.username,g.password=n.password,g.tenantKey=n.tenantKey,g.phone=n.phone,g.email=n.email,g.name=n.name,g.nickname=n.nickname,g.sex=n.sex,g.birthday=n.birthday,g.logo=n.logo,g.address=n.address,v.value=!0,await Ue(g),N.success("注册成功，即将跳转到登录页"),setTimeout(()=>{q.push(Ie)},1500)}catch(i){console.error("注册失败:",i),N.error(i.message||"注册失败，请稍后重试")}finally{v.value=!1}},Y=async()=>{try{const i=await le();i.code==="0000"&&i.data&&(T.value=i.data.enable,console.log("租户功能启用状态:",T.value),T.value||delete I.tenantKey)}catch(i){console.error("获取租户功能启用状态失败:",i)}};return te(()=>{S("updateLeftContent",{title:"欢迎加入管理平台",subtitle:"构建强大的管理系统",features:[{icon:"🎯",text:"专业的管理平台"},{icon:"🛡️",text:"多租户管理系统"},{icon:"📊",text:"数据统计分析"},{icon:"⚙️",text:"灵活的权限控制"}]}),Y(),x.tenantId&&(n.tenantKey=x.tenantId)}),(i,a)=>{const y=_("el-icon"),b=_("el-input"),f=_("el-form-item"),A=_("el-option"),s=_("el-select"),o=_("el-date-picker"),p=_("el-collapse-item"),E=_("el-collapse"),K=_("el-button"),M=_("el-form");return u(),V("div",Vt,[e(M,{ref_key:"registerFormRef",ref:C,model:n,rules:I,"label-width":"100px","label-position":"left",size:"default",onKeyup:J(D,["enter"]),class:"register-form"},{default:t(()=>[l("div",ht,[a[18]||(a[18]=l("h4",{class:"section-title"},"基本信息",-1)),e(f,{prop:"username",class:"form-item"},{label:t(()=>a[13]||(a[13]=[m("用户名 "),l("span",{class:"required"},"*",-1)])),default:t(()=>[e(b,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=r=>n.username=r),placeholder:"请输入用户名",clearable:"",onInput:P},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(we))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{prop:"password",class:"form-item"},{label:t(()=>a[14]||(a[14]=[m("密码 "),l("span",{class:"required"},"*",-1)])),default:t(()=>[e(b,{modelValue:n.password,"onUpdate:modelValue":a[1]||(a[1]=r=>n.password=r),modelModifiers:{trim:!0},type:"password",placeholder:"请输入密码","show-password":"",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(X))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{prop:"confirmPassword",class:"form-item"},{label:t(()=>a[15]||(a[15]=[m("确认密码 "),l("span",{class:"required"},"*",-1)])),default:t(()=>[e(b,{modelValue:n.confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=r=>n.confirmPassword=r),modelModifiers:{trim:!0},type:"password",placeholder:"请再次输入密码","show-password":"",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(X))]),_:1})]),_:1},8,["modelValue"])]),_:1}),T.value?(u(),L(f,{key:0,prop:"tenantKey",class:"form-item"},{label:t(()=>a[16]||(a[16]=[m("租户选择 "),l("span",{class:"required"},"*",-1)])),default:t(()=>[e(bt,{modelValue:n.tenantKey,"onUpdate:modelValue":a[3]||(a[3]=r=>n.tenantKey=r),onChange:h},null,8,["modelValue"])]),_:1})):R("",!0),e(f,{prop:"phone",class:"form-item"},{label:t(()=>a[17]||(a[17]=[m("手机号")])),default:t(()=>[e(b,{modelValue:n.phone,"onUpdate:modelValue":a[4]||(a[4]=r=>n.phone=r),placeholder:"请输入手机号",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(be))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l("div",kt,[e(E,{modelValue:U.value,"onUpdate:modelValue":a[12]||(a[12]=r=>U.value=r),class:"personal-collapse"},{default:t(()=>[e(p,{name:"personal"},{title:t(()=>a[19]||(a[19]=[l("div",{class:"collapse-title"},[l("h4",{class:"section-title-inline"},"个人信息"),l("span",{class:"optional-tag"},"选填")],-1)])),default:t(()=>[l("div",xt,[e(f,{prop:"name",class:"form-item"},{label:t(()=>a[20]||(a[20]=[m("真实姓名")])),default:t(()=>[e(b,{modelValue:n.name,"onUpdate:modelValue":a[5]||(a[5]=r=>n.name=r),placeholder:"请输入真实姓名",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(Ve))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{prop:"nickname",class:"form-item"},{label:t(()=>a[21]||(a[21]=[m("昵称")])),default:t(()=>[e(b,{modelValue:n.nickname,"onUpdate:modelValue":a[6]||(a[6]=r=>n.nickname=r),placeholder:"请输入昵称",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(he))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l("div",Ut,[e(f,{prop:"email",class:"form-item"},{label:t(()=>a[22]||(a[22]=[m("邮箱")])),default:t(()=>[e(b,{modelValue:n.email,"onUpdate:modelValue":a[7]||(a[7]=r=>n.email=r),placeholder:"请输入邮箱",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(ke))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{prop:"sex",class:"form-item"},{label:t(()=>a[23]||(a[23]=[m("性别")])),default:t(()=>[e(s,{modelValue:n.sex,"onUpdate:modelValue":a[8]||(a[8]=r=>n.sex=r),placeholder:"请选择性别"},{default:t(()=>[e(A,{label:"未知",value:0}),e(A,{label:"男",value:1}),e(A,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1})]),l("div",It,[e(f,{prop:"birthday",class:"form-item"},{label:t(()=>a[24]||(a[24]=[m("生日")])),default:t(()=>[e(o,{modelValue:n.birthday,"onUpdate:modelValue":a[9]||(a[9]=r=>n.birthday=r),type:"date",placeholder:"请选择生日",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(f,{prop:"address",class:"form-item"},{label:t(()=>a[25]||(a[25]=[m("地址")])),default:t(()=>[e(b,{modelValue:n.address,"onUpdate:modelValue":a[10]||(a[10]=r=>n.address=r),placeholder:"请输入地址",clearable:""},{prefix:t(()=>[e(y,null,{default:t(()=>[e(d(xe))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(f,{prop:"logo",class:"form-item avatar-item"},{label:t(()=>a[26]||(a[26]=[m("头像")])),default:t(()=>[l("div",Ct,[e(Ke,{"image-url":n.logo,"onUpdate:imageUrl":a[11]||(a[11]=r=>n.logo=r),limit:1,"file-size":2,dir:"avatar",height:"90px",width:"90px"},{tip:t(()=>a[27]||(a[27]=[l("span",{class:"upload-tip"},"支持jpg, png格式，大小不超过2MB",-1)])),_:1},8,["image-url"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l("div",Tt,[e(K,{type:"primary",loading:v.value,class:"register-button",size:"large",onClick:D},{default:t(()=>a[28]||(a[28]=[m(" 注册 ")])),_:1},8,["loading"])])]),_:1},8,["model","rules"])])}}}),St=ae(Kt,[["__scopeId","data-v-751efa97"]]);export{St as default};
