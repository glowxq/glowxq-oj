import{d as L,r as n,f as d,o as b,x as w,k as t,j as a,y as r,T as W,a as N,t as h,m as j,V as z,aS as D,W as I}from"./index-DTkCE7MD.js";import{a as H}from"./role-B65lK4x8.js";const q={class:"custom-tree-node"},O=L({name:"RolePermissions",__name:"RolePermissions",setup(F,{expose:P}){const S={children:"children",label:"title",value:"id"},f=n(!0),v=n(!1),c=n(!0),k=n(!1),s=n(),E=l=>{for(let e in s.value.store.nodesMap)s.value.store.nodesMap[e].expanded=l},R=l=>{l?s.value.setCheckedNodes(_.value):s.value.setCheckedNodes([])},m=n(!1),u=n({title:"",row:{},api:void 0}),M=()=>{f.value=!0,v.value=!1,c.value=!0},U=l=>{u.value=l,m.value=!0,K(l.row.id)},_=n([]),V=n([]),K=l=>{H({roleId:l}).then(e=>{_.value=e.data.menuLists,V.value=e.data.selectIds,z(()=>{V.value.forEach(i=>{const p=s.value.getNode(i);p&&s.value.setChecked(p,!0,!1)})})})},g=async()=>{try{const l=s.value.getCheckedKeys(),e=s.value.getHalfCheckedKeys();if(u.value.row.id===1&&D)return I.warning({message:"预览环境，禁止修改超级管理员权限，请谅解！"});await u.value.api({roleId:u.value.row.id,menuIds:[...l,...e]}),I.success({message:`${u.value.title}成功！`}),m.value=!1}catch(l){console.log(l)}};return P({acceptParams:U}),(l,e)=>{var y;const i=d("el-checkbox"),p=d("el-form-item"),$=d("el-tag"),B=d("el-tree"),T=d("el-form"),x=d("el-button"),A=d("el-dialog");return b(),w(A,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),title:`${u.value.title}-${(y=u.value.row)==null?void 0:y.roleName}`,"destroy-on-close":!0,width:"600px",onClose:M,"append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[a(x,{onClick:e[4]||(e[4]=o=>m.value=!1)},{default:t(()=>e[10]||(e[10]=[r(" 取消 ")])),_:1}),a(x,{type:"primary",onClick:g},{default:t(()=>e[11]||(e[11]=[r(" 确定 ")])),_:1})]),default:t(()=>[a(T,{"label-width":"100px","label-suffix":" :",onSubmit:W(g,["prevent"])},{default:t(()=>[a(p,null,{default:t(()=>[a(i,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),onChange:E},{default:t(()=>e[6]||(e[6]=[r(" 展开/折叠 ")])),_:1},8,["modelValue"]),a(i,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),onChange:R},{default:t(()=>e[7]||(e[7]=[r(" 全选/全不选 ")])),_:1},8,["modelValue"]),a(i,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o)},{default:t(()=>e[8]||(e[8]=[r(" 父子联动 ")])),_:1},8,["modelValue"]),a(i,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o)},{default:t(()=>e[9]||(e[9]=[r(" 权限标识 ")])),_:1},8,["modelValue"])]),_:1}),a(p,{label:"权限"},{default:t(()=>[a(B,{data:_.value,"show-checkbox":"",ref_key:"treeRef",ref:s,"node-key":"id","default-expand-all":f.value,"check-strictly":!c.value,props:S,"empty-text":"加载中，请稍候"},{default:t(({node:o,data:C})=>[N("span",q,[N("span",null,h(o.label),1),C.permissions&&k.value?(b(),w($,{key:0,style:{"margin-left":"10px"},size:"small"},{default:t(()=>[r(h(C.permissions),1)]),_:2},1024)):j("",!0)])]),_:1},8,["data","default-expand-all","check-strictly"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}});export{O as _};
