import{d as B,r as f,f as V,g as H,o as s,c as J,j as y,k as r,i as d,x as m,u as p,a_ as _,y as c,a$ as x,D as O,b0 as h,eo as j,b1 as q}from"./index-DTkCE7MD.js";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{_ as K,g as z,a as G,c as Q,u as U,r as E,i as W,e as X}from"./MetaCategoryForm.vue_vue_type_script_setup_true_lang-DV-chS_1.js";import{u as A}from"./useHandleData-BdxQ-8Ab.js";import{I as Y,d as Z,u as ee}from"./common-DxSkM119.js";import"./sortable.esm-Cw1ESr5Y.js";const te={class:"table-box"},pe=B({name:"MetaCategoryView",__name:"index",setup(ae){const n=f(),D=[{type:"selection",width:80},{prop:"name",label:"分类名称",align:"left"},{prop:"sort",label:"排序",width:60,align:"left"},{prop:"enable",label:"启用"},{prop:"lock",label:"是否锁定"},{prop:"remark",label:"备注"},{prop:"operation",label:"操作",width:250,fixed:"right"}],$=[{prop:"name",label:"分类名称",el:"input"},{prop:"enable",label:"启用",el:"select",enum:[{label:"是",value:!0},{label:"否",value:!1}]},{prop:"lock",label:"是否锁定",el:"select",enum:[{label:"是",value:!0},{label:"否",value:!1}]}],g=f(!0),L=t=>{let e=v(t);return z({...e,appendRoot:!1})},v=t=>{let e=JSON.parse(JSON.stringify(t));return e.createTime&&(e.createTimeStart=e.createTime[0]),e.createTime&&(e.createTimeEnd=e.createTime[1]),delete e.createTime,e.updateTime&&(e.updateTimeStart=e.updateTime[0]),e.updateTime&&(e.updateTimeEnd=e.updateTime[1]),delete e.updateTime,e},M=()=>{var t;g.value=!g.value,(t=n.value)==null||t.refresh()},P=(t={},e)=>{var l,o,i;let a;return e==0?a=((o=(l=n.value)==null?void 0:l.tableData)==null?void 0:o.length)||0:a=((i=t==null?void 0:t.children)==null?void 0:i.length)||0,(a+1)*100},k=f(),b=async(t,e={},a=!0)=>{var i,T;let l={};if(a){let u=e.id||0;const N=P(e,u);l={pid:u,sort:N}}else{const u=await G({id:e==null?void 0:e.id});l=u==null?void 0:u.data}const o={title:t,row:{...l},api:a?Q:U,getTableList:(i=n.value)==null?void 0:i.getTableList};(T=k.value)==null||T.acceptParams(o)},R=async t=>{var e;await A(E,{ids:[t.id]},`删除【${t.name||t.id}】分类及其所有子分类（此操作不可逆请谨慎操作！）`,"error"),(e=n.value)==null||e.getTableList()},w=async t=>{var e,a;await A(E,{ids:t},"删除所选分类及其所有子分类（此操作不可逆请谨慎操作！）","error"),(e=n.value)==null||e.clearSelection(),(a=n.value)==null||a.getTableList()},C=f(),I=()=>{var e,a;const t={title:"分类",templateName:"分类",tempApi:Z,importApi:W,getTableList:(e=n.value)==null?void 0:e.getTableList};(a=C.value)==null||a.acceptParams(t)},S=async()=>{var e;let t=v((e=n.value)==null?void 0:e.searchParam);ee(X,"分类",t)};return(t,e)=>{const a=V("el-button"),l=H("auth");return s(),J("div",te,[y(F,{ref_key:"proTableRef",ref:n,title:"分类",indent:20,columns:D,"search-columns":$,"request-api":L,"row-key":"id",pagination:!1,border:!1,"default-expand-all":g.value},{tableHeader:r(o=>[d((s(),m(a,{type:"primary",icon:p(_),onClick:e[0]||(e[0]=i=>b("新增分类"))},{default:r(()=>e[1]||(e[1]=[c(" 新增 ")])),_:1},8,["icon"])),[[l,"meta.category.create"]]),d((s(),m(a,{type:"danger",icon:p(x),plain:"",disabled:!o.isSelected,onClick:i=>w(o.selectedListIds)},{default:r(()=>e[2]||(e[2]=[c(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[l,"meta.category.remove"]]),d((s(),m(a,{type:"primary",icon:p(O),plain:"",onClick:I},{default:r(()=>e[3]||(e[3]=[c(" 导入 ")])),_:1},8,["icon"])),[[l,"meta.category.import"]]),d((s(),m(a,{type:"primary",icon:p(h),plain:"",onClick:S},{default:r(()=>e[4]||(e[4]=[c(" 导出 ")])),_:1},8,["icon"])),[[l,"meta.category.export"]]),y(a,{type:"info",icon:p(j),onClick:M},{default:r(()=>e[5]||(e[5]=[c(" 展开/折叠 ")])),_:1},8,["icon"])]),operation:r(({row:o})=>[d((s(),m(a,{type:"primary",link:"",icon:p(_),onClick:i=>b("新增分类",o)},{default:r(()=>e[6]||(e[6]=[c(" 新增 ")])),_:2},1032,["icon","onClick"])),[[l,"meta.category.create"]]),d((s(),m(a,{type:"primary",link:"",icon:p(q),onClick:i=>b("编辑分类",o,!1)},{default:r(()=>e[7]||(e[7]=[c(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[l,"meta.category.update"]]),d((s(),m(a,{type:"primary",link:"",icon:p(x),onClick:i=>R(o)},{default:r(()=>e[8]||(e[8]=[c(" 删除 ")])),_:2},1032,["icon","onClick"])),[[l,"meta.category.remove"]])]),_:1},8,["default-expand-all"]),y(K,{ref_key:"metaCategoryRef",ref:k},null,512),y(Y,{ref_key:"ImportExcelRef",ref:C},null,512)])}}});export{pe as default};
