import{h as f,bF as g,d as U,b as A,r as V,e as T,w as D,f as v,o as k,x as E,z as L,_ as F,aB as q,k as i,j as r,y as P,T as B,a as N,W as S}from"./index-DTkCE7MD.js";const O=t=>f.get(g+"/meta-region/listAll",t),X=t=>f.post(g+"/meta-region/create",t),Y=t=>f.put(g+"/meta-region/update",t),H=t=>f.delete(g+"/meta-region/remove",t),$=t=>f.get(g+"/meta-region/detail",t),J=(t,b)=>f.upload(g+"/meta-region/import",t,b),K=t=>f.download(g+"/meta-region/export",t),j=U({__name:"RegionSelect",props:{modelValue:{},width:{default:"100%"},placeholder:{default:"请选择区域"},disabled:{type:Boolean,default:!1},level:{},excludeIds:{}},emits:["update:modelValue","change"],setup(t,{expose:b,emit:R}){const n=t,e=R,x=A({get:()=>n.modelValue,set:s=>e("update:modelValue",s||null)}),_=V([]),y=V(!1),I={value:"id",label:"name",children:"children"},h=s=>{const p=new Map,w=[];return s.forEach(a=>{var c;!a.id||a.name===void 0||(c=n.excludeIds)!=null&&c.includes(a.id)||n.level&&a.level!==void 0&&a.level>n.level||p.set(a.id,{id:a.id,name:a.name,level:a.level||0,parentId:a.parentId||0,children:[]})}),s.forEach(a=>{var C;if(!a.id||a.name===void 0||(C=n.excludeIds)!=null&&C.includes(a.id)||n.level&&a.level!==void 0&&a.level>n.level)return;const c=p.get(a.id);if(!c)return;const o=a.parentId||0;if(o===0||!p.has(o))w.push(c);else{const M=p.get(o);M&&(M.children=M.children||[],M.children.push(c))}}),w},u=A(()=>h(_.value)),l=async()=>{try{y.value=!0;const s=await O();_.value=s.data||[]}catch(s){console.error("获取区域数据失败:",s),_.value=[]}finally{y.value=!1}},d=s=>{e("change",s)},m=()=>{l()};return T(()=>{l()}),D(()=>n.excludeIds,()=>{},{deep:!0}),b({refresh:m}),(s,p)=>{const w=v("el-tree-select");return k(),E(w,{modelValue:x.value,"onUpdate:modelValue":p[0]||(p[0]=a=>x.value=a),data:u.value,props:I,"check-strictly":"","render-after-expand":!1,placeholder:"请选择区域",filterable:"",clearable:"",style:L({width:s.width}),onChange:d},null,8,["modelValue","data","style"])}}}),z=F(j,[["__scopeId","data-v-934ca4f7"]]),W=U({name:"MetaRegionForm",__name:"MetaRegionForm",setup(t,{expose:b}){const R=q({name:[{required:!0,message:"请填写地址名"}],pinyin:[{required:!0,message:"请填写地址拼音"}],pinyinPrefix:[{required:!0,message:"请填写拼音前缀"}],enable:[{required:!0,message:"请选择是否启用"}],tenantId:[{required:!0,message:"请填写租户ID"}]}),n=V(!1),e=V({title:"",row:{},api:void 0,getTableList:void 0}),x=A(()=>{var u;return(u=e.value.row)!=null&&u.id?[e.value.row.id]:[]}),_=async u=>{if(!u)e.value.row.parentId=0,e.value.row.level=1,e.value.row.ancestors="0";else try{const d=(await $({id:Number(u)})).data;if(d){e.value.row.parentId=u,e.value.row.level=(d.level||0)+1;const m=d.ancestors||"0";e.value.row.ancestors=m+","+u}}catch(l){console.error("获取父区域详情失败:",l),S.warning("获取父区域信息失败，请重新选择")}},y=u=>{e.value=u,!e.value.row.parentId&&e.value.row.parentId!==0&&(e.value.row.parentId=0),e.value.row.level||(e.value.row.level=1),e.value.row.ancestors||(e.value.row.ancestors="0"),e.value.row.enable===void 0&&(e.value.row.enable=!0),e.value.row.tenantId||(e.value.row.tenantId="GLOWXQ"),n.value=!0},I=V(),h=()=>{I.value.validate(async u=>{if(u)try{e.value.row.parentId&&typeof e.value.row.parentId=="string"&&(e.value.row.parentId=Number(e.value.row.parentId)),await e.value.api(e.value.row),S.success({message:`${e.value.title}成功！`}),e.value.getTableList(),n.value=!1}catch(l){console.log(l)}})};return b({acceptParams:y}),(u,l)=>{const d=v("el-form-item"),m=v("el-input"),s=v("el-input-number"),p=v("el-switch"),w=v("el-form"),a=v("el-button"),c=v("el-dialog");return k(),E(c,{modelValue:n.value,"onUpdate:modelValue":l[7]||(l[7]=o=>n.value=o),title:`${e.value.title}`,"destroy-on-close":!0,width:"580px",draggable:""},{footer:i(()=>[r(a,{onClick:l[6]||(l[6]=o=>n.value=!1)},{default:i(()=>l[9]||(l[9]=[P(" 取消")])),_:1}),r(a,{type:"primary",onClick:h},{default:i(()=>l[10]||(l[10]=[P(" 确定")])),_:1})]),default:i(()=>[r(w,{ref_key:"ruleFormRef",ref:I,"label-width":"140px","label-suffix":" :",rules:R,model:e.value.row,onSubmit:B(h,["prevent"])},{default:i(()=>[r(d,{label:"父区域",prop:"parentId"},{default:i(()=>[r(z,{modelValue:e.value.row.parentId,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.row.parentId=o),placeholder:"请选择父区域，不选择则为顶级区域","exclude-ids":x.value,onChange:_},null,8,["modelValue","exclude-ids"])]),_:1}),r(d,{label:"地址名",prop:"name"},{default:i(()=>[r(m,{modelValue:e.value.row.name,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.row.name=o),placeholder:"请填写地址名",clearable:""},null,8,["modelValue"])]),_:1}),r(d,{label:"地址拼音",prop:"pinyin"},{default:i(()=>[r(m,{modelValue:e.value.row.pinyin,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.row.pinyin=o),placeholder:"请填写地址拼音",clearable:""},null,8,["modelValue"])]),_:1}),r(d,{label:"拼音前缀",prop:"pinyinPrefix"},{default:i(()=>[r(m,{modelValue:e.value.row.pinyinPrefix,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.row.pinyinPrefix=o),placeholder:"请填写拼音前缀",clearable:""},null,8,["modelValue"])]),_:1}),r(d,{label:"地址等级",prop:"level"},{default:i(()=>[r(s,{modelValue:e.value.row.level,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.row.level=o),precision:0,min:0,max:5,placeholder:"系统自动计算",disabled:""},null,8,["modelValue"]),l[8]||(l[8]=N("div",{class:"form-tip"},"系统根据父区域自动计算等级",-1))]),_:1}),r(d,{label:"启用",prop:"enable"},{default:i(()=>[r(p,{modelValue:e.value.row.enable,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.row.enable=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),G=F(W,[["__scopeId","data-v-08dbc575"]]),Z=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{G as M,$ as a,Z as b,X as c,K as e,O as g,J as i,H as r,Y as u};
