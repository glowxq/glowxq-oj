var P=Object.defineProperty;var $=(n,s,a)=>s in n?P(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var U=(n,s,a)=>$(n,typeof s!="symbol"?s+"":s,a);import{aV as m,d as k,r as y,o as z,x as I,k as i,j as r,u as D,b0 as M,y as E,bK as C,a as h,t as R,f as c,_ as j,h as A,aP as q}from"./index-DTkCE7MD.js";const K=async(n,s,a={},b=!0)=>{var d,e;b&&m({title:"温馨提示",message:"如果数据庞大会导致下载缓慢哦，请您耐心等待！",type:"info",duration:3e3});try{a||(a={templateName:s});const u=await n(a),f=u.headers["content-disposition"],v=decodeURIComponent(((e=(d=f==null?void 0:f.match(/filename\*?=(?:UTF-8'')?([^;]+)?/))==null?void 0:d[1])==null?void 0:e.replace(/['"]/g,""))||"下载文件"),x=new Blob([u.data],{type:u.headers["content-type"]}),g=window.URL.createObjectURL(x);if("msSaveOrOpenBlob"in navigator)return window.navigator.msSaveOrOpenBlob(x,v);const p=document.createElement("a");p.style.display="none",p.download=v,p.href=g,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(g)}catch(u){console.log(u)}},G={class:"el-upload__tip"},H=k({name:"ImportExcel",__name:"index",setup(n,{expose:s}){const a=y(!1),b=y(1),d=y(!1),e=y({title:"",fileSize:5,fileType:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],templateFileType:".xlsx"}),u=o=>{e.value={...e.value,...o},d.value=!0},f=()=>{if(!e.value.tempApi)return;const o=e.value.templateFileType,t=e.value.templateName?e.value.templateName:e.value.title;K(e.value.tempApi,`${t}模板`,{templateName:t+o})},v=async o=>{let t=new FormData;t.append("file",o.file),t.append("isCover",a.value),await e.value.importApi(t,{onUploadProgress(l){const _=new ProgressEvent("upload",{lengthComputable:l.total!==void 0,loaded:l.loaded||0,total:l.total||0});o.onProgress(new V(_))}}),e.value.getTableList&&e.value.getTableList(),d.value=!1},x=o=>{const t=e.value.fileType.includes(o.type),l=o.size/1024/1024<e.value.fileSize;return t||m({title:"温馨提示",message:"上传文件只能是 xls / xlsx 格式！",type:"warning"}),l||setTimeout(()=>{m({title:"温馨提示",message:`上传文件大小不能超过 ${e.value.fileSize}MB！`,type:"warning"})},0),t&&l},g=()=>{m({title:"温馨提示",message:"最多只能上传一个文件！",type:"warning"})},p=()=>{m({title:"温馨提示",message:`导入${e.value.title}失败，请您重新上传！`,type:"error"})},T=()=>{m({title:"温馨提示",message:`导入${e.value.title}成功！`,type:"success"})};class V extends ProgressEvent{constructor(l){super(l.type,l);U(this,"percent");this.percent=l.lengthComputable?Math.round(l.loaded/l.total*100):0}}return s({acceptParams:u}),(o,t)=>{const l=c("el-button"),_=c("el-form-item"),N=c("upload-filled"),S=c("el-icon"),L=c("el-upload"),B=c("el-switch"),F=c("el-form"),O=c("el-dialog");return z(),I(O,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=w=>d.value=w),title:`导入${e.value.title}`,"destroy-on-close":!0,width:"580px",draggable:""},{default:i(()=>[r(F,{class:"drawer-multiColumn-form","label-width":"100px"},{default:i(()=>[r(_,{label:"模板下载 :"},{default:i(()=>[r(l,{type:"primary",icon:D(M),onClick:f},{default:i(()=>t[2]||(t[2]=[E(" 点击下载 ")])),_:1},8,["icon"])]),_:1}),r(_,{label:"文件上传 :"},{default:i(()=>[r(L,{action:"#",class:"upload",drag:!0,limit:b.value,multiple:!0,"show-file-list":!0,"http-request":v,"before-upload":x,"on-exceed":g,"on-success":T,"on-error":p,accept:e.value.fileType.join(",")},{tip:i(()=>[C(o.$slots,"tip",{},()=>[h("div",G,"请上传 .xls , .xlsx 标准格式文件，文件最大为 "+R(e.value.fileSize)+"M",1)],!0)]),default:i(()=>[C(o.$slots,"empty",{},()=>[r(S,{class:"el-icon--upload"},{default:i(()=>[r(N)]),_:1}),t[3]||(t[3]=h("div",{class:"el-upload__text"},[E("将文件拖到此处，或"),h("em",null,"点击上传")],-1))],!0)]),_:3},8,["limit","accept"])]),_:3}),r(_,{label:"数据覆盖 :"},{default:i(()=>[r(B,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=w=>a.value=w)},null,8,["modelValue"])]),_:1})]),_:3})]),_:3},8,["modelValue","title"])}}}),W=j(H,[["__scopeId","data-v-cb6ae668"]]),X=n=>A.template(q+"/common/download/templates",n);export{W as I,X as d,K as u};
