import{d as te,bc as ae,r as s,aB as oe,f as n,o as c,x as m,k as l,j as t,y as b,u as $,e4 as se,T as ne,c as q,P as j,Q,m as ue,a as u,n as W,V as A,W as x,_ as de}from"./index-DTkCE7MD.js";const re={class:"card-header min-header"},ce={class:"tree-container"},ie={class:"card-header min-header"},pe={class:"tree-container"},ve={class:"card-header"},fe={class:"tree-container"},me=te({name:"SysDataRoleForm",__name:"DataRoleForm",setup(_e,{expose:G}){const H=ae(),i=s(!1),_=s(!1),D=s([]),h=s([]),T=s([]),k=s(),M={children:"children",label:"title",value:"id"},I=s(!0),N=s(!0),L=s([]),R=s([]),v=s(),J={label:"name",value:"id"},g=s(!0),V=s(!0),X=d=>{i.value=d==1006005,a.value.row.userOptions=[]},Y=oe({roleName:[{required:!0,message:"请填写角色名称"}],dataScope:[{required:!0,message:"请选择数据权限"}]}),w=s(!1),a=s({title:"",row:{},api:void 0,getTableList:void 0}),Z=d=>{a.value=d,w.value=!0,h.value=d.meta.menuLists,L.value=d.meta.deptLists,D.value=d.meta.userOptions,a.value.row.dataScopeCd?i.value=a.value.row.dataScopeCd==1006005:i.value=!1,a.value.row.isLock?_.value=a.value.row.isLock=="T":_.value=!1,a.value.row.selectMenuIds&&a.value.row.selectMenuIds.length>0&&(T.value=a.value.row.selectMenuIds,A(()=>{T.value.forEach(e=>{const r=k.value.getNode(e);k.value.setChecked(r,!0,!1)})})),i.value&&a.value.row.selectDeptIds&&a.value.row.selectDeptIds.length>0&&(R.value=a.value.row.selectDeptIds,A(()=>{R.value.forEach(e=>{const r=v.value.getNode(e);v.value.setChecked(r,!0,!1)})}))},O=s(),E=()=>{O.value.validate(async d=>{var e;if(d){if(_.value){x.warning("当前表单已锁定，禁止修改！");return}try{const r=k.value.getCheckedKeys();let p=[];if(r.length<1){x.error("请选择有效的数据。菜单列表不能为空");return}if(i.value&&(p=v.value.getCheckedKeys(),p.length<1&&((e=a.value.row)==null?void 0:e.userOptions.length)<1)){x.error("请选择有效的数据。用户纬度和部门纬度至少有一个不能为空");return}a.value.row.selectMenuIds=r,a.value.row.selectDeptIds=p,await a.value.api(a.value.row),x.success({message:`${a.value.title}成功！`}),a.value.getTableList(),w.value=!1}catch(r){console.log(r)}}})},ee=d=>{for(let e in v.value.store.nodesMap)v.value.store.nodesMap[e].expanded=d};return G({acceptParams:Z}),(d,e)=>{const r=n("el-input"),p=n("el-form-item"),f=n("el-col"),F=n("el-option"),U=n("el-select"),y=n("el-row"),B=n("el-tooltip"),P=n("el-space"),C=n("el-tree"),S=n("el-card"),K=n("el-checkbox"),z=n("el-button"),le=n("el-dialog");return c(),m(le,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o),title:`${a.value.title}`,"destroy-on-close":!0,"close-on-press-escape":!1,"close-on-click-modal":!1,width:"800px"},{footer:l(()=>[t(z,{onClick:e[5]||(e[5]=o=>w.value=!1)},{default:l(()=>e[14]||(e[14]=[b(" 取消 ")])),_:1}),t(z,{type:"primary",onClick:E},{default:l(()=>e[15]||(e[15]=[b(" 确定 ")])),_:1})]),default:l(()=>[t($(se),{ref_key:"ruleFormRef",ref:O,"label-width":"100px","label-suffix":" :",rules:Y,model:a.value.row,onSubmit:ne(E,["prevent"])},{default:l(()=>[t(y,null,{default:l(()=>[t(f,{span:12},{default:l(()=>[t(p,{label:"角色名称",prop:"roleName"},{default:l(()=>[t(r,{modelValue:a.value.row.roleName,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.row.roleName=o),placeholder:"请填写角色名称",clearable:"",disabled:_.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t(f,{span:12},{default:l(()=>[t(p,{label:"数据权限",prop:"dataScopeCd"},{default:l(()=>[t(U,{modelValue:a.value.row.dataScopeCd,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.row.dataScopeCd=o),clearable:"",placeholder:"请选择数据权限",onChange:X,disabled:_.value},{default:l(()=>[(c(!0),q(j,null,Q($(H).getDictOptions("data_scope"),o=>(c(),m(F,{key:o.id,label:o.codeName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(y,null,{default:l(()=>[t(f,null,{default:l(()=>[i.value?(c(),m(p,{key:0,label:"用户维度",prop:"userOptions"},{default:l(()=>[t(U,{modelValue:a.value.row.userOptions,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.row.userOptions=o),clearable:"",multiple:"",filterable:"",placeholder:"请选择用户"},{default:l(()=>[(c(!0),q(j,null,Q(D.value,o=>(c(),m(F,{key:o.id,label:o.nickname,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):ue("",!0)]),_:1})]),_:1}),i.value?(c(),m(y,{key:0},{default:l(()=>[t(f,{span:11,style:{"margin-left":"30px"}},{default:l(()=>[t(S,{shadow:"never"},{header:l(()=>[u("div",re,[t(P,{size:4},{default:l(()=>[e[8]||(e[8]=u("span",null,"菜单列表",-1)),t(B,{effect:"dark",content:"展示[菜单管理]中属性[数据权限支持]选中状态的记录",placement:"top"},{default:l(()=>e[7]||(e[7]=[u("i",{class:W("iconfont icon-yiwen")},null,-1)])),_:1})]),_:1})])]),default:l(()=>[u("div",ce,[t(C,{data:h.value,"show-checkbox":"",ref_key:"menuTreeRef",ref:k,"node-key":"id",props:M,"empty-text":"加载中，请稍候","default-expand-all":I.value,"check-strictly":!N.value},null,8,["data","default-expand-all","check-strictly"])])]),_:1})]),_:1}),t(f,{span:12},{default:l(()=>[t(S,{shadow:"never",style:{"margin-left":"25px"}},{header:l(()=>[u("div",ie,[e[11]||(e[11]=u("span",null,"部门维度",-1)),u("div",null,[t(K,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),onChange:ee},{default:l(()=>e[9]||(e[9]=[b(" 展开/折叠 ")])),_:1},8,["modelValue"]),t(K,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=o=>V.value=o)},{default:l(()=>e[10]||(e[10]=[b(" 父子联动 ")])),_:1},8,["modelValue"])])])]),default:l(()=>[u("div",pe,[u("div",null,[t(C,{data:L.value,"show-checkbox":"",ref_key:"deptTreeRef",ref:v,"node-key":"id",props:J,"empty-text":"加载中，请稍候","default-expand-all":g.value,"check-strictly":!V.value},null,8,["data","default-expand-all","check-strictly"])])])]),_:1})]),_:1})]),_:1})):(c(),m(y,{key:1},{default:l(()=>[t(f,null,{default:l(()=>[t(S,{shadow:"never"},{header:l(()=>[u("div",ve,[t(P,{size:4},{default:l(()=>[e[13]||(e[13]=u("span",null,"菜单列表",-1)),t(B,{effect:"dark",content:"展示[菜单管理]中属性[数据权限支持]选中状态的记录",placement:"top"},{default:l(()=>e[12]||(e[12]=[u("i",{class:W("iconfont icon-yiwen")},null,-1)])),_:1})]),_:1})])]),default:l(()=>[u("div",fe,[t(C,{data:h.value,"show-checkbox":"",ref_key:"menuTreeRef",ref:k,"node-key":"id",props:M,"empty-text":"加载中，请稍候","default-expand-all":I.value,"check-strictly":!N.value},null,8,["data","default-expand-all","check-strictly"])])]),_:1})]),_:1})]),_:1}))]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),we=de(me,[["__scopeId","data-v-ec3a6aeb"]]);export{we as default};
