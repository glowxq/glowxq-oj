import{d as Q,r as k,aB as W,f as b,g as G,o as r,c as v,a as L,j as n,k as o,i as c,x as m,u as s,a_ as K,y as p,a$ as S,dL as E,D as X,b0 as Z,b2 as ee,b1 as te,aQ as ae,ap as ie,R as oe,dN as re,W as T,aa as le,dO as ne,_ as se}from"./index-DTkCE7MD.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{a as de,g as ce,c as me,u as ue,r as U,i as fe,e as be}from"./userInfo-CIsM0YAT.js";import{u as N}from"./useHandleData-BdxQ-8Ab.js";import ve from"./UserInfoForm-B6W1vnKT.js";import{I as ge,d as _e,u as ye}from"./common-DxSkM119.js";import{U as ke,a as Te}from"./UserDetail-CYpDyPH0.js";import{S as xe}from"./Sex-CCT3w392.js";import"./sortable.esm-Cw1ESr5Y.js";import"./Img-CbqiKKTP.js";import"./upload-BtJOZC1L.js";import"./ColorSelect-DZmuTeqD.js";import"./role-B65lK4x8.js";import"./EnumSelect-C2fXZs6G.js";const we={class:"main-box"},he={class:"table-box"},Ce={class:"el-dropdown"},Ie={key:1,class:"no-avatar"},De={key:1,class:"no-image"},Le=Q({name:"UserInfoView",__name:"index",setup(Se){const l=k(),w=k(),R=W({}),$=()=>{var t;(t=l.value)!=null&&t.pageable&&(l.value.pageable.pageSize=10)},A=[{type:"selection",width:60},{prop:"userId",label:"ID",width:60},{prop:"name",label:"姓名"},{prop:"nickName",label:"昵称"},{prop:"phone",label:"手机号",width:120},{prop:"avatar",label:"头像",width:80,render:t=>t.row.avatar||"-"},{prop:"sex",label:"性别",width:60,render:t=>t.row.sex||"-"},{prop:"birthday",label:"生日",width:120},{prop:"image",label:"相关图片",width:100,render:t=>t.row.image||"-"},{prop:"acNum",label:"AC",width:60},{prop:"integral",label:"积分",width:60},{prop:"continuousSignDay",label:"连续签到",width:100},{prop:"submitNum",label:"提交题目",width:100},{prop:"titleColor",label:"称号",width:120,render:t=>t.row.titleColor||"-"},{prop:"expirationTime",label:"过期时间",width:120},{prop:"lastLoginTime",label:"最后登录",width:120},{prop:"remark",label:"备注",width:120},{prop:"operation",label:"操作",width:200,fixed:"right"}],P=[{prop:"name",label:"姓名",el:"input"},{prop:"nickName",label:"昵称",el:"input"},{prop:"phone",label:"手机号",el:"input"},{prop:"expirationTime",label:"帐号过期时间",el:"date-picker",span:2,props:{type:"datetimerange",valueFormat:"YYYY-MM-DD HH:mm:ss"}},{prop:"lastLoginTime",label:"最后登录时间",el:"date-picker",span:2,props:{type:"datetimerange",valueFormat:"YYYY-MM-DD HH:mm:ss"}}],M=t=>{let e=h(t);return de(e)},h=t=>{let e=JSON.parse(JSON.stringify(t));return e.birthday&&(e.birthdayStart=e.birthday[0]),e.birthday&&(e.birthdayEnd=e.birthday[1]),delete e.birthday,e.expirationTime&&(e.expirationTimeStart=e.expirationTime[0]),e.expirationTime&&(e.expirationTimeEnd=e.expirationTime[1]),delete e.expirationTime,e.lastLoginTime&&(e.lastLoginTimeStart=e.lastLoginTime[0]),e.lastLoginTime&&(e.lastLoginTimeEnd=e.lastLoginTime[1]),delete e.lastLoginTime,e.createTime&&(e.createTimeStart=e.createTime[0]),e.createTime&&(e.createTimeEnd=e.createTime[1]),delete e.createTime,e.updateTime&&(e.updateTimeStart=e.updateTime[0]),e.updateTime&&(e.updateTimeEnd=e.updateTime[1]),delete e.updateTime,e},C=k(),x=async(t,e={},i=!0)=>{var _,y;if(!i){const f=await ce({id:e==null?void 0:e.id});e=f==null?void 0:f.data}const g={title:t,row:{...e},api:i?me:ue,getTableList:(_=l.value)==null?void 0:_.getTableList};(y=C.value)==null||y.acceptParams(g)},F=async t=>{var e;await N(U,{ids:[t.id]},`删除【${t.id}】用户信息`),(e=l.value)==null||e.getTableList()},Y=async t=>{var e,i;await N(U,{ids:t},"删除所选用户信息"),(e=l.value)==null||e.clearSelection(),(i=l.value)==null||i.getTableList()},I=async t=>{var e;try{await re({ids:t}),T.success("解锁成功！"),(e=l.value)==null||e.getTableList()}catch(i){console.error("解锁失败:",i),T.error("解锁失败，请重试")}},B=async t=>{var e;await I(t),(e=l.value)==null||e.clearSelection()},H=async t=>{if(!t.userId){T.warning("用户ID不存在，无法重置密码");return}const e={id:t.userId};le.confirm("您确认要重置用户 ["+(t.name||t.nickName)+"] 的密码?","温馨提示",{type:"warning"}).then(async()=>{var i;await ne(e),(i=l.value)==null||i.getTableList(),T.success({message:"用户 ["+(t.name||t.nickName)+"] 重置密码成功！",duration:5e3,showClose:!0})})},z=()=>{var t,e;(t=l.value)==null||t.getTableList(),(e=l.value)==null||e.clearSelection()},D=k(),V=()=>{var e,i;const t={title:"用户信息",templateName:"用户信息",tempApi:_e,importApi:fe,getTableList:(e=l.value)==null?void 0:e.getTableList};(i=D.value)==null||i.acceptParams(t)},O=async()=>{var e;let t=h((e=l.value)==null?void 0:e.searchParam);ye(be,"用户信息",t)},J=t=>{var e;(e=w.value)==null||e.openDetail(t)},j=t=>{x("编辑用户信息",t,!1)};return(t,e)=>{const i=b("el-button"),g=b("el-dropdown-item"),_=b("el-dropdown-menu"),y=b("el-dropdown"),f=b("el-image"),q=b("UserDeptForm"),d=G("auth");return r(),v("div",we,[L("div",he,[n(pe,{ref_key:"proTableRef",ref:l,title:"用户信息",indent:20,columns:A,"search-columns":P,"request-api":M,"init-param":R,"row-key":"id",onReset:$},{tableHeader:o(a=>[c((r(),m(i,{type:"primary",icon:s(K),onClick:e[0]||(e[0]=u=>x("新增用户信息"))},{default:o(()=>e[1]||(e[1]=[p(" 新增 ")])),_:1},8,["icon"])),[[d,"user.info.create"]]),c((r(),m(i,{type:"danger",icon:s(S),plain:"",disabled:!a.isSelected,onClick:u=>Y(a.selectedListIds)},{default:o(()=>e[2]||(e[2]=[p(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[d,"user.info.remove"]]),c((r(),m(i,{type:"info",icon:s(E),plain:"",disabled:!a.isSelected,onClick:u=>B(a.selectedListIds)},{default:o(()=>e[3]||(e[3]=[p(" 批量解锁 ")])),_:2},1032,["icon","disabled","onClick"])),[[d,"user.info.unlock"]]),c((r(),m(i,{type:"primary",icon:s(X),plain:"",onClick:V},{default:o(()=>e[4]||(e[4]=[p(" 导入 ")])),_:1},8,["icon"])),[[d,"user.info.import"]]),c((r(),m(i,{type:"primary",icon:s(Z),plain:"",onClick:O},{default:o(()=>e[5]||(e[5]=[p(" 导出 ")])),_:1},8,["icon"])),[[d,"user.info.export"]])]),operation:o(({row:a})=>[c((r(),m(i,{type:"primary",link:"",icon:s(ee),onClick:u=>J(a)},{default:o(()=>e[6]||(e[6]=[p(" 详情 ")])),_:2},1032,["icon","onClick"])),[[d,"user.info.detail"]]),c((r(),m(i,{type:"primary",link:"",icon:s(te),onClick:u=>x("编辑用户信息",a,!1)},{default:o(()=>e[7]||(e[7]=[p(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[d,"user.info.update"]]),c((r(),m(i,{type:"primary",icon:s(E),link:"",onClick:u=>a.userId&&I([a.userId])},{default:o(()=>e[8]||(e[8]=[p(" 解锁 ")])),_:2},1032,["icon","onClick"])),[[d,"user.info.unlock"]]),L("div",Ce,[n(y,{trigger:"click"},{dropdown:o(()=>[n(_,null,{default:o(()=>[c((r(),v("div",null,[n(g,{icon:s(ae),onClick:u=>H(a)},{default:o(()=>e[10]||(e[10]=[p(" 重置密码 ")])),_:2},1032,["icon","onClick"])])),[[d,"user.info.reset.password"]]),c((r(),v("div",null,[n(g,{icon:s(S),onClick:u=>F(a)},{default:o(()=>e[11]||(e[11]=[p(" 删除 ")])),_:2},1032,["icon","onClick"])])),[[d,"user.info.remove"]])]),_:2},1024)]),default:o(()=>[n(i,{type:"primary",link:"",icon:s(ie)},{default:o(()=>e[9]||(e[9]=[p(" 更多 ")])),_:1},8,["icon"])]),_:2},1024)])]),avatar:o(({row:a})=>[a.avatar?(r(),m(f,{key:0,src:a.avatar,style:{width:"50px",height:"50px","border-radius":"8px"},fit:"cover","preview-src-list":[a.avatar],"preview-teleported":"",lazy:""},null,8,["src","preview-src-list"])):(r(),v("span",Ie,"-"))]),image:o(({row:a})=>[a.image?(r(),m(f,{key:0,src:a.image,style:{width:"60px",height:"40px","border-radius":"6px"},fit:"cover","preview-src-list":[a.image],"preview-teleported":"",lazy:""},null,8,["src","preview-src-list"])):(r(),v("span",De,"-"))]),sex:o(({row:a})=>[n(oe,{enum:s(xe),code:a.sex,"background-color":a.sex==="Male"?"#e1f3ff":"#fce8f3",color:a.sex==="Male"?"#409eff":"#f56c6c","border-color":a.sex==="Male"?"#b3d8ff":"#fdb9cc","font-size":"12px",padding:"2px 6px","border-radius":"4px"},null,8,["enum","code","background-color","color","border-color"])]),titleColor:o(({row:a})=>[n(ke,{title:a.title,color:a.color,size:"small"},null,8,["title","color"])]),_:1},8,["init-param"]),n(ve,{ref_key:"userInfoRef",ref:C},null,512),n(ge,{ref_key:"ImportExcelRef",ref:D},null,512),n(q,{ref:"userDeptFormRef",onSubmit:z},null,512),n(Te,{ref_key:"userDetailRef",ref:w,onEdit:j},null,512)])])}}}),Oe=se(Le,[["__scopeId","data-v-60b53b0d"]]);export{Oe as default};
