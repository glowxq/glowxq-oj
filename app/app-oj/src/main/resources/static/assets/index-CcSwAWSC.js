import{d as Y,r as v,f as h,g as Z,o as c,c as S,j as d,k as a,i as b,x as C,u as m,a_ as ee,y as n,a$ as E,D as I,b0 as oe,a as o,t as r,T as A,b1 as te,b2 as le,b3 as ie,m as ae,b4 as _,b5 as se,b6 as z,b7 as ne,b8 as de,b9 as R,ba as re,bb as pe,W as j,_ as ue}from"./index-DTkCE7MD.js";import{_ as ve}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{u as U}from"./useHandleData-BdxQ-8Ab.js";import{_ as ce}from"./CodeMonitorForm.vue_vue_type_script_setup_true_lang-CjF-hk9O.js";import{I as me,d as ye,u as be}from"./common-DxSkM119.js";import"./sortable.esm-Cw1ESr5Y.js";const Ce={class:"table-box"},fe={class:"code-column"},_e={class:"code-preview"},ge={class:"code-column"},ke={class:"code-preview"},we={class:"code-container"},Te={class:"code-actions"},xe={class:"code-block"},Me={key:0,class:"detail-container"},Pe={class:"detail-section"},De={class:"detail-row"},$e={class:"detail-value"},Le={class:"detail-row"},Ne={class:"detail-value"},Ve={class:"detail-row"},he={class:"detail-value"},Se={class:"detail-row"},Ee={class:"detail-value"},Ie={class:"detail-section"},Ae={class:"detail-row"},ze={class:"detail-value"},Re={class:"detail-row"},je={class:"detail-value"},Ue={class:"detail-row"},Be={class:"detail-value"},He={class:"detail-section"},Je={class:"detail-code"},Oe={class:"code-header"},qe={class:"code-preview"},Fe={class:"detail-code"},We={class:"code-header"},Ge={class:"code-preview"},Ke={class:"detail-section"},Qe={class:"detail-row"},Xe={class:"detail-value"},Ye={class:"detail-row"},Ze={class:"detail-value"},eo=Y({name:"CodeMonitorView",__name:"index",setup(oo){const y=v(),B=[{type:"selection",width:80},{prop:"monitorUserId",label:"被用户id"},{prop:"overlayUserId",label:"覆盖用户id"},{prop:"monitorPhone",label:"被监控人电话"},{prop:"overlayPhone",label:"覆盖人电话"},{prop:"monitorName",label:"被监控人"},{prop:"overlayName",label:"覆盖人"},{prop:"monitorCode",label:"被监控代码",render:t=>_("div",{class:"code-column"},[_("span",{class:"code-preview"},t.row.monitorCode?t.row.monitorCode.substring(0,20)+"...":""),_("el-button",{type:"primary",link:!0,size:"small",onClick:e=>{e.stopPropagation(),f(t.row,"monitor")}},"查看代码")])},{prop:"overlayCode",label:"覆盖代码",render:t=>_("div",{class:"code-column"},[_("span",{class:"code-preview"},t.row.overlayCode?t.row.overlayCode.substring(0,20)+"...":""),_("el-button",{type:"primary",link:!0,size:"small",onClick:e=>{e.stopPropagation(),f(t.row,"overlay")}},"查看代码")])},{prop:"codeMode",label:"代码模式"},{prop:"monitorStatus",label:"监控状态"},{prop:"version",label:"版本"},{prop:"operation",label:"操作",width:330,fixed:"right"}],H=[{prop:"monitorUserId",label:"被用户id",el:"input"},{prop:"overlayUserId",label:"覆盖用户id",el:"input"},{prop:"monitorPhone",label:"被监控人电话",el:"input"},{prop:"overlayPhone",label:"覆盖人电话",el:"input"},{prop:"monitorName",label:"被监控人",el:"input"},{prop:"overlayName",label:"覆盖人",el:"input"},{prop:"monitorCode",label:"被监控代码",el:"input"},{prop:"overlayCode",label:"覆盖代码",el:"input"},{prop:"codeMode",label:"代码模式",el:"input"},{prop:"monitorStatus",label:"监控状态",el:"select"},{prop:"version",label:"版本",el:"input"}],J=t=>{let e=x(t);return se(e)},x=t=>{let e=JSON.parse(JSON.stringify(t));return e.createTime&&(e.createTimeStart=e.createTime[0]),e.createTime&&(e.createTimeEnd=e.createTime[1]),delete e.createTime,e.updateTime&&(e.updateTimeStart=e.updateTime[0]),e.updateTime&&(e.updateTimeEnd=e.updateTime[1]),delete e.updateTime,e},M=v(),P=async(t,e={},i=!0)=>{var u,l;if(!i){const p=await z({id:e==null?void 0:e.id});e=p==null?void 0:p.data}const w={title:t,row:{...e},api:i?ne:de,getTableList:(u=y.value)==null?void 0:u.getTableList};(l=M.value)==null||l.acceptParams(w)},O=async t=>{var e;await U(R,{ids:[t.id]},`删除【${t.id}】代码监控`),(e=y.value)==null||e.getTableList()},q=async t=>{var e,i;await U(R,{ids:t},"删除所选代码监控"),(e=y.value)==null||e.clearSelection(),(i=y.value)==null||i.getTableList()},D=v(),F=()=>{var e,i;const t={title:"代码监控",templateName:"代码监控",tempApi:ye,importApi:re,getTableList:(e=y.value)==null?void 0:e.getTableList};(i=D.value)==null||i.acceptParams(t)},W=async()=>{var e;let t=x((e=y.value)==null?void 0:e.searchParam);be(pe,"代码监控",t)},$=v(),L=t=>{var e;(e=$.value)==null||e.open(t)},T=v(!1),g=v(""),N=v(""),G=v("javascript"),f=(t,e)=>{N.value=e==="monitor"?"被监控代码":"覆盖代码",g.value=e==="monitor"?t.monitorCode||"":t.overlayCode||"",G.value=K(t.codeMode||""),T.value=!0},K=t=>({java:"java",javascript:"javascript",python:"python",c:"c",cpp:"cpp",csharp:"csharp",go:"go"})[t.toLowerCase()]||"javascript",k=v(!1),s=v(null),Q=t=>{t.id&&z({id:t.id}).then(e=>{e!=null&&e.data&&(s.value=e.data,k.value=!0)})},X=async()=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(g.value);else{const t=document.createElement("textarea");t.value=g.value,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),t.remove()}j.success("代码已复制到剪贴板")}catch(t){j.error("复制失败，请手动复制"),console.error("复制失败:",t)}},V=t=>{if(!t)return"暂无";try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return t}};return(t,e)=>{const i=h("el-button"),w=h("el-dialog"),u=Z("auth");return c(),S("div",Ce,[d(ve,{ref_key:"proTableRef",ref:y,title:"代码监控",indent:20,columns:B,"search-columns":H,"request-api":J,"row-key":"id"},{tableHeader:a(l=>[b((c(),C(i,{type:"primary",icon:m(ee),onClick:e[0]||(e[0]=p=>P("新增代码监控"))},{default:a(()=>e[7]||(e[7]=[n(" 新增 ")])),_:1},8,["icon"])),[[u,"code.monitor.create"]]),b((c(),C(i,{type:"danger",icon:m(E),plain:"",disabled:!l.isSelected,onClick:p=>q(l.selectedListIds)},{default:a(()=>e[8]||(e[8]=[n(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[u,"code.monitor.remove"]]),b((c(),C(i,{type:"primary",icon:m(I),plain:"",onClick:F},{default:a(()=>e[9]||(e[9]=[n(" 导入 ")])),_:1},8,["icon"])),[[u,"code.monitor.import"]]),b((c(),C(i,{type:"primary",icon:m(oe),plain:"",onClick:W},{default:a(()=>e[10]||(e[10]=[n(" 导出 ")])),_:1},8,["icon"])),[[u,"code.monitor.export"]])]),monitorCode:a(l=>[o("div",fe,[o("span",_e,r(l.row.monitorCode?l.row.monitorCode.substring(0,20)+"...":""),1),d(i,{type:"primary",link:"",size:"small",onClick:A(p=>f(l.row,"monitor"),["stop"])},{default:a(()=>e[11]||(e[11]=[n(" 查看代码 ")])),_:2},1032,["onClick"])])]),overlayCode:a(l=>[o("div",ge,[o("span",ke,r(l.row.overlayCode?l.row.overlayCode.substring(0,20)+"...":""),1),d(i,{type:"primary",link:"",size:"small",onClick:A(p=>f(l.row,"overlay"),["stop"])},{default:a(()=>e[12]||(e[12]=[n(" 查看代码 ")])),_:2},1032,["onClick"])])]),operation:a(({row:l})=>[b((c(),C(i,{type:"primary",link:"",icon:m(te),onClick:p=>P("编辑代码监控",l,!1)},{default:a(()=>e[13]||(e[13]=[n(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[u,"code.monitor.update"]]),d(i,{type:"primary",link:"",icon:m(le),onClick:p=>Q(l)},{default:a(()=>e[14]||(e[14]=[n(" 查看详情 ")])),_:2},1032,["icon","onClick"]),b((c(),C(i,{type:"primary",link:"",icon:m(I),onClick:p=>L(l)},{default:a(()=>e[15]||(e[15]=[n(" 推送代码 ")])),_:2},1032,["icon","onClick"])),[[u,"code.monitor.push"]]),b((c(),C(i,{type:"primary",link:"",icon:m(E),onClick:p=>O(l)},{default:a(()=>e[16]||(e[16]=[n(" 删除 ")])),_:2},1032,["icon","onClick"])),[[u,"code.monitor.remove"]])]),_:1},512),d(ce,{ref_key:"codeMonitorRef",ref:M},null,512),d(me,{ref_key:"ImportExcelRef",ref:D},null,512),d(ie,{ref_key:"pushCoverdCodeRef",ref:$},null,512),d(w,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=l=>T.value=l),title:N.value,width:"80%","destroy-on-close":"",class:"code-dialog"},{default:a(()=>[o("div",we,[o("div",Te,[d(i,{type:"primary",size:"small",onClick:X},{default:a(()=>e[17]||(e[17]=[n(" 复制代码 ")])),_:1})]),o("pre",xe,[o("code",null,r(g.value),1)])])]),_:1},8,["modelValue","title"]),d(w,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),title:"代码监控详情",width:"650px","destroy-on-close":"",class:"detail-dialog"},{footer:a(()=>[d(i,{onClick:e[4]||(e[4]=l=>k.value=!1)},{default:a(()=>e[35]||(e[35]=[n("关闭")])),_:1}),d(i,{type:"primary",onClick:e[5]||(e[5]=l=>L(s.value))},{default:a(()=>e[36]||(e[36]=[n(" 推送代码 ")])),_:1})]),default:a(()=>[s.value?(c(),S("div",Me,[o("div",Pe,[e[22]||(e[22]=o("h3",{class:"section-title"},"基本信息",-1)),o("div",De,[e[18]||(e[18]=o("div",{class:"detail-label"},"被监控人：",-1)),o("div",$e,r(s.value.monitorName||"暂无"),1)]),o("div",Le,[e[19]||(e[19]=o("div",{class:"detail-label"},"被监控人电话：",-1)),o("div",Ne,r(s.value.monitorPhone||"暂无"),1)]),o("div",Ve,[e[20]||(e[20]=o("div",{class:"detail-label"},"覆盖人：",-1)),o("div",he,r(s.value.overlayName||"暂无"),1)]),o("div",Se,[e[21]||(e[21]=o("div",{class:"detail-label"},"覆盖人电话：",-1)),o("div",Ee,r(s.value.overlayPhone||"暂无"),1)])]),o("div",Ie,[e[26]||(e[26]=o("h3",{class:"section-title"},"代码信息",-1)),o("div",Ae,[e[23]||(e[23]=o("div",{class:"detail-label"},"代码模式：",-1)),o("div",ze,r(s.value.codeMode||"暂无"),1)]),o("div",Re,[e[24]||(e[24]=o("div",{class:"detail-label"},"监控状态：",-1)),o("div",je,r(s.value.monitorStatus||"暂无"),1)]),o("div",Ue,[e[25]||(e[25]=o("div",{class:"detail-label"},"版本：",-1)),o("div",Be,r(s.value.version||"暂无"),1)])]),o("div",He,[e[31]||(e[31]=o("h3",{class:"section-title"},"代码预览",-1)),o("div",Je,[o("div",Oe,[e[28]||(e[28]=o("span",null,"被监控代码",-1)),d(i,{type:"primary",link:"",size:"small",onClick:e[2]||(e[2]=l=>f(s.value,"monitor"))},{default:a(()=>e[27]||(e[27]=[n(" 查看完整代码 ")])),_:1})]),o("pre",qe,r(s.value.monitorCode?s.value.monitorCode.substring(0,200)+(s.value.monitorCode.length>200?"...":""):"暂无"),1)]),o("div",Fe,[o("div",We,[e[30]||(e[30]=o("span",null,"覆盖代码",-1)),d(i,{type:"primary",link:"",size:"small",onClick:e[3]||(e[3]=l=>f(s.value,"overlay"))},{default:a(()=>e[29]||(e[29]=[n(" 查看完整代码 ")])),_:1})]),o("pre",Ge,r(s.value.overlayCode?s.value.overlayCode.substring(0,200)+(s.value.overlayCode.length>200?"...":""):"暂无"),1)])]),o("div",Ke,[e[34]||(e[34]=o("h3",{class:"section-title"},"时间信息",-1)),o("div",Qe,[e[32]||(e[32]=o("div",{class:"detail-label"},"创建时间：",-1)),o("div",Xe,r(V(s.value.createTime)),1)]),o("div",Ye,[e[33]||(e[33]=o("div",{class:"detail-label"},"更新时间：",-1)),o("div",Ze,r(V(s.value.updateTime)),1)])])])):ae("",!0)]),_:1},8,["modelValue"])])}}}),ro=ue(eo,[["__scopeId","data-v-bbe48ae3"]]);export{ro as default};
