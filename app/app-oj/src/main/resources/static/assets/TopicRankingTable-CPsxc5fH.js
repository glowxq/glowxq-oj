import{d as D,r as g,b as q,w as V,o as i,c as m,a,j as o,k as n,u as v,dB as M,t as l,P as O,Q as P,x as b,m as B,n as Q,y as G,R,f as c,p as H,_ as K}from"./index-DTkCE7MD.js";import{g as W}from"./topicInfo-BsE0LD6L.js";import{T as x}from"./TopicJudgeType-B4cJ_xct.js";import{T as X}from"./TopicInfoStatus-BMpq3Jyc.js";const Y={class:"ranking-section"},Z={class:"section-header"},ee={class:"title"},te={class:"actions"},ae={class:"judge-type-selector"},se={class:"ranking-content"},oe={key:1,class:"ranking-table-wrapper"},ne={class:"rank"},le={class:"user-info"},re={class:"user-name"},ie={key:0,class:"user-nickname"},ce={class:"score"},de={class:"stat-value"},ue={class:"stat-number"},pe={class:"stat-value"},me={class:"stat-number"},_e={class:"time-value"},fe={class:"time-value punishment"},he={class:"status-badge"},ge={key:1},ve=D({__name:"TopicRankingTable",props:{topicId:{type:Number,required:!0},title:{type:String,default:"排行榜"},headerBgColor:{type:String,default:"#409EFF"},defaultJudgeType:{type:Number,default:0}},emits:["update:loading","error"],setup(_,{emit:I}){H(t=>({"1a3a22b2":_.headerBgColor}));const p=_,w=I,d=g([]),f=g(""),h=g(p.defaultJudgeType),k=g(!1),J=({rowIndex:t})=>t===0?"first-row":t===1?"second-row":t===2?"third-row":"",L=t=>t===0?"first":t===1?"second":t===2?"third":"",T=q(()=>{if(!f.value)return d.value;const t=f.value.toLowerCase();return d.value.filter(s=>{const u=(s.name||"").toLowerCase(),y=(s.nickName||"").toLowerCase();return u.includes(t)||y.includes(t)})}),S=()=>{},$=()=>{N()},C=t=>{if(!t)return"-";if(t<60)return`${t}分钟`;const s=Math.floor(t/60),u=t%60;return u===0?`${s}小时`:`${s}小时${u}分钟`},j=t=>t?t.charAt(0).toUpperCase():"?",N=async()=>{if(p.topicId){k.value=!0,w("update:loading",!0);try{const t={topicId:p.topicId,topicJudgeType:h.value},s=await W(t);s.data?d.value=s.data:d.value=[]}catch(t){console.error("获取排行榜数据失败",t),w("error","获取排行榜数据失败，请稍后重试"),d.value=[]}finally{k.value=!1,w("update:loading",!1)}}};return V(()=>p.defaultJudgeType,t=>{h.value=t},{immediate:!0}),V(()=>p.topicId,()=>{N()},{immediate:!0}),(t,s)=>{const u=c("el-icon"),y=c("el-radio"),z=c("el-radio-group"),E=c("el-input"),F=c("el-empty"),r=c("el-table-column"),U=c("el-avatar"),A=c("el-table");return i(),m("div",Y,[a("div",Z,[a("div",ee,[o(u,null,{default:n(()=>[o(v(M))]),_:1}),a("span",null,l(_.title),1)]),a("div",te,[a("div",ae,[s[2]||(s[2]=a("span",{class:"selector-label"},"判题类型:",-1)),o(z,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e),size:"small",onChange:$},{default:n(()=>[(i(!0),m(O,null,P(Object.values(v(x)),e=>(i(),b(y,{key:e.code,label:e.code,class:"judge-type-radio"},{default:n(()=>[o(R,{enum:v(x),code:e.code,class:"judge-type-badge"},null,8,["enum","code"])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),d.value.length>0?(i(),b(E,{key:0,modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=e=>f.value=e),placeholder:"搜索姓名/昵称","prefix-icon":"Search",clearable:"",onInput:S,class:"search-input"},null,8,["modelValue"])):B("",!0)])]),a("div",se,[T.value.length===0?(i(),b(F,{key:0,description:"暂无排名数据",class:"empty-data"})):(i(),m("div",oe,[o(A,{data:T.value,style:{width:"100%"},size:"large","header-cell-style":{background:_.headerBgColor,color:"#ffffff"},"row-class-name":J,border:"","highlight-current-row":"",class:"ranking-table"},{default:n(()=>[o(r,{type:"index",label:"排名",width:"80",align:"center"},{default:n(e=>[a("div",ne,[a("div",{class:Q(["rank-badge",L(e.$index)])},l(e.$index+1),3)])]),_:1}),o(r,{prop:"avatar",label:"头像",width:"100",align:"center"},{default:n(e=>[o(U,{size:50,src:e.row.avatar,class:"user-avatar"},{default:n(()=>[G(l(j(e.row.name||e.row.nickName)),1)]),_:2},1032,["src"])]),_:1}),o(r,{prop:"name",label:"姓名","min-width":"120"},{default:n(e=>[a("div",le,[a("span",re,l(e.row.name||"未知"),1),e.row.nickName?(i(),m("span",ie,"("+l(e.row.nickName)+")",1)):B("",!0)])]),_:1}),o(r,{prop:"score",label:"得分",width:"100",align:"center",sortable:""},{default:n(e=>[a("span",ce,l(e.row.score||0),1)]),_:1}),o(r,{prop:"acNum",label:"通过题数",width:"100",align:"center",sortable:""},{default:n(e=>[a("div",de,[a("span",ue,l(e.row.acNum||0),1)])]),_:1}),o(r,{prop:"submitNum",label:"提交次数",width:"100",align:"center",sortable:""},{default:n(e=>[a("div",pe,[a("span",me,l(e.row.submitNum||0),1)])]),_:1}),o(r,{prop:"useTime",label:"用时",width:"120",align:"center",sortable:""},{default:n(e=>[a("div",_e,l(C(e.row.useTime)),1)]),_:1}),o(r,{prop:"punishmentTime",label:"罚时",width:"120",align:"center",sortable:""},{default:n(e=>[a("div",fe,l(C(e.row.punishmentTime)),1)]),_:1}),o(r,{prop:"status",label:"状态",width:"120",align:"center"},{default:n(e=>[a("div",he,[e.row.status?(i(),b(R,{key:0,enum:v(X),code:e.row.status},null,8,["enum","code"])):(i(),m("span",ge,"-"))])]),_:1})]),_:1},8,["data","header-cell-style"])]))])])}}}),Te=K(ve,[["__scopeId","data-v-af6423d4"]]);export{Te as default};
