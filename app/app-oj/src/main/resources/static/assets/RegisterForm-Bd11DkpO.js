import{d as ye,q as we,v as be,r as f,aB as B,b as Ve,w as D,e as he,f as m,g as ke,o as d,c as g,a as s,j as t,k as a,u as i,J as Ue,aK as E,X as x,ds as xe,x as h,t as y,m as M,aJ as $,az as te,y as V,i as Ie,P as ae,Q as Ke,n as Ce,dW as Te,dV as Pe,F as Ne,dX as Le,dY as qe,a8 as Fe,W as _,dZ as Me,a1 as Ae,_ as Re}from"./index-DTkCE7MD.js";import{a as Se,g as Ye,b as ze}from"./tenant-BWmX3Yn9.js";import{U as Be}from"./Img-CbqiKKTP.js";import"./upload-BtJOZC1L.js";const De={class:"register-form-container"},Ee={class:"form-section"},$e={key:0,class:"tenant-section"},je={class:"section-title"},We={class:"tenant-card"},Je={key:0,class:"selected-tenant"},Xe={class:"tenant-logo"},Ge=["src"],Oe={class:"tenant-info"},Qe={class:"tenant-name-wrapper"},Ze=["title"],He={class:"tenant-meta-tags"},et={class:"tenant-tag tenant-id"},tt={class:"tenant-tag tenant-code"},at={class:"tenant-input-group"},st={class:"tenant-buttons"},lt={class:"tenant-popover-content"},nt={class:"tenant-header"},ot={class:"tenant-title-wrapper"},rt={class:"current-tenant-name"},it={class:"tenant-search"},dt={class:"tenant-list"},ut={key:0,class:"tenant-grid"},pt=["onClick"],ct={class:"tenant-item-left"},mt={class:"tenant-logo"},ft=["src"],_t={class:"tenant-info"},vt={class:"tenant-name-wrapper"},gt=["title"],yt={class:"tenant-meta-tags"},wt={class:"tenant-tag tenant-id"},bt={class:"tenant-tag tenant-code"},Vt={class:"tenant-item-right"},ht={key:1,class:"tenant-empty"},kt={class:"form-section"},Ut={class:"form-two-columns"},xt={class:"avatar-wrapper"},It={class:"register-actions"},Kt={class:"password-dialog-content"},Ct={class:"tenant-info-display"},Tt={class:"tenant-logo-container"},Pt=["src"],Nt=["title"],Lt={class:"tenant-meta-dialog"},qt={class:"tenant-tag tenant-id"},Ft={key:0,class:"password-error"},Mt={class:"dialog-footer"},At=ye({__name:"RegisterForm",setup(Rt){const se=we(),b=be(),T=f(),P=f(!1),j=f(["basic"]),v=f(null),A=f(!1),I=f(!1),w=f(null),K=f(""),k=f(""),R=f(!1),N=f(!0),c=B({username:"",password:"",tenantKey:"",phone:"",email:"",name:"",nickname:"",sex:0,birthday:"",logo:"",address:""}),l=B({...c,confirmPassword:""}),U=f([]),S=f(!1),L=f(""),W=Ve(()=>{if(!L.value)return U.value;const n=L.value.toLowerCase();return U.value.filter(e=>{var r,u,p;return((r=e.tenantName)==null?void 0:r.toLowerCase().includes(n))||((u=e.tenantCode)==null?void 0:u.toLowerCase().includes(n))||((p=e.tenantId)==null?void 0:p.toLowerCase().includes(n))})});D(()=>l.tenantKey,n=>{if(v.value){const e=v.value.tenantId===n,r=v.value.tenantCode===n;!e&&!r&&(v.value=null)}});const J=async()=>{S.value=!0;try{const n=await Se();if(n.code==="0000"&&n.data&&(typeof n.data=="object"&&"rows"in n.data&&Array.isArray(n.data.rows)?U.value=n.data.rows:Array.isArray(n.data)&&(U.value=n.data),b.tenantId)){const e=U.value.find(r=>r.tenantId===b.tenantId);e&&q(e,!1)}}catch(n){console.error("获取租户列表失败:",n)}finally{S.value=!1}},X=async()=>{if(!l.tenantKey){_.warning("请输入租户标识");return}A.value=!0;try{const n=await Ye(l.tenantKey);if(n.code==="0000"&&n.data){if(!n.data.enable){_.warning("该租户已被禁用，无法选择");return}n.data.password?(w.value=n.data,K.value="",k.value="",I.value=!0):q(n.data)}else _.error(n.message||"未找到匹配的租户")}catch(n){console.error("搜索租户失败:",n),_.error("搜索租户时发生错误")}finally{A.value=!1}},G=()=>{if(w.value){if(!K.value){k.value="请输入密码";return}k.value="",R.value=!0,setTimeout(()=>{if(K.value===w.value.password)I.value=!1,q(w.value);else{k.value="密码错误，请重新输入";const n=document.querySelector(".password-input");n&&(n.classList.add("shake-animation"),setTimeout(()=>{n.classList.remove("shake-animation")},500))}R.value=!1},500)}},q=(n,e=!0)=>{if(!n.enable){_.warning("该租户已被禁用，无法选择");return}l.tenantKey=n.tenantId,v.value=n,e&&_.success(`已选择租户: ${n.tenantName}`)},le=n=>{l.phone=n},ne=(n,e,r)=>{const u=typeof e=="string"?e:"",p=typeof l.password=="string"?l.password:"";u===""?r(new Error("请再次输入密码")):u.trim()!==p.trim()?r(new Error("两次输入密码不一致")):r()};D(()=>l.password,()=>{var n;l.confirmPassword&&((n=T.value)==null||n.validateField("confirmPassword"))}),D(()=>l.confirmPassword,n=>{var e;n&&((e=T.value)==null||e.validateField("confirmPassword"))});const O=B({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:ne,trigger:"blur"}],tenantKey:[{required:!0,message:"请选择或输入租户",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),Q=async()=>{if(console.log("handleRegister 被调用"),!T.value){console.error("表单引用为空");return}if(P.value){console.log("正在提交中，请勿重复点击");return}if(!l.username){_.error("请输入用户名");return}if(!l.password){_.error("请输入密码");return}if(!l.confirmPassword){_.error("请确认密码");return}if(!l.tenantKey){_.error("请选择租户");return}console.log("注册表单数据:",l),console.log("验证前的registerForm:",c);try{c.username=l.username,c.password=l.password,c.tenantKey=l.tenantKey,c.phone=l.phone,c.email=l.email,c.name=l.name,c.nickname=l.nickname,c.sex=l.sex,c.birthday=l.birthday,c.logo=l.logo,c.address=l.address,console.log("同步后的registerForm:",c);const n=typeof l.password=="string"?l.password:"",e=typeof l.confirmPassword=="string"?l.confirmPassword:"";if(n.trim()!==e.trim()){_.error("两次输入密码不一致，请检查");return}P.value=!0;try{console.log("提交的注册数据:",c),await Me(c),_.success("注册成功，即将跳转到登录页"),setTimeout(()=>{se.push(Ae)},1500)}catch(r){console.error("注册失败:",r),_.error(r.message||"注册失败，请稍后重试")}finally{P.value=!1}}catch(n){console.error("处理注册过程中发生错误:",n),_.error("注册处理过程中出现异常")}},oe=async()=>{try{const n=await ze();n.code==="0000"&&n.data&&(N.value=n.data.enable,console.log("租户功能启用状态:",N.value),N.value||delete O.tenantKey)}catch(n){console.error("获取租户功能启用状态失败:",n)}};return he(()=>{oe(),J(),b.tenantId&&(l.tenantKey=b.tenantId)}),(n,e)=>{const r=m("el-icon"),u=m("el-input"),p=m("el-form-item"),re=m("el-tooltip"),C=m("el-button"),F=m("el-tag"),ie=m("el-badge"),de=m("el-empty"),ue=m("el-popover"),Z=m("el-collapse-item"),Y=m("el-option"),pe=m("el-select"),ce=m("el-date-picker"),me=m("el-collapse"),fe=m("el-form"),_e=m("el-dialog"),ve=ke("loading");return d(),g(ae,null,[s("div",De,[t(fe,{ref_key:"registerFormRef",ref:T,model:l,rules:O,"label-position":"left",size:"default",onKeyup:$(Q,["enter"])},{default:a(()=>[t(me,{modelValue:j.value,"onUpdate:modelValue":e[13]||(e[13]=o=>j.value=o),class:"register-collapse"},{default:a(()=>[t(Z,{name:"basic",class:"collapse-item"},{title:a(()=>e[18]||(e[18]=[s("div",{class:"collapse-header"},[s("span",{class:"header-title"},"基本信息"),s("span",{class:"required-tag"},"必填")],-1)])),default:a(()=>[s("div",Ee,[t(p,{prop:"username",class:"form-item"},{label:a(()=>e[19]||(e[19]=[s("div",{class:"form-label"},[s("span",null,"用户名"),s("span",{class:"required"},"*")],-1)])),default:a(()=>[t(u,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=o=>l.username=o),placeholder:"请输入用户名",clearable:"",onInput:le,class:"uniform-input"},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(Ue))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"password",class:"form-item"},{label:a(()=>e[20]||(e[20]=[s("div",{class:"form-label"},[s("span",null,"密码"),s("span",{class:"required"},"*")],-1)])),default:a(()=>[t(u,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=o=>l.password=o),modelModifiers:{trim:!0},type:"password",placeholder:"请输入密码","show-password":"",clearable:"",class:"uniform-input"},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(E))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"confirmPassword",class:"form-item"},{label:a(()=>e[21]||(e[21]=[s("div",{class:"form-label"},[s("span",null,"确认密码"),s("span",{class:"required"},"*")],-1)])),default:a(()=>[t(u,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=o=>l.confirmPassword=o),modelModifiers:{trim:!0},type:"password",placeholder:"请再次输入密码","show-password":"",clearable:"",class:"uniform-input"},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(E))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),N.value?(d(),g("div",$e,[s("div",je,[t(r,null,{default:a(()=>[t(i(x))]),_:1}),e[22]||(e[22]=s("span",null,"选择租户",-1)),e[23]||(e[23]=s("span",{class:"required"},"*",-1)),t(re,{content:"租户标识是您账号的重要归属信息",placement:"top",effect:"light","hide-after":0},{default:a(()=>[t(r,{class:"help-icon"},{default:a(()=>[t(i(xe))]),_:1})]),_:1})]),t(p,{prop:"tenantKey",class:"tenant-form-item"},{default:a(()=>[s("div",We,[v.value?(d(),g("div",Je,[s("div",Xe,[v.value.logoUrl?(d(),g("img",{key:0,src:v.value.logoUrl,alt:"logo"},null,8,Ge)):(d(),h(r,{key:1},{default:a(()=>[t(i(x))]),_:1}))]),s("div",Oe,[s("div",Qe,[s("span",{class:"tenant-name",title:v.value.tenantName},y(v.value.tenantName),9,Ze)]),s("div",He,[s("span",et,y(v.value.tenantId),1),s("span",tt,y(v.value.tenantCode),1)])])])):M("",!0),s("div",at,[t(u,{modelValue:l.tenantKey,"onUpdate:modelValue":e[3]||(e[3]=o=>l.tenantKey=o),placeholder:"请输入租户标识",clearable:"",class:"tenant-input",onKeyup:$(X,["enter"])},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(x))]),_:1})]),_:1},8,["modelValue"]),s("div",st,[t(C,{onClick:X,loading:A.value,type:"primary",class:"search-btn"},{default:a(()=>[t(r,null,{default:a(()=>[t(i(te))]),_:1})]),_:1},8,["loading"]),t(ue,{placement:"bottom",trigger:"click",width:450,onShow:J,"popper-class":"tenant-popover"},{reference:a(()=>[t(C,{class:"tenant-select-btn",type:"primary"},{default:a(()=>e[24]||(e[24]=[V("选择")])),_:1})]),default:a(()=>[s("div",lt,[s("div",nt,[s("div",ot,[t(r,{class:"tenant-icon"},{default:a(()=>[t(i(x))]),_:1}),e[25]||(e[25]=s("span",{class:"tenant-title"},"选择租户",-1)),t(F,{size:"small",type:"info",effect:"plain",class:"tenant-count-tag"},{default:a(()=>[V(" 共 "+y(U.value.length)+" 个租户 ",1)]),_:1})]),i(b).tenantName?(d(),h(ie,{key:0,value:1,type:"primary"},{default:a(()=>[s("span",rt,y(i(b).tenantName),1)]),_:1})):M("",!0)]),s("div",it,[t(u,{modelValue:L.value,"onUpdate:modelValue":e[4]||(e[4]=o=>L.value=o),placeholder:"搜索租户",clearable:"",class:"tenant-key-input"},{prefix:a(()=>[t(r,{class:"search-prefix-icon"},{default:a(()=>[t(i(te))]),_:1})]),_:1},8,["modelValue"])]),Ie((d(),g("div",dt,[W.value.length>0?(d(),g("div",ut,[(d(!0),g(ae,null,Ke(W.value,o=>(d(),g("div",{key:o.id,class:Ce(["tenant-item",{"is-active":l.tenantKey===o.tenantId,"is-current":i(b).tenantId===o.tenantId}]),onClick:z=>q(o)},[s("div",ct,[s("div",mt,[o.logoUrl?(d(),g("img",{key:0,src:o.logoUrl,alt:"logo"},null,8,ft)):(d(),h(r,{key:1},{default:a(()=>[t(i(x))]),_:1}))]),s("div",_t,[s("div",vt,[s("span",{class:"tenant-name",title:o.tenantName},y(o.tenantName),9,gt)]),s("div",yt,[s("span",wt,y(o.tenantId),1),s("span",bt,y(o.tenantCode),1)])])]),s("div",Vt,[i(b).tenantId===o.tenantId?(d(),h(F,{key:0,type:"primary",size:"small",effect:"plain"},{default:a(()=>e[26]||(e[26]=[V("当前")])),_:1})):o.enable?(d(),h(F,{key:1,type:"success",size:"small"},{default:a(()=>e[27]||(e[27]=[V("正常")])),_:1})):(d(),h(F,{key:2,type:"danger",size:"small"},{default:a(()=>e[28]||(e[28]=[V("禁用")])),_:1}))])],10,pt))),128))])):(d(),g("div",ht,[t(de,{description:"暂无租户信息"})]))])),[[ve,S.value]])])]),_:1})])])])]),_:1})])):M("",!0)]),_:1}),t(Z,{name:"personal",class:"collapse-item"},{title:a(()=>e[29]||(e[29]=[s("div",{class:"collapse-header"},[s("span",{class:"header-title"},"个人信息"),s("span",{class:"optional-tag"},"选填")],-1)])),default:a(()=>[s("div",kt,[t(p,{prop:"phone",class:"form-item"},{label:a(()=>e[30]||(e[30]=[s("div",{class:"form-label"},[s("span",null,"手机号")],-1)])),default:a(()=>[t(u,{modelValue:l.phone,"onUpdate:modelValue":e[5]||(e[5]=o=>l.phone=o),placeholder:"请输入手机号",clearable:""},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(Te))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"email",class:"form-item"},{label:a(()=>e[31]||(e[31]=[s("div",{class:"form-label"},[s("span",null,"邮箱")],-1)])),default:a(()=>[t(u,{modelValue:l.email,"onUpdate:modelValue":e[6]||(e[6]=o=>l.email=o),placeholder:"请输入邮箱",clearable:""},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(Pe))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"name",class:"form-item"},{label:a(()=>e[32]||(e[32]=[s("div",{class:"form-label"},[s("span",null,"真实姓名")],-1)])),default:a(()=>[t(u,{modelValue:l.name,"onUpdate:modelValue":e[7]||(e[7]=o=>l.name=o),placeholder:"请输入真实姓名",clearable:""},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(Ne))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"nickname",class:"form-item"},{label:a(()=>e[33]||(e[33]=[s("div",{class:"form-label"},[s("span",null,"昵称")],-1)])),default:a(()=>[t(u,{modelValue:l.nickname,"onUpdate:modelValue":e[8]||(e[8]=o=>l.nickname=o),placeholder:"请输入昵称",clearable:""},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(Le))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s("div",Ut,[t(p,{prop:"sex",class:"form-item"},{label:a(()=>e[34]||(e[34]=[s("div",{class:"form-label"},[s("span",null,"性别")],-1)])),default:a(()=>[t(pe,{modelValue:l.sex,"onUpdate:modelValue":e[9]||(e[9]=o=>l.sex=o),placeholder:"请选择性别",class:"full-width"},{default:a(()=>[t(Y,{label:"未知",value:0}),t(Y,{label:"男",value:1}),t(Y,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"birthday",class:"form-item"},{label:a(()=>e[35]||(e[35]=[s("div",{class:"form-label"},[s("span",null,"生日")],-1)])),default:a(()=>[t(ce,{modelValue:l.birthday,"onUpdate:modelValue":e[10]||(e[10]=o=>l.birthday=o),type:"date",placeholder:"请选择生日",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"full-width"},null,8,["modelValue"])]),_:1})]),t(p,{prop:"address",class:"form-item"},{label:a(()=>e[36]||(e[36]=[s("div",{class:"form-label"},[s("span",null,"地址")],-1)])),default:a(()=>[t(u,{modelValue:l.address,"onUpdate:modelValue":e[11]||(e[11]=o=>l.address=o),placeholder:"请输入地址",clearable:""},{prefix:a(()=>[t(r,{class:"el-input__icon"},{default:a(()=>[t(i(qe))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,{prop:"logo",class:"form-item"},{label:a(()=>e[37]||(e[37]=[s("div",{class:"form-label"},[s("span",null,"头像")],-1)])),default:a(()=>[s("div",xt,[t(Be,{imageUrl:l.logo,"onUpdate:imageUrl":e[12]||(e[12]=o=>l.logo=o),limit:1,"file-size":2,dir:"avatar",height:"90px",width:"90px"},{tip:a(()=>e[38]||(e[38]=[s("span",{class:"upload-tip"},"支持jpg, png格式，大小不超过2MB",-1)])),_:1},8,["imageUrl"])])]),_:1})])]),_:1})]),_:1},8,["modelValue"]),s("div",It,[t(C,{type:"primary",loading:P.value,class:"register-button",onClick:e[14]||(e[14]=()=>{console.log("点击了注册按钮"),Q()})},{default:a(()=>e[39]||(e[39]=[V(" 注册 ")])),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),t(_e,{modelValue:I.value,"onUpdate:modelValue":e[17]||(e[17]=o=>I.value=o),title:"租户密码验证",width:"380px","close-on-click-modal":!1,"append-to-body":!0,"destroy-on-close":""},{footer:a(()=>[s("div",Mt,[t(C,{onClick:e[16]||(e[16]=o=>I.value=!1),class:"cancel-btn"},{default:a(()=>e[41]||(e[41]=[V("取消")])),_:1}),t(C,{type:"primary",onClick:G,loading:R.value,class:"confirm-btn"},{default:a(()=>e[42]||(e[42]=[V(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>{var o,z,H,ee;return[s("div",Kt,[s("div",Ct,[s("div",Tt,[(o=w.value)!=null&&o.logoUrl?(d(),g("img",{key:0,src:w.value.logoUrl,alt:"logo",class:"tenant-logo-large"},null,8,Pt)):(d(),h(r,{key:1,class:"tenant-logo-placeholder"},{default:a(()=>[t(i(x))]),_:1}))]),s("p",{class:"tenant-name-display",title:(z=w.value)==null?void 0:z.tenantName},y((H=w.value)==null?void 0:H.tenantName),9,Nt),s("div",Lt,[s("span",qt,y((ee=w.value)==null?void 0:ee.tenantId),1)])]),e[40]||(e[40]=s("p",{class:"password-tip"},"该租户需要密码验证",-1)),t(u,{modelValue:K.value,"onUpdate:modelValue":e[15]||(e[15]=ge=>K.value=ge),type:"password",placeholder:"请输入租户密码","show-password":"",onKeyup:$(G,["enter"]),class:"password-input"},{prefix:a(()=>[t(r,null,{default:a(()=>[t(i(E))]),_:1})]),_:1},8,["modelValue"]),k.value?(d(),g("div",Ft,[t(r,null,{default:a(()=>[t(i(Fe))]),_:1}),s("span",null,y(k.value),1)])):M("",!0)])]}),_:1},8,["modelValue"])],64)}}}),Dt=Re(At,[["__scopeId","data-v-63e92458"]]);export{Dt as default};
