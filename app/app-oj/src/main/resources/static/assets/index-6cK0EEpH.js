import{d as oe,b as c,o as l,c as u,a as e,t as n,n as V,_ as ie,a3 as Ce,q as Re,r as D,s as Se,ad as Pe,e as Ie,j as i,k as r,y as k,u as g,a9 as ee,x as y,R as te,m,ds as se,bn as Me,bS as De,P as j,Q as H,M as Ee,W as I,aa as q,dE as L,f as w,bk as ae,bl as ze,z as Le,aK as Ne}from"./index-DTkCE7MD.js";import{g as Be}from"./topic-DtpaBxBf.js";import{m as le,T as N}from"./TimeRangeType-BW_JmSm6.js";import{T as Ge}from"./TopicType-BfRQGLIH.js";import{P as $e}from"./ProblemType-TBlMUhPx.js";import{M as Ae}from"./MdPreview-CyycvVxJ.js";import"./style-DrPmFrlE.js";const Ve={class:"time-status"},Ue={class:"status-text"},Ye=oe({__name:"TimeStatusShow",props:{startTime:{type:String,default:""},endTime:{type:String,default:""},tagEffect:{type:String,default:"light"}},setup(J){const p=J,R=c(()=>{const T=new Date().getTime();if(!p.startTime&&!p.endTime)return{type:"info",text:"未设置"};if(p.startTime&&!p.endTime){const _=new Date(p.startTime).getTime();return T<_?{type:"info",text:"未开始"}:{type:"success",text:"进行中"}}if(!p.startTime&&p.endTime){const _=new Date(p.endTime).getTime();return T>_?{type:"danger",text:"已结束"}:{type:"success",text:"进行中"}}if(p.startTime&&p.endTime){const _=new Date(p.startTime).getTime(),a=new Date(p.endTime).getTime();return T<_?{type:"info",text:"未开始"}:T>a?{type:"danger",text:"已结束"}:{type:"success",text:"进行中"}}return{type:"info",text:"未设置"}});return(T,_)=>(l(),u("div",Ve,[e("div",{class:V(["status-indicator",`status-${R.value.type}`])},[_[0]||(_[0]=e("span",{class:"status-dot"},null,-1)),e("span",Ue,n(R.value.text),1)],2)]))}}),Fe=ie(Ye,[["__scopeId","data-v-971cbf04"]]),Oe={class:"dotopic-container"},je={class:"top-navigation"},He={class:"nav-content"},qe={class:"nav-left"},Je={class:"topic-basic-info"},Ke={class:"topic-title"},We={class:"topic-meta"},Qe={class:"problem-total"},Xe={class:"nav-right"},Ze={class:"strategy-popover"},et={class:"main-content-wrapper"},tt={class:"left-panel"},st={class:"detail-header"},at={class:"time-section"},lt={class:"time-display"},ot={class:"time-item"},it={class:"time-value"},nt={class:"time-item"},rt={class:"time-value"},ct={key:0,class:"time-status"},ut={class:"basic-info"},dt={class:"info-row"},pt={class:"info-value"},vt={class:"info-row"},mt={class:"info-value"},_t={key:0,class:"info-row"},ft={class:"info-value"},gt={key:0,class:"tags-section"},yt={class:"tags-container"},Tt={key:1,class:"description-section"},ht={class:"description-content"},bt={class:"right-panel"},kt={class:"list-header"},wt={class:"header-left"},xt={class:"list-stats"},Ct={class:"current-page-info"},Rt={class:"total-problems"},St={class:"header-right"},Pt={key:0,class:"pagination-controls"},It={class:"page-indicators"},Mt=["onClick"],Dt={class:"problem-list-content"},Et={key:1,class:"restricted-view"},zt={key:2,class:"restricted-view"},Lt={key:3,class:"problem-grid"},Nt=["onClick"],Bt={class:"problem-header"},Gt={class:"problem-number"},$t={class:"problem-key"},At={class:"problem-content"},Vt={class:"problem-title"},Ut={class:"problem-meta"},Yt={key:0,class:"disabled-overlay"},Ft={class:"disabled-text"},Ot=oe({name:"DoTopic",__name:"index",setup(J){const p=Ce(),R=Re(),T=c(()=>Number(p.params.id)),_=D(!1),a=D({}),x=D([]),v=D(1),S=D(10),M=c(()=>Math.ceil(x.value.length/S.value)),E=D(!1),ne=c(()=>{const s=(v.value-1)*S.value,t=s+S.value;return x.value.slice(s,t)}),re=c(()=>{const s=M.value,t=v.value,d=[];if(s<=7)for(let P=1;P<=s;P++)d.push(P);else{d.push(1),t>4&&d.push("...");const P=Math.max(2,t-2),z=Math.min(s-1,t+2);for(let C=P;C<=z;C++)d.push(C);t<s-3&&d.push("..."),s>1&&d.push(s)}return d}),ce=()=>{v.value>1&&v.value--},ue=()=>{v.value<M.value&&v.value++},de=s=>{s>=1&&s<=M.value&&(v.value=s)},pe=s=>{S.value=s,v.value=1},K=s=>(v.value-1)*S.value+s,ve=()=>{E.value=!E.value},me=()=>{R.back()},_e={PROGRAMMING:{code:"PROGRAMMING",name:"编程题"},FILL:{code:"FILL",name:"填空题"},CHOICE:{code:"CHOICE",name:"选择题"},JUDGMENT:{code:"JUDGMENT",name:"判断题"}},fe=Se(),{primary:B}=Pe(fe);c(()=>ae(B.value,.8)),c(()=>ae(B.value,.95)),c(()=>ze(B.value,.2));const f=c(()=>a.value.endTime?L().isAfter(L(a.value.endTime)):!1),h=c(()=>a.value.startTime?L().isBefore(L(a.value.startTime)):!1),W=c(()=>{if(!a.value.timeRangeType)return"";const s=le(a.value.timeRangeType);return(s==null?void 0:s.tooltip)||""}),ge=s=>{const t=le(s);return(t==null?void 0:t.name)||"无策略"},b=c(()=>a.value.timeRangeType===N.STRICT_TIME_VIEW.code),U=c(()=>a.value.timeRangeType===N.STRICT_TIME_SUBMIT.code),G=c(()=>a.value.timeRangeType===N.PENALTY_FIXED.code),Y=c(()=>a.value.timeRangeType===N.PENALTY_GRADUAL.code);c(()=>a.value.timeRangeType===N.UNRESTRICTED.code);const $=c(()=>b.value&&h.value?{title:"主题未开始",type:"warning",description:`该主题仅允许在规定时间内查看，将于 ${a.value.startTime} 开始。`}:f.value?b.value?{title:"主题已过期，禁止查看",type:"error",description:"根据主题设置，过期后不允许查看题目。"}:U.value?{title:"主题已过期，禁止提交",type:"warning",description:"您可以查看题目详情，但不能再提交答案。"}:G.value?{title:"主题已过期，将固定扣分",type:"warning",description:"您仍然可以提交答案，但最终得分将被扣除固定比例。"}:Y.value?{title:"主题已过期，将按时间递减扣分",type:"warning",description:"您仍然可以提交答案，但最终得分将根据超时时长递减扣分。"}:null:null),ye=async()=>{if(T.value){_.value=!0;try{const s=await Be({id:T.value});a.value=s.data,s.data.problemList&&s.data.problemList.length>0?x.value=s.data.problemList:x.value=[],Te()}catch(s){console.error("获取主题详情失败:",s),I.error("获取主题详情失败")}finally{_.value=!1}}},Te=()=>{if(b.value&&h.value){q.alert(`该主题仅允许在规定时间内查看，将于 ${a.value.startTime} 开始。`,"未到开始时间",{confirmButtonText:"返回",type:"warning",callback:()=>{R.back()}});return}if(f.value){if(b.value){q.alert("该主题已过期，根据设置您不能再查看题目内容。","主题已过期",{confirmButtonText:"返回",type:"error",callback:()=>{R.back()}});return}U.value?I.warning("主题已过期，您可以查看题目但无法提交答案"):G.value?I.warning("主题已过期，提交将扣除固定比例分数"):Y.value&&I.warning("主题已过期，提交将按超时时长递减扣分")}},he=s=>s<=3?"简单":s<=7?"中等":"困难",be=s=>s<=3?"success":s<=7?"warning":"danger",ke=(s,t)=>{if(b.value&&h.value){I.error(`该主题仅允许在规定时间内查看，将于 ${a.value.startTime} 开始。`);return}if(f.value&&b.value){I.error("主题已过期，不允许查看题目");return}if(f.value&&U.value){I.warning("主题已过期，您可以查看题目但无法做题");return}if(f.value&&(G.value||Y.value)){const d=G.value?"固定":"递减";q.confirm(`主题已过期，提交答案将${d}扣分。是否继续？`,"提示",{confirmButtonText:"继续做题",cancelButtonText:"取消",type:"warning"}).then(()=>{Q(s,t)}).catch(()=>{});return}Q(s,t)},Q=(s,t)=>{R.push({path:`/oj/problem/submit/${s.id}`,query:{topicId:T.value,judgeSceneType:a.value.topicType,topicType:a.value.topicType,isExpired:f.value?"1":"0",timeRangeType:a.value.timeRangeType,problemIndex:t.toString(),totalProblems:x.value.length.toString()}})},X=s=>s?L(s).format("YYYY-MM-DD HH:mm"):"未设置";return Ie(()=>{ye()}),(s,t)=>{const d=w("el-button"),P=w("el-popover"),z=w("el-icon"),C=w("el-tag"),we=w("el-tooltip"),Z=w("el-card"),A=w("el-option"),xe=w("el-select"),F=w("el-empty");return l(),u("div",Oe,[e("div",je,[e("div",He,[e("div",qe,[i(d,{class:"back-button",icon:g(ee),onClick:me,size:"default",type:"primary",plain:""},{default:r(()=>t[1]||(t[1]=[k(" 返回 ")])),_:1},8,["icon"]),e("div",Je,[e("h2",Ke,n(a.value.name||"主题详情"),1),e("div",We,[a.value.topicType?(l(),y(te,{key:0,enum:g(Ge),code:a.value.topicType||"",class:"topic-type-tag","background-color":g(B),color:"white"},null,8,["enum","code","background-color"])):m("",!0),i(Fe,{"start-time":a.value.startTime??"","end-time":a.value.endTime??"","tag-effect":"plain"},null,8,["start-time","end-time"]),e("span",Qe,"共 "+n(x.value.length)+" 题",1)])])]),e("div",Xe,[$.value?(l(),y(P,{key:0,placement:"bottom",width:300,trigger:"hover"},{reference:r(()=>[i(d,{type:$.value.type==="error"?"danger":"warning",size:"small",icon:g(se),circle:""},null,8,["type","icon"])]),default:r(()=>[e("div",Ze,[e("h4",null,n($.value.title),1),e("p",null,n($.value.description),1)])]),_:1})):m("",!0)])])]),e("div",et,[e("div",tt,[i(Z,{class:"topic-detail-card"},{header:r(()=>[e("div",st,[t[2]||(t[2]=e("span",{class:"detail-title"},"详细信息",-1)),i(d,{size:"small",text:"",onClick:ve,class:"collapse-btn"},{default:r(()=>[k(n(E.value?"展开":"收起")+" ",1),i(z,null,{default:r(()=>[E.value?(l(),y(g(Me),{key:0})):(l(),y(g(De),{key:1}))]),_:1})]),_:1})])]),default:r(()=>[e("div",{class:V(["detail-content",{collapsed:E.value}])},[e("div",at,[e("div",lt,[e("div",ot,[t[3]||(t[3]=e("span",{class:"time-label"},"开始时间",-1)),e("span",it,n(X(a.value.startTime)),1)]),t[5]||(t[5]=e("div",{class:"time-separator"}," → ",-1)),e("div",nt,[t[4]||(t[4]=e("span",{class:"time-label"},"结束时间",-1)),e("span",rt,n(X(a.value.endTime)),1)])]),h.value||f.value?(l(),u("div",ct,[h.value&&b.value?(l(),y(C,{key:0,type:"warning",size:"small"},{default:r(()=>t[6]||(t[6]=[k(" 尚未开始 ")])),_:1})):m("",!0),f.value?(l(),y(C,{key:1,type:"danger",size:"small"},{default:r(()=>t[7]||(t[7]=[k(" 已过期 ")])),_:1})):m("",!0)])):m("",!0)]),e("div",ut,[e("div",dt,[t[8]||(t[8]=e("span",{class:"info-label"},"主题代码",-1)),e("span",pt,n(a.value.code||"暂无数据"),1)]),e("div",vt,[t[9]||(t[9]=e("span",{class:"info-label"},"负责人",-1)),e("span",mt,n(a.value.principalName||"暂无数据"),1)]),a.value.timeRangeType?(l(),u("div",_t,[t[10]||(t[10]=e("span",{class:"info-label"},"时间策略",-1)),e("span",ft,[k(n(ge(a.value.timeRangeType))+" ",1),W.value?(l(),y(we,{key:0,content:W.value,placement:"top"},{default:r(()=>[i(z,{class:"ml-5"},{default:r(()=>[i(g(se))]),_:1})]),_:1},8,["content"])):m("",!0)])])):m("",!0)]),a.value.tagList&&a.value.tagList.length>0?(l(),u("div",gt,[t[11]||(t[11]=e("div",{class:"section-title"}," 标签 ",-1)),e("div",yt,[(l(!0),u(j,null,H(a.value.tagList,o=>(l(),y(C,{key:o.id,class:"topic-tag",size:"small",effect:"plain",style:Le({backgroundColor:o.backgroundColor||o.color,color:o.textColor})},{default:r(()=>[k(n(o.name),1)]),_:2},1032,["style"]))),128))])])):m("",!0),a.value.description?(l(),u("div",Tt,[t[12]||(t[12]=e("div",{class:"section-title"}," 描述 ",-1)),e("div",ht,[i(Ae,{"model-value":a.value.description,height:"auto",theme:"light"},null,8,["model-value"])])])):m("",!0)],2)]),_:1})]),e("div",bt,[i(Z,{class:"problem-list-card"},{header:r(()=>[e("div",kt,[e("div",wt,[t[13]||(t[13]=e("span",{class:"list-title"},"题目列表",-1)),e("div",xt,[e("span",Ct," 第 "+n(v.value)+" 页，共 "+n(M.value)+" 页 ",1),e("span",Rt," 总计 "+n(x.value.length)+" 题 ",1)])]),e("div",St,[i(xe,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=o=>S.value=o),size:"small",style:{width:"110px"},onChange:pe},{default:r(()=>[i(A,{label:"5题/页",value:5}),i(A,{label:"10题/页",value:10}),i(A,{label:"15题/页",value:15}),i(A,{label:"20题/页",value:20})]),_:1},8,["modelValue"])])])]),default:r(()=>[M.value>1?(l(),u("div",Pt,[i(d,{disabled:v.value<=1,onClick:ce,icon:g(ee),size:"small",class:"page-btn"},{default:r(()=>t[14]||(t[14]=[k(" 上一页 ")])),_:1},8,["disabled","icon"]),e("div",It,[(l(!0),u(j,null,H(re.value,o=>(l(),u("span",{key:o,class:V(["page-indicator",{active:o===v.value,ellipsis:o==="..."}]),onClick:O=>o!=="..."&&de(o)},n(o),11,Mt))),128))]),i(d,{disabled:v.value>=M.value,onClick:ue,icon:g(Ee),size:"small",class:"page-btn"},{default:r(()=>t[15]||(t[15]=[k(" 下一页 ")])),_:1},8,["disabled","icon"])])):m("",!0),e("div",Dt,[x.value.length===0?(l(),y(F,{key:0,description:"暂无题目",class:"empty-state"})):h.value?(l(),u("div",Et,[i(F,{description:"主题未开始，无法查看题目","image-size":120})])):f.value&&b.value?(l(),u("div",zt,[i(F,{description:"主题已过期，无法查看题目","image-size":120})])):(l(),u("div",Lt,[(l(!0),u(j,null,H(ne.value,(o,O)=>(l(),u("div",{key:o.id,class:V(["problem-card",{disabled:f.value||h.value}]),onClick:jt=>ke(o,K(O))},[e("div",Bt,[e("span",Gt,"#"+n(K(O)+1),1),e("span",$t,n(o.problemKey),1),t[16]||(t[16]=e("div",{class:"problem-status"},null,-1))]),e("div",At,[e("h4",Vt,n(o.title),1),e("div",Ut,[i(te,{enum:g($e)||_e,code:o.problemType||"PROGRAMMING","background-color":"#f0f2f5",color:"#606266",class:"problem-type-tag"},null,8,["enum","code"]),o.difficulty?(l(),y(C,{key:0,size:"small",type:be(o.difficulty),effect:"light",class:"difficulty-tag"},{default:r(()=>[k(n(he(o.difficulty)),1)]),_:2},1032,["type"])):m("",!0)])]),h.value||f.value&&b.value?(l(),u("div",Yt,[i(z,{class:"lock-icon"},{default:r(()=>[i(g(Ne))]),_:1}),e("span",Ft,n(h.value?"未开始":"已过期"),1)])):m("",!0)],10,Nt))),128))]))])]),_:1})])])])}}}),Zt=ie(Ot,[["__scopeId","data-v-26432ef7"]]);export{Zt as default};
