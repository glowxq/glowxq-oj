import{h as f,O as c,d as Y,bc as F,aB as R,r as U,f as u,o as y,x as h,k as a,a as p,j as l,y as v,T as q,c as z,P as G,Q,u as W,t as H,W as M,_ as K}from"./index-DTkCE7MD.js";import{U as X}from"./Img-CbqiKKTP.js";import{M as Z}from"./TagSelect-BSg1hRn-.js";import{C as ee}from"./ColorSelect-DZmuTeqD.js";const ce=d=>f.post(c+"/oj-user/listPage",d,{loading:!1}),ge=d=>{const{id:_}=d;return f.get(c+`/oj-user/${_}`)},ve=d=>f.post(c+"/oj-user",d),be=d=>f.put(c+"/oj-user",d),_e=d=>f.delete(c+"/oj-user",d),le=d=>f.get(c+"/oj-user/bind-info",d),we=d=>f.get(c+"/oj-user/bind-info/getBindInfo",d),ae={class:"form-section"},oe={class:"form-section"},te={class:"form-section"},re={class:"form-section"},se={class:"form-section"},ne={class:"dialog-footer"},ue=Y({name:"UserEdit",__name:"UserEdit",setup(d,{expose:_}){const S=F(),I=R({name:[{required:!0,message:"真实姓名是必填项",trigger:"blur"},{min:2,max:20,message:"真实姓名长度应在2到20个字符之间",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]}),g=U(!1),o=U({title:"",row:{},api:void 0,getTableList:void 0}),k=async s=>{try{const{data:e}=await le({userId:s});if(e){const i={...o.value.row};e.tags&&e.tags.length>0?i.tagIds=e.tags.map(r=>r.id):i.tagIds=[],e.ojUserInfo&&Object.assign(i,e.ojUserInfo),o.value.row=i,console.log("用户绑定信息加载完成:",o.value.row)}}catch(e){console.error("获取用户标签和班级信息失败:",e),M.error("获取用户标签和班级信息失败")}},O=async s=>{if(o.value={title:"",row:{},api:void 0,getTableList:void 0},o.value={...s},g.value=!0,s.row&&s.row.id){const e={...s.row};await k(s.row.id),o.value.row&&(o.value.row.id=e.id,!o.value.row.username&&e.username&&(o.value.row.username=e.username))}else o.value.row.tagIds=[]},x=U(),C=()=>{x.value.validate(async s=>{if(s)try{const e={...o.value.row};await o.value.api(e),M.success({message:`${o.value.title}成功！`}),o.value.getTableList(),g.value=!1}catch(e){console.log(e)}})},j=s=>{console.log(s)},D=()=>{const s=Math.floor(Math.random()*1e4),e=[0,1,2],i=e[Math.floor(Math.random()*e.length)],r=["https://api.dicebear.com/7.x/avataaars/svg?seed=edit1","https://api.dicebear.com/7.x/avataaars/svg?seed=edit2","https://api.dicebear.com/7.x/avataaars/svg?seed=edit3","https://api.dicebear.com/7.x/personas/svg?seed=edit4","https://api.dicebear.com/7.x/personas/svg?seed=edit5"];return{nickname:`编辑用户${s}`,name:`李编辑${s}`,phone:`139${String(Math.floor(Math.random()*1e8)).padStart(8,"0")}`,email:`edit${s}@example.com`,sex:i,birthday:"1990-08-20",idCard:`${Math.floor(Math.random()*9e5)+1e5}199008201234`,acNum:Math.floor(Math.random()*150),integral:Math.floor(Math.random()*8e3),continuousSignDay:Math.floor(Math.random()*50),submitNum:Math.floor(Math.random()*300),title:"编辑测试称号",color:"#52C41A",accountStatusCd:"1",tagIds:[1,3],logo:r[Math.floor(Math.random()*r.length)]}},N=()=>{const s=D();Object.assign(o.value.row,s),M.success("测试数据已填充！")};return _({acceptParams:O}),(s,e)=>{const i=u("el-input"),r=u("el-form-item"),n=u("el-col"),m=u("el-row"),w=u("el-option"),T=u("el-select"),$=u("el-date-picker"),b=u("el-input-number"),B=u("el-radio-button"),E=u("el-radio-group"),J=u("Avatar"),L=u("el-icon"),P=u("el-form"),V=u("el-button"),A=u("el-dialog");return y(),h(A,{modelValue:g.value,"onUpdate:modelValue":e[18]||(e[18]=t=>g.value=t),title:`${o.value.title}`,"destroy-on-close":!0,width:"700px",draggable:"","append-to-body":"",class:"apple-style-dialog"},{footer:a(()=>[p("div",ne,[l(V,{onClick:e[17]||(e[17]=t=>g.value=!1),class:"cancel-btn"},{default:a(()=>e[26]||(e[26]=[v(" 取消 ")])),_:1}),l(V,{type:"warning",onClick:N,class:"test-btn",plain:""},{default:a(()=>e[27]||(e[27]=[v(" 🧪 一键测试 ")])),_:1}),l(V,{type:"primary",onClick:C,class:"submit-btn"},{default:a(()=>e[28]||(e[28]=[v(" 确定 ")])),_:1})])]),default:a(()=>[l(P,{ref_key:"ruleFormRef",ref:x,"label-width":"90px","label-suffix":" :",rules:I,model:o.value.row,onSubmit:q(C,["prevent"]),class:"form__label apple-form"},{default:a(()=>[p("div",ae,[e[19]||(e[19]=p("h3",{class:"section-title"},"基本信息",-1)),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"账户"},{default:a(()=>[l(i,{modelValue:o.value.row.username,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.row.username=t),disabled:"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"昵称",prop:"nickname"},{default:a(()=>[l(i,{modelValue:o.value.row.nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.row.nickname=t),placeholder:"请填写昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"真实姓名",prop:"name"},{default:a(()=>[l(i,{modelValue:o.value.row.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.row.name=t),placeholder:"请填写真实姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"手机号",prop:"phone"},{default:a(()=>[l(i,{modelValue:o.value.row.phone,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.row.phone=t),placeholder:"请填写手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"邮箱",prop:"email"},{default:a(()=>[l(i,{modelValue:o.value.row.email,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.row.email=t),placeholder:"请填写邮箱地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"性别",prop:"sex"},{default:a(()=>[l(T,{modelValue:o.value.row.sex,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.row.sex=t),clearable:"",placeholder:"请选择性别",class:"w-full"},{default:a(()=>[l(w,{label:"未知",value:0}),l(w,{label:"男",value:1}),l(w,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"生日",prop:"birthday"},{default:a(()=>[l($,{modelValue:o.value.row.birthday,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.row.birthday=t),type:"date",placeholder:"选择生日","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"身份证",prop:"idCard"},{default:a(()=>[l(i,{modelValue:o.value.row.idCard,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.row.idCard=t),placeholder:"请填写身份证",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",oe,[e[20]||(e[20]=p("h3",{class:"section-title"},"数据统计",-1)),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"AC数量",prop:"acNum"},{default:a(()=>[l(b,{modelValue:o.value.row.acNum,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.row.acNum=t),min:0,placeholder:"AC数量",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"用户积分",prop:"integral"},{default:a(()=>[l(b,{modelValue:o.value.row.integral,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.row.integral=t),min:0,placeholder:"用户积分",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"连续签到",prop:"continuousSignDay"},{default:a(()=>[l(b,{modelValue:o.value.row.continuousSignDay,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.row.continuousSignDay=t),min:0,placeholder:"连续签到天数",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"提交数量",prop:"submitNum"},{default:a(()=>[l(b,{modelValue:o.value.row.submitNum,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.row.submitNum=t),min:0,placeholder:"提交题目数量",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",te,[e[21]||(e[21]=p("h3",{class:"section-title"},"个性化设置",-1)),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"称号",prop:"title"},{default:a(()=>[l(i,{modelValue:o.value.row.title,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.row.title=t),placeholder:"请填写称号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:a(()=>[l(r,{label:"颜色",prop:"color"},{default:a(()=>[l(ee,{modelValue:o.value.row.color,"onUpdate:modelValue":e[13]||(e[13]=t=>o.value.row.color=t),showPreview:!0,previewText:o.value.row.title||"称号预览"},null,8,["modelValue","previewText"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(r,{label:"状态",prop:"accountStatusCd"},{default:a(()=>[l(E,{modelValue:o.value.row.accountStatusCd,"onUpdate:modelValue":e[14]||(e[14]=t=>o.value.row.accountStatusCd=t)},{default:a(()=>[(y(!0),z(G,null,Q(W(S).getDictOptions("account_status"),t=>(y(),h(B,{key:t.id,label:t.id},{default:a(()=>[v(H(t.codeName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),p("div",re,[e[22]||(e[22]=p("h3",{class:"section-title"},"分组与标签",-1)),l(m,{gutter:20},{default:a(()=>[l(n,{span:24},{default:a(()=>[l(r,{label:"标签",prop:"tagIds"},{default:a(()=>[l(Z,{modelValue:o.value.row.tagIds,"onUpdate:modelValue":e[15]||(e[15]=t=>o.value.row.tagIds=t),multiple:!0,placeholder:"请选择用户标签"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{gutter:20},{default:a(()=>[l(n,{span:24})]),_:1})]),p("div",se,[e[25]||(e[25]=p("h3",{class:"section-title"},"头像上传",-1)),l(m,null,{default:a(()=>[l(r,{label:"头像",prop:"logo"},{default:a(()=>[l(X,{"image-url":o.value.row.logo,"onUpdate:imageUrl":e[16]||(e[16]=t=>o.value.row.logo=t),onChange:j,dir:"user",width:"135px",height:"135px","border-radius":"50%","use-oss":!0},{empty:a(()=>[l(L,null,{default:a(()=>[l(J)]),_:1}),e[23]||(e[23]=p("span",null,"请上传头像",-1))]),tip:a(()=>e[24]||(e[24]=[v(" 头像大小不能超过 3M ")])),_:1},8,["image-url"])]),_:1})]),_:1})])]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),de=K(ue,[["__scopeId","data-v-93c4ec11"]]),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{de as U,ve as a,ge as b,we as c,_e as d,be as e,Ve as f,ce as g};
