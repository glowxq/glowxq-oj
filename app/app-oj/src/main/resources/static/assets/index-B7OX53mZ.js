import{d as ee,q as oe,r as P,o as n,c as te,j as p,k as l,i as u,x as f,y as d,u as i,a_ as re,a$ as A,D as _,b0 as ae,R as k,bL as le,b1 as ie,l as me,b4 as h,W as $,f as pe,g as se,_ as ne}from"./index-DTkCE7MD.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{P as O}from"./ProblemType-TBlMUhPx.js";import{P as M}from"./ProgramType-C5wHKcT4.js";import{D as T}from"./DifficultyLevel-DrWtmZg7.js";import{P as ce}from"./ProblemSourceType-ColSuHcx.js";import{g as ue,a as fe,u as be,c as ge,r as j,d as ye,e as Te}from"./problem-CJE_etNM.js";import{u as B}from"./useHandleData-BdxQ-8Ab.js";import Pe from"./ProblemForm-CPB2O4H0.js";import{I as he,d as ke,u as ve}from"./common-DxSkM119.js";import{M as Le}from"./TagSelect-BSg1hRn-.js";import{J}from"./JudgeSettingsForm-BwsWiRCD.js";import{E as v}from"./EnumSelect-C2fXZs6G.js";import De from"./ImportProgramDialog-8HBat5rd.js";import _e from"./ImportBatchProgramDialog-ChQx0cuF.js";import"./sortable.esm-Cw1ESr5Y.js";import"./BasicInfoForm-DOGfcl0w.js";import"./index-E5zgXN01.js";import"./style-DrPmFrlE.js";import"./upload-BtJOZC1L.js";import"./FileSaver.min-BnsyPtRb.js";import"./metaTag-XZEJwT5o.js";import"./metaTagCategory-DYsFMRBy.js";import"./ProgrammingContent-UMXw1Utx.js";import"./ObjectiveForm-DK-mSId0.js";import"./TestCaseForm-DWQ56pRq.js";import"./file-Cxx7VqTf.js";import"./TestCaseSample-BlHOxPzN.js";import"./metaLanguage-BU5JVUJz.js";const Ce={class:"problem-table-container"},Ie=ee({name:"ProblemView",__name:"index",setup(xe){const W=oe(),s=P(),U=[{type:"selection",width:80},{prop:"problemKey",label:"题目KEY",width:100},{prop:"title",label:"题目名称",width:200},{prop:"author",label:"作者"},{prop:"programType",label:"程序类型",slot:"programType",width:100},{prop:"problemType",label:"题目类型",slot:"problemType",width:100},{prop:"sourceType",label:"来源"},{prop:"difficulty",label:"难度",slot:"difficulty"},{prop:"auth",label:"权限"},{prop:"source",label:"来源"},{prop:"judgeMode",label:"评测模式",width:120},{prop:"requireImage",label:"图片"},{prop:"operation",label:"操作",width:250,fixed:"right"}],q=[{prop:"problemKey",label:"题目KEY",el:"input"},{prop:"title",label:"题目名称",el:"input"},{prop:"programType",label:"程序类型",render:o=>h(v,{type:"select",enumData:M,modelValue:o.searchParam.programType,"onUpdate:modelValue":e=>{o.searchParam.programType=e}})},{prop:"problemType",label:"题目类型",render:o=>h(v,{type:"select",enumData:O,modelValue:o.searchParam.problemType,"onUpdate:modelValue":e=>{o.searchParam.problemType=e}})},{prop:"sourceType",label:"来源类型",render:o=>h(v,{type:"select",enumData:ce,modelValue:o.searchParam.sourceType,"onUpdate:modelValue":e=>{o.searchParam.sourceType=e}})},{prop:"tagIds",label:"标签",render:o=>h(Le,{multiple:!0,modelValue:o.searchParam.tagIds,"onUpdate:modelValue":e=>{o.searchParam.tagIds=e}})},{prop:"description",label:"描述",el:"input"},{prop:"judgeMode",label:"评测模式",render:o=>h(v,{type:"select",enumData:J,modelValue:o.searchParam.judgeMode,"onUpdate:modelValue":e=>{o.searchParam.judgeMode=e}})},{prop:"requireImage",label:"需要图片",el:"switch"}],K=o=>{let e=C(o);return ue(e)},C=o=>{let e=JSON.parse(JSON.stringify(o));return e.timeLimit&&(e.timeLimitStart=e.timeLimit[0]),e.timeLimit&&(e.timeLimitEnd=e.timeLimit[1]),delete e.timeLimit,e.memoryLimit&&(e.memoryLimitStart=e.memoryLimit[0]),e.memoryLimit&&(e.memoryLimitEnd=e.memoryLimit[1]),delete e.memoryLimit,e.createTime&&(e.createTimeStart=e.createTime[0]),e.createTime&&(e.createTimeEnd=e.createTime[1]),delete e.createTime,e.updateTime&&(e.updateTimeStart=e.updateTime[0]),e.updateTime&&(e.updateTimeEnd=e.updateTime[1]),delete e.updateTime,e},L=P(),I=async(o,e={},t=!0)=>{var m,r,b,N;if(t)(N=L.value)==null||N.acceptParams({title:o,row:{...e},api:ge,getTableList:(b=s.value)==null?void 0:b.getTableList});else try{const g=await fe({id:e==null?void 0:e.id});if(g!=null&&g.data){const a={...g.data,id:g.data.id||e.id};if(console.log("编辑题目，获取的详情数据:",a),a.problemBo&&console.log("题目problemBo数据:",a.problemBo),console.log("标签数据:",a.tagList||"无标签数据"),console.log("测试用例数据:",a.problemCaseDataList||"无测试用例数据"),a.codeTemplates&&Array.isArray(a.codeTemplates)){console.log("代码模板原始数据:",JSON.stringify(a.codeTemplates)),console.log("代码模板数量:",a.codeTemplates.length);const D=a.codeTemplates.map(y=>{var w,V;const c={...y,languageId:y.languageId||y.id,code:y.code||y.codeTemplate||"",codeTemplate:y.codeTemplate||y.code||"",isCustomized:!0};return c.code&&c.code.length>0&&console.log(`模板 ${c.languageId} 包含自定义代码，长度: ${c.code.length}`),console.log(`处理模板: ID=${c.languageId}, 代码: ${(w=c.code)==null?void 0:w.substring(0,50)}${((V=c.code)==null?void 0:V.length)>50?"...":""}`),c});JSON.stringify(D)!==JSON.stringify(a.codeTemplates)&&(console.log("更新代码模板格式，原格式数量:",a.codeTemplates.length),console.log("更新后格式数量:",D.length),a.codeTemplates=D),console.log("最终格式化后的代码模板数据:",JSON.stringify(a.codeTemplates))}else console.log("无代码模板数据");(r=L.value)==null||r.acceptParams({title:o,row:a,api:be,getTableList:(m=s.value)==null?void 0:m.getTableList})}else $.error("获取题目详情失败")}catch(g){console.error("获取题目详情出错:",g),$.error("获取题目详情出错")}},Y=async o=>{var e;await B(j,{ids:[o.id]},`删除【${o.id}】题目`),(e=s.value)==null||e.getTableList()},H=async o=>{var e,t;await B(j,{ids:o},"删除所选题目"),(e=s.value)==null||e.clearSelection(),(t=s.value)==null||t.getTableList()},x=P(),E=P(),R=P(),F=()=>{var e,t;const o={title:"题目",templateName:"题目",tempApi:ke,importApi:ye,getTableList:(e=s.value)==null?void 0:e.getTableList};(t=x.value)==null||t.acceptParams(o)},z=()=>{var o;(o=E.value)==null||o.open()},G=()=>{var o;(o=R.value)==null||o.open()},S=()=>{var o;(o=s.value)==null||o.getTableList()},X=async()=>{var e;let o=C((e=s.value)==null?void 0:e.searchParam);ve(Te,"题目",o)},Q=o=>{if(!Object.values(T).find(t=>Number(t.code)===Number(o)))return{backgroundColor:"#f4f4f5",color:"#909399"};switch(Number(o)){case Number(T.ENTRY.code):case Number(T.EASY.code):return{backgroundColor:"#f0f9eb",color:"#67c23a",borderRadius:"4px",fontWeight:"bold"};case Number(T.MEDIUM.code):return{backgroundColor:"#fdf6ec",color:"#e6a23c",borderRadius:"4px",fontWeight:"bold"};case Number(T.HARD.code):return{backgroundColor:"#fef0f0",color:"#f56c6c",borderRadius:"4px",fontWeight:"bold"};case Number(T.EXPERT.code):return{backgroundColor:"#f4f4f5",color:"#909399",borderRadius:"4px",fontWeight:"bold"};default:return{backgroundColor:"#f4f4f5",color:"#909399",borderRadius:"4px",fontWeight:"bold"}}},Z=o=>{W.push(`/oj/problem/submit/${o.id}`)};return(o,e)=>{const t=pe("el-button"),m=se("auth");return n(),te("div",Ce,[p(de,{ref_key:"proTableRef",ref:s,title:"题目",indent:20,columns:U,"search-columns":q,"request-api":K,"row-key":"id",class:"problem-table"},{tableHeader:l(r=>[u((n(),f(t,{type:"primary",icon:i(re),onClick:e[0]||(e[0]=b=>I("新增题目"))},{default:l(()=>e[1]||(e[1]=[d(" 新增 ")])),_:1},8,["icon"])),[[m,"problem.create"]]),u((n(),f(t,{type:"danger",icon:i(A),plain:"",disabled:!r.isSelected,onClick:b=>H(r.selectedListIds)},{default:l(()=>e[2]||(e[2]=[d(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[m,"problem.remove"]]),u((n(),f(t,{type:"primary",icon:i(_),plain:"",onClick:F},{default:l(()=>e[3]||(e[3]=[d(" 导入 ")])),_:1},8,["icon"])),[[m,"problem.import"]]),u((n(),f(t,{type:"primary",icon:i(_),plain:"",onClick:z},{default:l(()=>e[4]||(e[4]=[d(" 编程题导入 ")])),_:1},8,["icon"])),[[m,"problem.import"]]),u((n(),f(t,{type:"primary",icon:i(_),plain:"",onClick:G},{default:l(()=>e[5]||(e[5]=[d(" 编程题批量导入 ")])),_:1},8,["icon"])),[[m,"problem.import"]]),u((n(),f(t,{type:"primary",icon:i(ae),plain:"",onClick:X},{default:l(()=>e[6]||(e[6]=[d(" 导出 ")])),_:1},8,["icon"])),[[m,"problem.export"]])]),programType:l(({row:r})=>[p(k,{enum:i(M),code:r.programType},null,8,["enum","code"])]),problemType:l(({row:r})=>[p(k,{enum:i(O),code:r.problemType},null,8,["enum","code"])]),difficulty:l(({row:r})=>[p(k,le({enum:i(T),code:r.difficulty},Q(r.difficulty),{class:"difficulty-tag"}),null,16,["enum","code"])]),judgeMode:l(({row:r})=>[p(k,{enum:i(J),code:r.judgeMode,backgroundColor:"#f4f4f5",color:"#909399",borderRadius:"4px",fontWeight:"bold",class:"judge-mode-tag"},null,8,["enum","code"])]),operation:l(({row:r})=>[u((n(),f(t,{type:"primary",link:"",icon:i(ie),onClick:b=>I("编辑题目",r,!1)},{default:l(()=>e[7]||(e[7]=[d(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[m,"problem.update"]]),u((n(),f(t,{type:"primary",link:"",icon:i(A),onClick:b=>Y(r)},{default:l(()=>e[8]||(e[8]=[d(" 删除 ")])),_:2},1032,["icon","onClick"])),[[m,"problem.remove"]]),p(t,{type:"success",link:"",icon:i(me),onClick:b=>Z(r),class:"solve-button"},{default:l(()=>e[9]||(e[9]=[d(" 做题 ")])),_:2},1032,["icon","onClick"])]),_:1},512),p(Pe,{ref_key:"problemRef",ref:L},null,512),p(he,{ref_key:"ImportExcelRef",ref:x},null,512),p(De,{ref_key:"ImportOssDialogRef",ref:E,onSuccess:S},null,512),p(_e,{ref_key:"ImportBatchOssDialogRef",ref:R,onSuccess:S},null,512)])}}}),ao=ne(Ie,[["__scopeId","data-v-95731762"]]);export{ao as default};
