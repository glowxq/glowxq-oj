import{h as j,O as W,d as J,r as h,w as Q,o,c as n,a as s,j as d,u as R,t as u,m as C,k as r,y as f,P as U,Q as k,x as L,a0 as q,i as G,N as H,W as p,f as V,_ as K}from"./index-DTkCE7MD.js";import{E as X}from"./EnumSelect-C2fXZs6G.js";import{U as Y}from"./file-Cxx7VqTf.js";import{T as Z,a as E}from"./TestCaseSample-BlHOxPzN.js";import"./upload-BtJOZC1L.js";const $=(g,b="default")=>j.post(W+"/oj/problem-case/case/uploadTestcaseZipUrl",{},{params:{url:g,mode:b}}),ee={class:"testcase-container"},ae={class:"type-selection-section"},se={class:"type-selector"},te={key:0,class:"type-description"},le={key:1,class:"type-description"},oe={key:0},ie={class:"manual-edit-section"},ne={class:"section-title"},de={class:"samples-container manual-mode"},re={key:1},ue={class:"upload-section"},pe={class:"upload-card-content"},ce={class:"upload-info-area"},me={class:"upload-area"},_e={key:0,class:"upload-success-info"},ve={class:"upload-path-info"},fe={class:"path-value"},Ve={key:0,class:"uploaded-samples-section"},ye={class:"section-header"},he={class:"section-title"},Ce={class:"sample-count"},ge={class:"samples-container upload-mode"},be=J({name:"TestCaseForm",__name:"TestCaseForm",props:{modelValue:{},isEdit:{type:Boolean}},emits:["update:modelValue"],setup(g,{emit:b}){const t=g,c=b,i=h("ManualEditing"),S=h([]),D=h(t.modelValue.uploadTestcaseDir||""),m=h(!0),y=(a,e)=>{const l=Z[a];return l&&e in l?String(l[e]||""):""},F=a=>{const e=String(a);t.modelValue.problemCaseDataList.forEach(l=>{l.type=e}),e==="FileUpload"?t.modelValue.problemBo.uploadCase=!0:t.modelValue.problemBo.uploadCase=!1,c("update:modelValue",t.modelValue)},w=()=>{t.modelValue.problemCaseDataList.push({input:"",output:"",type:String(i.value),score:0,groupNum:0}),c("update:modelValue",t.modelValue)},B=a=>{t.modelValue.problemCaseDataList.splice(a,1),c("update:modelValue",t.modelValue)},I=a=>{const e=a.type==="application/zip"||a.type==="application/x-zip-compressed"||a.name.endsWith(".zip"),l=a.size/1024/1024<50;return e?l?(t.modelValue.problemBo.uploadCase=!0,c("update:modelValue",t.modelValue),!0):(p.error("上传文件大小不能超过50MB!"),!1):(p.error("上传文件必须是ZIP格式!"),!1)},M=a=>{if(a)try{P(a.url)}catch(e){console.error("处理ZIP文件出错:",e),p.error("处理ZIP文件失败")}},P=async a=>{try{const e=await $(a);e.data?N(e.data):p.error("处理ZIP文件失败: "+(e.message||"未知错误"))}catch(e){console.error("处理ZIP文件出错:",e),p.error("处理ZIP文件失败: "+(e.message||"未知错误"))}},N=a=>{if(a.fileList&&Array.isArray(a.fileList)){S.value=a.fileList;const e=a.fileList.map(l=>({input:l.input||"",output:l.output||"",type:String(i.value),score:l.score||0,groupNum:l.groupNum||0}));t.modelValue.problemCaseDataList=e}a.fileListDir&&(D.value=a.fileListDir,t.modelValue.uploadTestcaseDir=a.fileListDir),c("update:modelValue",t.modelValue),p.success("测试用例上传成功并已自动填充!")},z=()=>{m.value=!m.value};return Q(()=>t.modelValue,()=>{t.modelValue.problemCaseDataList&&t.modelValue.problemCaseDataList.length>0?i.value=t.modelValue.problemCaseDataList[0].type:t.modelValue.problemBo.uploadCase&&(i.value="FileUpload")},{immediate:!0}),(a,e)=>{const l=V("el-divider"),T=V("el-button"),x=V("el-alert"),A=V("el-card"),O=V("el-icon");return o(),n("div",ee,[s("div",ae,[e[1]||(e[1]=s("h3",{class:"section-title"},"测试用例类型",-1)),s("div",se,[d(X,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=_=>i.value=_),"enum-data":R(Z),type:"radio",placeholder:"请选择测试用例类型",onChange:F},null,8,["modelValue","enum-data"])]),i.value==="ManualEditing"?(o(),n("div",te,u(y("ManualEditing","text")),1)):i.value==="FileUpload"?(o(),n("div",le,u(y("FileUpload","text")),1)):C("",!0)]),i.value==="ManualEditing"?(o(),n("div",oe,[d(l,null,{default:r(()=>[f(u(y("ManualEditing","name")),1)]),_:1}),s("div",ie,[s("div",ne,[e[3]||(e[3]=s("h3",null,"测试用例列表",-1)),d(T,{type:"primary",onClick:w},{default:r(()=>e[2]||(e[2]=[f("添加测试用例")])),_:1})]),s("div",de,[(o(!0),n(U,null,k(a.modelValue.problemCaseDataList,(_,v)=>(o(),L(E,{key:v,sample:_,index:v,onRemove:B},null,8,["sample","index"]))),128))])])])):i.value==="FileUpload"?(o(),n("div",re,[d(l,null,{default:r(()=>[f(u(y("FileUpload","name")),1)]),_:1}),s("div",ue,[e[8]||(e[8]=s("h3",{class:"section-title"},"上传测试用例 (ZIP压缩包)",-1)),d(A,{class:"upload-card",shadow:"hover"},{default:r(()=>[s("div",pe,[s("div",ce,[e[5]||(e[5]=s("p",{class:"upload-description"}," 您可以上传包含所有测试用例的ZIP压缩包，系统会自动解析并提取测试用例 ",-1)),s("div",me,[d(Y,{"use-oss":!0,dir:"testcase",accept:".zip,.rar","file-size":50,"before-upload":I,onChange:M},{tip:r(()=>e[4]||(e[4]=[s("div",{class:"el-upload__tip"}," 请上传ZIP格式的压缩文件，文件大小不超过50MB ",-1)])),_:1})])]),D.value?(o(),n("div",_e,[d(x,{title:"上传成功",type:"success",closable:!1,"show-icon":""},{default:r(()=>[s("div",ve,[e[6]||(e[6]=s("p",{class:"path-label"},"文件存储路径:",-1)),s("p",fe,u(D.value),1)])]),_:1})])):C("",!0)])]),_:1}),a.modelValue.problemCaseDataList&&a.modelValue.problemCaseDataList.length>0?(o(),n("div",Ve,[s("div",ye,[s("h3",he,[e[7]||(e[7]=f("上传的测试用例数据 ")),s("span",Ce,"(共 "+u(a.modelValue.problemCaseDataList.length)+" 个)",1)]),d(T,{type:"primary",link:"",size:"small",onClick:z},{default:r(()=>[f(u(m.value?"收起":"展开")+" ",1),d(O,null,{default:r(()=>[(o(),L(q(m.value?"ArrowUp":"ArrowDown")))]),_:1})]),_:1})]),G(s("div",ge,[(o(!0),n(U,null,k(a.modelValue.problemCaseDataList,(_,v)=>(o(),L(E,{key:v,sample:_,index:v,readonly:!0},null,8,["sample","index"]))),128))],512),[[H,m.value]])])):C("",!0)])])):C("",!0)])}}}),Ze=K(be,[["__scopeId","data-v-468cf5ff"]]);export{Ze as default};
