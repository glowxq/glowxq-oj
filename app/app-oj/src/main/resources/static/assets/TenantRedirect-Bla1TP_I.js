import{d as k,a3 as B,q as U,v as x,a4 as R,a5 as b,a6 as K,r as _,e as P,o as i,c as u,a as n,j as l,k as c,u as d,a7 as A,a8 as E,t as M,a9 as V,m as L,aa as $,W as y,a1 as w,ab as H,f as h,_ as O}from"./index-DTkCE7MD.js";import{g as j}from"./tenant-BWmX3Yn9.js";const q={class:"tenant-redirect-container"},z={key:0,class:"tenant-card loading-wrapper"},D={class:"loading-spinner"},G={key:1,class:"tenant-card error-wrapper"},W={class:"error-icon"},F={class:"error-message"},J=k({__name:"TenantRedirect",setup(Q){const m=B(),g=U(),a=x(),p=R(),v=b(),N=K(),r=_(!0),t=_(""),C=async o=>{try{console.log("开始执行switchTenantByKey, 参数:",o),r.value=!0,t.value="",console.log("正在调用API获取租户信息...");const e=await j(o);if(console.log("API返回结果:",e),e.code==="0000"&&e.data){const s=e.data;if(console.log("成功获取租户信息:",s),!s.enable){console.warn("租户已被禁用:",s.tenantName),t.value="该租户已被禁用，无法切换";return}s.password?(console.log("租户需要密码验证:",s.tenantName),await T(s)):(console.log("租户无需密码验证，直接切换:",s.tenantName),f(s))}else console.error("获取租户信息失败:",e),t.value=e.message||`找不到租户: ${o}`}catch(e){console.error("租户切换失败:",e),t.value="租户切换失败，请稍后重试"}finally{r.value=!1}},T=o=>new Promise(e=>{$.prompt(`租户 ${o.tenantName} 需要密码验证，请输入密码`,"租户密码验证",{confirmButtonText:"确认",cancelButtonText:"取消",inputType:"password",inputPlaceholder:"请输入租户密码",customClass:"tenant-password-dialog"}).then(({value:s})=>{s===o.password?(f(o),e(!0)):(y.error("密码错误，无法切换租户"),t.value="密码验证失败",e(!1))}).catch(()=>{t.value="已取消租户切换",e(!1)})}),f=o=>{console.log("开始切换租户，数据:",o);const e={tenantId:o.tenantId||"",tenantName:o.tenantName||"",tenantCode:o.tenantCode||"",logoUrl:o.logoUrl||"",systemName:o.systemName||"",themeColor:o.themeColor||""};console.log("处理后的租户信息:",e),a.clearTenantInfo(),a.setTenantInfo(e),console.log("租户信息已保存到Store，验证结果:",{tenantId:a.tenantId,tenantName:a.tenantName,tenantCode:a.tenantCode,logoUrl:a.logoUrl,systemName:a.systemName,themeColor:a.themeColor}),y.success({message:`已切换到租户: ${o.tenantName}，即将跳转到登录页`,duration:2e3,customClass:"tenant-success-message"}),p.token?(console.log("检测到用户已登录，需要清除登录状态"),setTimeout(()=>{console.log("正在清除用户状态和Token..."),p.clear(),v.clear(),N.close(),console.log("正在跳转到登录页面..."),window.location.href=w},1500)):(console.log("检测到用户未登录，直接跳转到登录页"),setTimeout(()=>{console.log("未登录状态，直接跳转到登录页面..."),g.push(w)},1500))},I=()=>{g.push(H)};return P(()=>{const{tenantKey:o}=m.params;if(console.log("路由参数:",m.params),console.log("获取到的租户Key:",o),o&&typeof o=="string"){const e=o.toUpperCase();console.log("处理后的租户Key:",e),C(e)}else t.value="无效的租户参数",r.value=!1}),(o,e)=>{const s=h("el-icon"),S=h("el-button");return i(),u("div",q,[r.value?(i(),u("div",z,[n("div",D,[l(s,{class:"loading-icon is-loading"},{default:c(()=>[l(d(A))]),_:1})]),e[0]||(e[0]=n("h2",{class:"loading-title"},"租户切换中",-1)),e[1]||(e[1]=n("p",{class:"loading-message"},"正在处理您的请求，请稍候...",-1))])):t.value?(i(),u("div",G,[n("div",W,[l(s,null,{default:c(()=>[l(d(E))]),_:1})]),e[3]||(e[3]=n("h2",{class:"error-title"},"出现错误",-1)),n("p",F,M(t.value),1),l(S,{type:"primary",onClick:I,class:"apple-button"},{default:c(()=>[l(s,null,{default:c(()=>[l(d(V))]),_:1}),e[2]||(e[2]=n("span",null,"返回首页",-1))]),_:1})])):L("",!0)])}}}),Z=O(J,[["__scopeId","data-v-de22f4a1"]]);export{Z as default};
