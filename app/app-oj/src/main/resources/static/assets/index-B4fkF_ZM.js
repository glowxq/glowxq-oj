import{d as Re,s as ke,ad as Ae,b as _,q as Ce,r as T,aB as De,e as he,o as g,c as C,a as i,i as D,x as k,k as o,u as p,a_ as Ee,j as t,t as I,n as Y,dF as $e,a$ as we,D as Ie,b0 as Ue,az as B,bn as ze,N as Me,bo as Le,y as A,aQ as Pe,aJ as Ne,m as J,P as Ye,Q as Be,f as b,p as je,bk as U,bl as He,g as Fe,W as qe,_ as Ge}from"./index-DTkCE7MD.js";import Je from"./topic-D9nofP3e.js";import{a as Oe,g as O,c as K,u as Ke,r as Q,i as Qe,e as We}from"./topic-DtpaBxBf.js";import{u as W}from"./useHandleData-BdxQ-8Ab.js";import{O as Xe,T as Ze}from"./TopicForm-BswaDF5f.js";import et from"./TopicCard-ZBUZgfr-.js";import{I as tt,u as at,d as lt}from"./common-DxSkM119.js";import{M as ot}from"./TagSelect-BSg1hRn-.js";import{E as z}from"./EnumSelect-C2fXZs6G.js";import{B as X}from"./BlockButtonSwitch-BHBfrEBU.js";import{T as Z}from"./TimeRangeType-BW_JmSm6.js";import{T as nt}from"./TopicType-BfRQGLIH.js";import{T as st}from"./TopicJudgeType-B4cJ_xct.js";import"./problem-CJE_etNM.js";import"./ColorSelect-DZmuTeqD.js";import"./index-E5zgXN01.js";import"./style-DrPmFrlE.js";import"./upload-BtJOZC1L.js";import"./FileSaver.min-BnsyPtRb.js";import"./teacher-BaXmGp8W.js";import"./TopicInfoStatus-BMpq3Jyc.js";import"./metaTag-XZEJwT5o.js";import"./metaTagCategory-DYsFMRBy.js";const it={class:"topic-container"},rt={class:"button-group"},ut={class:"button-text"},dt={class:"toggle-text"},pt={class:"search-title"},ct={class:"search-content"},mt={key:0,class:"pagination-info"},ft={class:"total-count"},gt={key:0,class:"selected-count"},vt={class:"count-num"},yt={class:"topic-card-container"},_t={key:0,class:"empty-data"},bt={class:"pagination-container"},Tt=Re({name:"TopicView",__name:"index",setup(Vt){je(a=>({"60d22e52":p(V),"0feea7fa":h.value,"4d47d00c":M.value,"55870a8d":te.value,"8fc3cb4e":ae.value,e95f11a4:le.value,"4052511e":oe.value,"564fa174":ne.value,47001395:se.value,d4a240ce:ie.value}));const ee=ke(),{primary:V}=Ae(ee),h=_(()=>U(V.value,.1)),M=_(()=>He(V.value,.1)),te=_(()=>U(V.value,.8)),ae=_(()=>`linear-gradient(135deg, ${h.value}, ${M.value})`),le=_(()=>`linear-gradient(135deg, ${U(V.value,.95)}, ${U(V.value,.9)})`),oe=_(()=>"rgba(0, 0, 0, 0.1)"),ne=_(()=>"rgba(0, 0, 0, 0.25)"),se=_(()=>`linear-gradient(90deg, ${h.value}, ${M.value}, ${h.value})`),ie=_(()=>"linear-gradient(90deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.05))"),L=Ce(),j=T(L.currentRoute.value.query.topicType),P=T(),H=T(),x=T(1),E=T(8),v=T(0),l=De({topicType:j}),c=T([]),m=T([]),S=T(!1),F=()=>{S.value=!S.value},N=_(()=>c.value.length>0&&m.value.length===c.value.length),re=()=>{N.value?m.value=[]:m.value=c.value.map(a=>({...a}))},f=async()=>{try{const a={page:x.value,limit:E.value,topicType:j.value};Object.entries(l).forEach(([n,u])=>{u!=null&&u!==""&&(a[n]=u)}),l.timeRange1&&Array.isArray(l.timeRange1)&&(a.startTimeStart=l.timeRange1[0],a.startTimeEnd=l.timeRange1[1]),l.timeRange2&&Array.isArray(l.timeRange2)&&(a.endTimeStart=l.timeRange2[0],a.endTimeEnd=l.timeRange2[1]);const e=await Oe(a);if(console.log("API响应:",e),e.data)if(Array.isArray(e.data))c.value=e.data,v.value=e.data.length;else{const n=e.data;n.rows&&Array.isArray(n.rows)?(c.value=n.rows,v.value=n.total||n.rows.length):n.records&&Array.isArray(n.records)?(c.value=n.records,v.value=n.total||n.records.length):n.list&&Array.isArray(n.list)?(c.value=n.list,v.value=n.total||n.list.length):(console.error("未能识别的数据结构:",n),c.value=[],v.value=0)}else console.error("API响应中没有data属性"),c.value=[],v.value=0}catch(a){console.error("获取主题列表失败",a),c.value=[],v.value=0}},ue=()=>{Object.keys(l).forEach(a=>{delete l[a]}),x.value=1,f()},de=a=>{x.value=a,f()},pe=a=>{E.value=a,x.value=1,f()},q=async(a,e={},n=!0)=>{var y;if(!n){const r=await O({id:e==null?void 0:e.id});e=r==null?void 0:r.data}const u={title:a,row:{...e},api:n?K:Ke,getTableList:f};(y=P.value)==null||y.acceptParams(u)},ce=async a=>{await W(Q,{ids:[a.id]},`删除【${a.name}】主题`),f()},me=async a=>{const e=a.filter(n=>n!==void 0);await W(Q,{ids:e},"删除所选主题"),m.value=[],f()},fe=()=>{var e;const a={title:"主题",templateName:"主题",tempApi:lt,importApi:Qe,getTableList:f};(e=H.value)==null||e.acceptParams(a)},ge=async()=>{const a={};for(const e in l)l[e]!==void 0&&l[e]!==null&&l[e]!==""&&(a[e]=l[e]);l.timeRange1&&Array.isArray(l.timeRange1)&&(a.startTimeStart=l.timeRange1[0],a.startTimeEnd=l.timeRange1[1]),l.timeRange2&&Array.isArray(l.timeRange2)&&(a.endTimeStart=l.timeRange2[0],a.endTimeEnd=l.timeRange2[1]),at(We,"主题",a)},ve=a=>{if(a.timeRangeType===Z.STRICT_TIME_VIEW.code&&a.startTime){const n=new Date,u=new Date(a.startTime);if(n<u){qe({message:`该主题采用严格时间策略，将于 ${_e(a.startTime)} 开放查看`,type:"warning",duration:3e3});return}}L.push({path:`/oj/topic/doTopic/${a.id}`,query:{topicName:a.name,topicCode:a.code}})},ye=a=>{L.push({path:`/oj/topic/detail/${a.id}`,query:{topicName:a.name,topicCode:a.code}})},_e=a=>{if(!a)return"";const e=new Date(a),n=e.getFullYear(),u=(e.getMonth()+1).toString().padStart(2,"0"),y=e.getDate().toString().padStart(2,"0"),r=e.getHours().toString().padStart(2,"0"),d=e.getMinutes().toString().padStart(2,"0");return`${n}年${u}月${y}日 ${r}:${d}`},be=async a=>{var y;if(!(a!=null&&a.id))return;const e=await O({id:a.id}),n={...e==null?void 0:e.data};delete n.id,n.name=`${n.name}(复制)`;const u={title:"新增主题",row:n,api:K,getTableList:f};(y=P.value)==null||y.acceptParams(u)},Te=a=>{const e=m.value.findIndex(n=>n.id===a.id);e>-1?m.value.splice(e,1):m.value.push(a)};return he(()=>{f()}),(a,e)=>{const n=b("el-button"),u=b("el-icon"),y=b("el-input"),r=b("el-form-item"),d=b("el-col"),R=b("el-row"),G=b("el-date-picker"),Ve=b("el-form"),xe=b("el-empty"),Se=b("el-pagination"),$=Fe("auth");return g(),C("div",it,[i("div",rt,[D((g(),k(n,{icon:p(Ee),class:"cute-button create-button",type:"primary",onClick:e[0]||(e[0]=s=>q("新增主题"))},{default:o(()=>e[16]||(e[16]=[i("span",{class:"button-text"},"新增",-1),i("span",{class:"button-effect"},null,-1)])),_:1},8,["icon"])),[[$,"topic.create"]]),t(n,{class:Y([{"is-selected":N.value},"cute-button select-button"]),icon:p($e),type:"default",onClick:re},{default:o(()=>[i("span",ut,I(N.value?"取消全选":"全选"),1)]),_:1},8,["class","icon"]),D((g(),k(n,{disabled:!m.value.length,icon:p(we),class:"cute-button delete-button",plain:"",type:"danger",onClick:e[1]||(e[1]=s=>me(m.value.map(w=>w.id)))},{default:o(()=>e[17]||(e[17]=[i("span",{class:"button-text"},"批量删除",-1),i("span",{class:"button-effect"},null,-1)])),_:1},8,["disabled","icon"])),[[$,"topic.remove"]]),D((g(),k(n,{icon:p(Ie),class:"cute-button import-button",plain:"",type:"primary",onClick:fe},{default:o(()=>e[18]||(e[18]=[i("span",{class:"button-text"},"导入",-1),i("span",{class:"button-effect"},null,-1)])),_:1},8,["icon"])),[[$,"topic.import"]]),D((g(),k(n,{icon:p(Ue),class:"cute-button export-button",plain:"",type:"primary",onClick:ge},{default:o(()=>e[19]||(e[19]=[i("span",{class:"button-text"},"导出",-1),i("span",{class:"button-effect"},null,-1)])),_:1},8,["icon"])),[[$,"topic.export"]]),i("div",{class:"search-toggle",onClick:F},[t(n,{icon:p(B),circle:""},null,8,["icon"]),i("span",dt,I(S.value?"收起筛选":"展开筛选"),1)])]),i("div",{class:Y([{expanded:S.value},"search-container"])},[i("div",{class:"search-header",onClick:F},[i("div",pt,[t(u,{class:"search-icon"},{default:o(()=>[t(p(B))]),_:1}),e[20]||(e[20]=i("span",null,"筛选条件",-1))]),t(u,{class:Y({"is-rotate":S.value})},{default:o(()=>[t(p(ze))]),_:1},8,["class"])]),D(i("div",ct,[t(Ve,{model:l,"label-width":"80px",onKeyup:Ne(f,["enter"])},{default:o(()=>[t(R,{gutter:30},{default:o(()=>[t(d,{span:6},{default:o(()=>[t(r,{label:"主题名"},{default:o(()=>[t(y,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=s=>l.name=s),clearable:"",placeholder:"请输入主题名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"主题代码"},{default:o(()=>[t(y,{modelValue:l.code,"onUpdate:modelValue":e[3]||(e[3]=s=>l.code=s),clearable:"",placeholder:"请输入主题代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"负责人"},{default:o(()=>[t(Le,{modelValue:l.principalUserId,"onUpdate:modelValue":e[4]||(e[4]=s=>l.principalUserId=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(R,{gutter:30},{default:o(()=>[t(d,{span:6},{default:o(()=>[t(r,{label:"时间策略"},{default:o(()=>[t(z,{modelValue:l.timeRangeType,"onUpdate:modelValue":e[5]||(e[5]=s=>l.timeRangeType=s),"enum-data":p(Z),type:"select"},null,8,["modelValue","enum-data"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"主题类型"},{default:o(()=>[t(z,{modelValue:l.topicType,"onUpdate:modelValue":e[6]||(e[6]=s=>l.topicType=s),"enum-data":p(nt),multiple:!0,type:"tab"},null,8,["modelValue","enum-data"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"判题模式"},{default:o(()=>[t(z,{modelValue:l.topicJudgeType,"onUpdate:modelValue":e[7]||(e[7]=s=>l.topicJudgeType=s),"enum-data":p(st),type:"tab"},null,8,["modelValue","enum-data"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"得分类型"},{default:o(()=>[t(z,{modelValue:l.oiScoreType,"onUpdate:modelValue":e[8]||(e[8]=s=>l.oiScoreType=s),"enum-data":p(Xe),type:"tab"},null,8,["modelValue","enum-data"])]),_:1})]),_:1})]),_:1}),t(R,{gutter:30},{default:o(()=>[t(d,{span:6},{default:o(()=>[t(r,{label:"公共主题"},{default:o(()=>[t(X,{"model-value":l.common==="true",text:"公共","onUpdate:modelValue":e[9]||(e[9]=s=>l.common=s?"true":"false")},null,8,["model-value"])]),_:1})]),_:1}),t(d,{span:6},{default:o(()=>[t(r,{label:"启用"},{default:o(()=>[t(X,{"model-value":l.enable==="true",text:"启用","onUpdate:modelValue":e[10]||(e[10]=s=>l.enable=s?"true":"false")},null,8,["model-value"])]),_:1})]),_:1}),t(d,{span:12},{default:o(()=>[t(r,{label:"标签"},{default:o(()=>[t(ot,{modelValue:l.tagIds,"onUpdate:modelValue":e[11]||(e[11]=s=>l.tagIds=s),multiple:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(R,{gutter:30},{default:o(()=>[t(d,{span:12},{default:o(()=>[t(r,{label:"开始时间"},{default:o(()=>[t(G,{modelValue:l.timeRange1,"onUpdate:modelValue":e[12]||(e[12]=s=>l.timeRange1=s),"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",style:{width:"100%"},type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:o(()=>[t(r,{label:"截止时间"},{default:o(()=>[t(G,{modelValue:l.timeRange2,"onUpdate:modelValue":e[13]||(e[13]=s=>l.timeRange2=s),"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",style:{width:"100%"},type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(R,null,{default:o(()=>[t(d,{span:24,style:{"text-align":"right"}},{default:o(()=>[t(n,{class:"search-button",type:"primary",onClick:f},{default:o(()=>[t(u,null,{default:o(()=>[t(p(B))]),_:1}),e[21]||(e[21]=A(" 搜索 "))]),_:1}),t(n,{class:"reset-button",onClick:ue},{default:o(()=>[t(u,null,{default:o(()=>[t(p(Pe))]),_:1}),e[22]||(e[22]=A(" 重置 "))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])],512),[[Me,S.value]])],2),v.value>0?(g(),C("div",mt,[i("span",null,[e[23]||(e[23]=A("共 ")),i("span",ft,I(v.value),1),e[24]||(e[24]=A(" 条主题"))]),m.value.length?(g(),C("span",gt,[e[25]||(e[25]=A(" 已选择 ")),i("span",vt,I(m.value.length),1),e[26]||(e[26]=A(" 项 "))])):J("",!0)])):J("",!0),i("div",yt,[c.value.length===0?(g(),C("div",_t,[t(xe,{"image-size":200,description:"暂无主题数据"},{image:o(()=>e[27]||(e[27]=[i("img",{class:"empty-icon",src:Je},null,-1)])),_:1})])):(g(),k(R,{key:1,gutter:80},{default:o(()=>[(g(!0),C(Ye,null,Be(c.value,s=>(g(),k(d,{key:s.id,lg:6,md:8,sm:12,xl:5,xs:24},{default:o(()=>[t(et,{"is-selected":m.value.some(w=>w.id===s.id),topic:s,onCopy:be,onDelete:ce,onDetail:ye,onEdit:w=>q("编辑主题",s,!1),onSelect:Te,onDoTopic:ve},null,8,["is-selected","topic","onEdit"])]),_:2},1024))),128))]),_:1}))]),i("div",bt,[t(Se,{"current-page":x.value,"onUpdate:currentPage":e[14]||(e[14]=s=>x.value=s),"page-size":E.value,"onUpdate:pageSize":e[15]||(e[15]=s=>E.value=s),background:!0,"page-sizes":[8,16,24,32],total:v.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:pe,onCurrentChange:de},null,8,["current-page","page-size","total"])]),t(Ze,{ref_key:"topicRef",ref:P},null,512),t(tt,{ref_key:"ImportExcelRef",ref:H},null,512)])}}}),qt=Ge(Tt,[["__scopeId","data-v-4229dc32"]]);export{qt as default};
