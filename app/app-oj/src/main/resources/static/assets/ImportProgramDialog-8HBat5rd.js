import{P as f}from"./ProblemSourceType-ColSuHcx.js";import{E as k}from"./EnumSelect-C2fXZs6G.js";import{U as D}from"./file-Cxx7VqTf.js";import{i as R}from"./problem-CJE_etNM.js";import{P as b}from"./ProblemType-TBlMUhPx.js";import{d as M,r as m,aB as N,o as O,x as B,k as a,a as y,j as l,y as U,u as G,W as c,f as i,_ as j}from"./index-DTkCE7MD.js";import"./upload-BtJOZC1L.js";const z={class:"dialog-footer"},A=M({name:"ImportOssDialog",__name:"ImportProgramDialog",emits:["success"],setup(F,{expose:v,emit:T}){const n=m(!1),p=m(),u=m(!1),d=m([]),o=N({fileUrl:"",problemSourceType:f.HOJ.code,needInsertUnExistTag:!0,problemType:b.PROGRAMMING.code}),_={fileUrl:[{required:!0,message:"请上传题目文件",trigger:"change"}],problemSourceType:[{required:!0,message:"请选择题目来源",trigger:"change"}]},x=t=>{d.value=t},V=t=>{t&&t.url?o.fileUrl=t.url:o.fileUrl=""},S=async()=>{p.value&&await p.value.validate(async t=>{if(t)try{u.value=!0;const e={fileUrl:o.fileUrl,problemSourceType:String(o.problemSourceType),needInsertUnExistTag:o.needInsertUnExistTag,problemType:o.problemType?String(o.problemType):void 0},s=await R(e);s.code==="0000"?(c.success("导入编程类题目成功"),I()):c.error(s.message||"导入失败")}catch(e){console.error("导入失败:",e),c.error("导入失败，请检查文件格式是否正确")}finally{u.value=!1}})},I=()=>{n.value=!1,E("success")},E=T;return v({open:()=>{n.value=!0,o.fileUrl="",o.problemSourceType=f.HOJ.code,o.needInsertUnExistTag=!0,o.problemType=b.PROGRAMMING.code,d.value=[]}}),(t,e)=>{const s=i("el-form-item"),P=i("el-switch"),w=i("el-form"),g=i("el-button"),C=i("el-dialog");return O(),B(C,{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=r=>n.value=r),title:"导入编程类题目",width:"500px","destroy-on-close":""},{footer:a(()=>[y("div",z,[l(g,{onClick:e[3]||(e[3]=r=>n.value=!1)},{default:a(()=>e[6]||(e[6]=[U("取消")])),_:1}),l(g,{type:"primary",onClick:S,loading:u.value},{default:a(()=>e[7]||(e[7]=[U(" 确认导入 ")])),_:1},8,["loading"])])]),default:a(()=>[l(w,{ref_key:"formRef",ref:p,model:o,rules:_,"label-width":"120px","label-position":"right"},{default:a(()=>[l(s,{label:"选择文件",prop:"fileUrl"},{default:a(()=>[l(D,{modelValue:o.fileUrl,"onUpdate:modelValue":e[0]||(e[0]=r=>o.fileUrl=r),accept:".json,.zip",limit:1,"file-size":500,"use-oss":!0,dir:"problem/import","file-list":d.value,"onUpdate:fileList":x,onChange:V},null,8,["modelValue","file-list"]),e[5]||(e[5]=y("div",{class:"upload-tip"}," 支持.json或.zip格式的编程类题目文件 ",-1))]),_:1}),l(s,{label:"题目来源",prop:"problemSourceType"},{default:a(()=>[l(k,{enumData:G(f),type:"select",modelValue:o.problemSourceType,"onUpdate:modelValue":e[1]||(e[1]=r=>o.problemSourceType=r)},null,8,["enumData","modelValue"])]),_:1}),l(s,{label:"标签处理",prop:"needInsertUnExistTag"},{default:a(()=>[l(P,{modelValue:o.needInsertUnExistTag,"onUpdate:modelValue":e[2]||(e[2]=r=>o.needInsertUnExistTag=r),"active-text":"自动创建不存在的标签","inactive-text":"忽略不存在的标签"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Q=j(A,[["__scopeId","data-v-bc260253"]]);export{Q as default};
