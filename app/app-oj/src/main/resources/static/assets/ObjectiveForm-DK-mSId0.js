import{d as ue,aB as F,r as R,b as me,w as ce,o as i,c as d,a as t,j as l,k as a,u as f,dt as j,P as k,Q as O,m as b,aH as fe,n as L,y as w,B as _e,W,f as C,t as B,x as M,a0 as Q,T as q,i as J,N as X,_ as Ve}from"./index-DTkCE7MD.js";import{M as be}from"./index-E5zgXN01.js";import{P as u}from"./ProblemType-TBlMUhPx.js";import"./style-DrPmFrlE.js";import"./upload-BtJOZC1L.js";import"./FileSaver.min-BnsyPtRb.js";const we={class:"options-container"},Ce={key:0,class:"menu-content"},ye={class:"menu-title"},ve={class:"menu-list"},ke=["onClick"],he=["onClick"],ge={class:"markdown-preview"},Be={class:"section-title"},$e=["id"],Ie=["onClick"],Le={class:"option-header-left"},Ee={class:"option-title"},Te={class:"option-header-right"},Oe={class:"option-content"},Ue={class:"option-form-row"},Ae={key:0,class:"option-warning"},Ke={key:1,class:"true-false-container"},Ne={class:"true-false-options"},Fe={class:"option-icon true-icon"},Me={class:"option-icon false-icon"},Se={class:"form-tip"},He={class:"section-title"},De={class:"fill-blank-actions"},ze=["id"],Ge=["onClick"],Pe={class:"option-header-left"},Re={class:"option-title"},je={class:"option-header-right"},We={class:"option-content"},Qe={class:"option-form-row"},qe=ue({name:"ObjectiveForm",__name:"ObjectiveForm",props:{modelValue:{}},emits:["update:modelValue","markdownMounted"],setup(Y,{emit:Z}){const p=Y,$=Z,y=F(p.modelValue.options||[]),m=F([]),x=R({description:!1,input:!1,output:!1,hint:!1}),_=F({}),ee=me(()=>p.modelValue.problemBo.problemType!==u.SINGLE_CHOICE.code?!1:y.filter(o=>o.answer).length>1),I=R(!1),S=()=>{p.modelValue.problemBo.problemType===u.FILL_BLANK.code&&p.modelValue.options&&p.modelValue.options.length>0&&(m.splice(0,m.length),p.modelValue.options.forEach(o=>{m.push({...o})}))};S(),ce(()=>p.modelValue.problemBo.problemType,o=>{o===u.FILL_BLANK.code&&S()});const oe=o=>{x.value[o]=!0,$("markdownMounted",o)},H=o=>{_[o]=!_[o]},E=o=>{const e=document.getElementById(o);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),_[o]=!0)},le=()=>{const o=y.length,e=`option-${o}`;y.push({optionKey:T(o),optionContent:"",score:p.modelValue.problemBo.problemType===u.SINGLE_CHOICE.code?10:5,answer:!1}),_[e]=!0,U(),setTimeout(()=>{E(e)},100)},T=o=>String.fromCharCode(65+o),te=(o,e)=>{ne(o,e),U()},ne=(o,e=!1)=>{p.modelValue.problemBo.problemType===u.SINGLE_CHOICE.code&&e&&y.forEach((c,h)=>{h!==o&&(c.answer=!1)})},se=o=>{y.splice(o,1),y.forEach((e,c)=>{e.optionKey=T(c)}),U()},ae=()=>{const o=m.length,e=`blank-${o}`;m.push({optionKey:`填空${o+1}`,optionContent:"",score:5,answer:!0}),_[e]=!0,A(),setTimeout(()=>{E(e)},100)},re=()=>{const e=(p.modelValue.problemBo.description||"").match(/_{3,}/g);if(!e||e.length===0){W.warning('未在题目描述中找到填空符号（连续的三个下划线"___"）');return}m.splice(0,m.length),e.forEach((c,h)=>{const v=`blank-${h}`;m.push({optionKey:`填空${h+1}`,optionContent:"",score:5,answer:!0}),_[v]=!0}),A(),W.success(`从题目描述中找到 ${e.length} 个填空，已自动添加`)},pe=o=>{m.splice(o,1),m.forEach((e,c)=>{e.optionKey=`填空${c+1}`}),A()},U=()=>{p.modelValue.options=[...y],$("update:modelValue",p.modelValue)},A=()=>{p.modelValue.problemBo.problemType===u.FILL_BLANK.code?(p.modelValue.options=[...m],p.modelValue.blanks=[]):ie(),$("update:modelValue",p.modelValue)},ie=()=>{p.modelValue.problemBo.problemType!==u.FILL_BLANK.code&&(p.modelValue.blanks=[...m]),$("update:modelValue",p.modelValue)},D=()=>{I.value=!I.value},z=o=>{p.modelValue.problemBo.answer=o,$("update:modelValue",p.modelValue)};return(o,e)=>{const c=C("el-icon"),h=C("el-card"),v=C("el-button"),K=C("el-tag"),g=C("el-input"),V=C("el-form-item"),G=C("el-input-number"),P=C("el-switch"),N=C("el-alert"),de=C("el-tooltip");return i(),d("div",we,[t("div",{class:L(["floating-menu",{"menu-collapsed":!I.value}])},[I.value?(i(),d("div",Ce,[t("div",ye,[e[6]||(e[6]=t("span",null,"选项导航",-1)),l(c,{class:"menu-close",onClick:D},{default:a(()=>[l(f(j))]),_:1})]),t("ul",ve,[o.modelValue.problemBo.problemType===f(u).SINGLE_CHOICE.code||o.modelValue.problemBo.problemType===f(u).MULTIPLE_CHOICE.code?(i(!0),d(k,{key:0},O(y,(n,s)=>(i(),d("li",{key:`option-${s}`,onClick:r=>E(`option-${s}`)}," 选项 "+B(T(s)),9,ke))),128)):b("",!0),o.modelValue.problemBo.problemType===f(u).FILL_BLANK.code?(i(!0),d(k,{key:1},O(m,(n,s)=>(i(),d("li",{key:`blank-${s}`,onClick:r=>E(`blank-${s}`)}," 填空 #"+B(s+1),9,he))),128)):b("",!0)])])):b("",!0),I.value?b("",!0):(i(),d("div",{key:1,class:"menu-toggle",onClick:D},[l(c,null,{default:a(()=>[l(f(fe))]),_:1})]))],2),l(h,{class:"problem-description-card"},{header:a(()=>e[7]||(e[7]=[t("div",{class:"card-header"},[t("span",null,"题目描述")],-1)])),default:a(()=>[t("div",ge,[l(be,{modelValue:o.modelValue.problemBo.description,"onUpdate:modelValue":e[0]||(e[0]=n=>o.modelValue.problemBo.description=n),readonly:!0,height:"auto",placeholder:"暂无题目描述",onMounted:e[1]||(e[1]=n=>oe("preview"))},null,8,["modelValue"])])]),_:1}),o.modelValue.problemBo.problemType===f(u).SINGLE_CHOICE.code||o.modelValue.problemBo.problemType===f(u).MULTIPLE_CHOICE.code?(i(),d(k,{key:0},[t("div",Be,[e[9]||(e[9]=t("h3",null,"选项设置",-1)),l(v,{type:"primary",onClick:le},{default:a(()=>e[8]||(e[8]=[w("添加选项")])),_:1})]),(i(!0),d(k,null,O(y,(n,s)=>(i(),d("div",{key:s,class:"option-item",id:`option-${s}`},[t("div",{class:"option-header",onClick:r=>H(`option-${s}`)},[t("div",Le,[l(K,{size:"small",effect:"plain"},{default:a(()=>[w(B(T(s)),1)]),_:2},1024),t("span",Ee,B(n.optionContent?n.optionContent.length>20?n.optionContent.substring(0,20)+"...":n.optionContent:"未设置内容"),1),n.answer?(i(),M(K,{key:0,type:"success",size:"small"},{default:a(()=>e[10]||(e[10]=[w("正确答案")])),_:1})):b("",!0)]),t("div",Te,[l(c,{class:L(_[`option-${s}`]?"el-icon-arrow-down":"el-icon-arrow-right")},{default:a(()=>[(i(),M(Q(_[`option-${s}`]?"ArrowDown":"ArrowRight")))]),_:2},1032,["class"]),l(v,{type:"danger",size:"small",onClick:q(r=>se(s),["stop"])},{default:a(()=>e[11]||(e[11]=[w("删除")])),_:2},1032,["onClick"])])],8,Ie),J(t("div",Oe,[t("div",Ue,[l(V,{label:"选项标识",prop:`options[${s}].optionKey`,class:"form-item-compact"},{default:a(()=>[l(g,{modelValue:n.optionKey,"onUpdate:modelValue":r=>n.optionKey=r,placeholder:"请填写选项标识，如A/B/C/D",disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),l(V,{label:"选项分值",prop:`options[${s}].score`,class:"form-item-compact"},{default:a(()=>[l(G,{modelValue:n.score,"onUpdate:modelValue":r=>n.score=r,min:0,precision:0,"controls-position":"right",controls:!1,style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),l(V,{label:"是否正确",prop:`options[${s}].answer`,class:"form-item-compact"},{default:a(()=>[l(P,{modelValue:n.answer,"onUpdate:modelValue":r=>n.answer=r,onChange:r=>te(s,r)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop"])]),l(V,{label:"选项内容",prop:`options[${s}].optionContent`},{default:a(()=>[l(g,{type:"textarea",modelValue:n.optionContent,"onUpdate:modelValue":r=>n.optionContent=r,placeholder:"请填写选项内容",rows:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])],512),[[X,_[`option-${s}`]]])],8,$e))),128)),o.modelValue.problemBo.problemType===f(u).SINGLE_CHOICE.code&&ee.value?(i(),d("div",Ae,[l(N,{title:"单选题只能有一个正确答案",type:"warning",closable:!1,"show-icon":""})])):b("",!0)],64)):b("",!0),o.modelValue.problemBo.problemType===f(u).TRUE_FALSE.code?(i(),d("div",Ke,[e[16]||(e[16]=t("h3",{class:"section-title-text"},"判断题答案设置",-1)),l(V,{label:"正确答案",prop:"problemBo.answer",class:"true-false-form-item"},{default:a(()=>[t("div",Ne,[t("div",{class:L(["true-false-option",{selected:o.modelValue.problemBo.answer===!0}]),onClick:e[2]||(e[2]=n=>z(!0))},[t("div",Fe,[l(c,null,{default:a(()=>[l(f(_e))]),_:1})]),e[12]||(e[12]=t("div",{class:"option-text"},"正确",-1))],2),t("div",{class:L(["true-false-option",{selected:o.modelValue.problemBo.answer===!1}]),onClick:e[3]||(e[3]=n=>z(!1))},[t("div",Me,[l(c,null,{default:a(()=>[l(f(j))]),_:1})]),e[13]||(e[13]=t("div",{class:"option-text"},"错误",-1))],2)])]),_:1}),t("div",Se,[l(N,{type:"info",closable:!1,"show-icon":""},{title:a(()=>e[14]||(e[14]=[t("span",null,"判断题提示",-1)])),default:a(()=>[e[15]||(e[15]=t("p",null,"请选择正确的答案选项。判断题的题干应该是一个陈述句，学生需要判断该陈述是正确还是错误。",-1))]),_:1})])])):b("",!0),o.modelValue.problemBo.problemType===f(u).FILL_BLANK.code?(i(),d(k,{key:2},[t("div",He,[e[19]||(e[19]=t("h3",null,"填空答案设置",-1)),t("div",De,[l(de,{content:"系统会自动从题目描述中识别连续的三个下划线作为填空，也可以手动添加",placement:"top"},{default:a(()=>[l(v,{type:"primary",onClick:ae},{default:a(()=>e[17]||(e[17]=[w("添加填空")])),_:1})]),_:1}),l(v,{type:"success",onClick:re},{default:a(()=>e[18]||(e[18]=[w("从题目描述自动识别")])),_:1})])]),l(N,{type:"info",closable:!1,"show-icon":"",class:"fill-blank-rules"},{title:a(()=>e[20]||(e[20]=[t("span",null,"填空规则说明：",-1)])),default:a(()=>[e[21]||(e[21]=t("p",null,[w("1. 在题目描述中使用连续三个或更多下划线"),t("code",null,"___"),w("表示填空位置")],-1)),e[22]||(e[22]=t("p",null,"2. 系统会自动识别这些下划线并创建对应数量的填空项",-1)),e[23]||(e[23]=t("p",null,"3. 您也可以手动添加填空项",-1))]),_:1}),(i(!0),d(k,null,O(m,(n,s)=>(i(),d("div",{key:s,class:"blank-item",id:`blank-${s}`},[t("div",{class:"option-header",onClick:r=>H(`blank-${s}`)},[t("div",Pe,[l(K,{size:"small",effect:"plain"},{default:a(()=>[w("填空 #"+B(s+1),1)]),_:2},1024),t("span",Re,B(n.optionContent?n.optionContent.length>20?n.optionContent.substring(0,20)+"...":n.optionContent:"未设置内容"),1)]),t("div",je,[l(c,{class:L(_[`blank-${s}`]?"el-icon-arrow-down":"el-icon-arrow-right")},{default:a(()=>[(i(),M(Q(_[`blank-${s}`]?"ArrowDown":"ArrowRight")))]),_:2},1032,["class"]),l(v,{type:"danger",size:"small",onClick:q(r=>pe(s),["stop"])},{default:a(()=>e[24]||(e[24]=[w("删除")])),_:2},1032,["onClick"])])],8,Ge),J(t("div",We,[t("div",Qe,[l(V,{label:"选项标识",prop:`blanks[${s}].optionKey`,class:"form-item-compact"},{default:a(()=>[l(g,{modelValue:n.optionKey,"onUpdate:modelValue":r=>n.optionKey=r,placeholder:"请填写选项标识",disabled:!0,style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),l(V,{label:"分值",prop:`blanks[${s}].score`,class:"form-item-compact"},{default:a(()=>[l(G,{modelValue:n.score,"onUpdate:modelValue":r=>n.score=r,min:0,precision:0,"controls-position":"right",controls:!1,style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),l(V,{label:"是否答案",prop:`blanks[${s}].answer`,class:"form-item-compact"},{default:a(()=>[l(P,{modelValue:n.answer,"onUpdate:modelValue":r=>n.answer=r,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),l(V,{label:"答案内容",prop:`blanks[${s}].answer`},{default:a(()=>[l(g,{modelValue:n.optionContent,"onUpdate:modelValue":r=>n.optionContent=r,placeholder:"请填写答案内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])],512),[[X,_[`blank-${s}`]]])],8,ze))),128))],64)):b("",!0),o.modelValue.problemBo.problemType===f(u).SHORT_ANSWER.code?(i(),d(k,{key:3},[l(V,{label:"参考答案",prop:"problemBo.referenceAnswer"},{default:a(()=>[l(g,{type:"textarea",modelValue:o.modelValue.problemBo.referenceAnswer,"onUpdate:modelValue":e[4]||(e[4]=n=>o.modelValue.problemBo.referenceAnswer=n),placeholder:"请填写参考答案",rows:6},null,8,["modelValue"])]),_:1}),l(V,{label:"评分标准",prop:"problemBo.gradingCriteria"},{default:a(()=>[l(g,{type:"textarea",modelValue:o.modelValue.problemBo.gradingCriteria,"onUpdate:modelValue":e[5]||(e[5]=n=>o.modelValue.problemBo.gradingCriteria=n),placeholder:"请填写评分标准",rows:4},null,8,["modelValue"])]),_:1})],64)):b("",!0)])}}}),oo=Ve(qe,[["__scopeId","data-v-c27a83ec"]]);export{oo as default};
