import{d as X,r as g,w as te,e as se,f as c,o as m,c as x,j as l,k as t,P as K,Q as j,x as U,u as f,F as q,y as N,t as B,a as r,J as re,m as A,bn as ne,a7 as ie,V as ue,_ as Z,b as H,a5 as de,aB as pe,B as me,dC as ce,T as fe,X as ve,aK as ge,C as _e,dS as he,ak as be,W as Q}from"./index-DTkCE7MD.js";import{U as J}from"./Img-CbqiKKTP.js";import{C as we}from"./ColorSelect-DZmuTeqD.js";import{g as W}from"./role-B65lK4x8.js";import{E as ye}from"./EnumSelect-C2fXZs6G.js";import{S as Ve}from"./Sex-CCT3w392.js";import"./upload-BtJOZC1L.js";const Me={class:"role-select"},xe={class:"empty-state"},$e={class:"role-option"},ke={class:"role-info"},Se={class:"role-header"},Ne={class:"role-name"},Ce={key:0,class:"role-permissions-container"},Ue={class:"permissions-tags"},De={class:"role-option"},Fe={class:"role-info"},Re={class:"role-header"},Te={class:"role-name"},Ie={key:0,class:"load-more-content"},Be={key:1,class:"load-more-content loading"},Ae=X({__name:"RoleSelect",props:{modelValue:{default:void 0},multiple:{type:Boolean,default:!1},placeholder:{default:"请选择角色"},clearable:{type:Boolean,default:!0},collapseTags:{type:Boolean,default:!1},collapseTagsTooltip:{type:Boolean,default:!0},frequentPermissionKeys:{default:()=>[]},maxRoleCount:{default:10}},emits:["update:modelValue","change"],setup(G,{emit:E}){const V=G,D=E,_=g(!1),v=g([]),h=g([]),a=g(V.modelValue??(V.multiple?[]:0)),F=g([]),Y=g(null),y=g(1),R=g(20),u=g(0),e=g(!1),i=g(""),M=s=>{if(!s.permissions||!V.frequentPermissionKeys.length)return!1;const o=s.permissions.toLowerCase();return V.frequentPermissionKeys.some(p=>o.includes(p.toLowerCase()))};te(()=>V.modelValue,s=>{s!==void 0?a.value=s:a.value=V.multiple?[]:0},{immediate:!0});const n=async s=>{i.value=s,y.value=1,_.value=!0;try{const o=await W({roleName:s||void 0,page:y.value,limit:R.value});v.value=o.data.rows||[],u.value=o.data.total||0,h.value=v.value.filter(p=>M(p)),e.value=v.value.length<u.value,console.log(`加载第${y.value}页, 共${u.value}条, 已加载${v.value.length}条, 常用角色${h.value.length}个`)}catch(o){console.error("获取角色列表失败:",o)}finally{_.value=!1}},b=async()=>{if(!(_.value||!e.value)){_.value=!0,y.value++;try{console.log(`开始加载第${y.value}页数据...`);const s=await W({roleName:i.value||void 0,page:y.value,limit:R.value});s.data.rows&&s.data.rows.length>0?(v.value=[...v.value,...s.data.rows],h.value=v.value.filter(o=>M(o)),console.log(`成功加载${s.data.rows.length}条新数据`)):console.log("未加载到新数据"),u.value=s.data.total||0,e.value=v.value.length<u.value,console.log(`当前共加载${v.value.length}/${u.value}条数据, 是否有更多: ${e.value}`)}catch(s){console.error("加载更多角色失败:",s),y.value--}finally{_.value=!1}}},$=()=>{ue(()=>{const s=document.querySelector(".el-select-dropdown.apple-select-dropdown");if(!s){console.error("找不到下拉框元素");return}s.addEventListener("scroll",o=>{const p=o.target,{scrollTop:w,scrollHeight:C,clientHeight:S}=p;C-w-S<30&&!_.value&&e.value&&(console.log("触发滚动加载"),b())}),console.log("已添加滚动事件监听")})},T=s=>{k(s),D("update:modelValue",s),D("change",s)},k=s=>{if(!s){F.value=[];return}const o=Array.isArray(s)?s:[s],p=[...v.value,...h.value];F.value=o.map(w=>p.find(S=>S.id===w)||{id:w,roleName:`角色${w}`,remark:"",delFlag:"",createTime:"",updateTime:""}).filter(Boolean)},I=s=>{s&&(n(""),setTimeout(()=>{$()},300))};return se(async()=>{_.value=!0;try{await n("")}catch(s){console.error("初始化角色选择器失败:",s)}finally{_.value=!1}}),(s,o)=>{const p=c("el-icon"),w=c("el-tag"),C=c("el-empty"),S=c("el-option"),L=c("el-option-group"),z=c("el-select");return m(),x("div",Me,[l(z,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value=d),multiple:s.multiple,"collapse-tags":!1,"max-collapse-tags":s.maxRoleCount,"collapse-tags-tooltip":s.collapseTagsTooltip,filterable:"",remote:"","remote-method":n,loading:_.value,placeholder:s.placeholder,clearable:s.clearable,class:"apple-select enhanced-role-select","popper-class":"apple-select-dropdown custom-role-select-dropdown",onChange:T,onVisibleChange:I},{tag:t(({closable:d,onClose:O})=>[(m(!0),x(K,null,j(F.value,P=>(m(),U(w,{key:P.id,closable:d,class:"custom-role-tag",type:"primary",effect:"light",onClose:O},{default:t(()=>[l(p,{class:"role-icon"},{default:t(()=>[l(f(q))]),_:1}),N(" "+B(P.roleName),1)]),_:2},1032,["closable","onClose"]))),128))]),empty:t(()=>[r("div",xe,[l(C,{description:"暂无匹配角色","image-size":60},{image:t(()=>[l(p,{class:"empty-icon"},{default:t(()=>[l(f(re))]),_:1})]),_:1})])]),default:t(()=>[h.value.length>0?(m(),U(L,{key:0,label:"常用角色"},{default:t(()=>[(m(!0),x(K,null,j(h.value,d=>(m(),U(S,{key:d.id,label:d.roleName,value:d.id},{default:t(()=>[r("div",$e,[r("div",ke,[r("div",Se,[l(p,{class:"role-icon-option"},{default:t(()=>[l(f(q))]),_:1}),r("span",Ne,B(d.roleName),1),l(w,{size:"small",type:"success",class:"frequent-tag"},{default:t(()=>o[1]||(o[1]=[N("常用")])),_:1})]),d.permissions?(m(),x("div",Ce,[r("div",Ue,[l(w,{size:"small",class:"permission-tag",type:"info",effect:"plain"},{default:t(()=>[N(B(d.permissions),1)]),_:2},1024)])])):A("",!0)])])]),_:2},1032,["label","value"]))),128))]),_:1})):A("",!0),v.value.length>0?(m(),U(L,{key:1,label:h.value.length?"所有角色":void 0},{default:t(()=>[(m(!0),x(K,null,j(v.value,d=>(m(),U(S,{key:d.id,label:d.roleName,value:d.id},{default:t(()=>[r("div",De,[r("div",Fe,[r("div",Re,[l(p,{class:"role-icon-option"},{default:t(()=>[l(f(q))]),_:1}),r("span",Te,B(d.roleName),1),o[2]||(o[2]=r("span",{class:"role-permissions"}," - ",-1)),l(w,{size:"small",class:"permission-tag",effect:"plain"},{default:t(()=>[N(B(d.permissions),1)]),_:2},1024)])])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["label"])):A("",!0),e.value?(m(),x("div",{key:2,class:"load-more-button",ref_key:"loadMoreRef",ref:Y,onClick:b},[_.value?(m(),x("div",Be,[l(p,{class:"is-loading"},{default:t(()=>[l(f(ie))]),_:1}),o[4]||(o[4]=r("span",null,"正在加载...",-1))])):(m(),x("div",Ie,[l(p,null,{default:t(()=>[l(f(ne))]),_:1}),o[3]||(o[3]=r("span",null,"加载更多角色",-1))]))],512)):A("",!0)]),_:1},8,["modelValue","multiple","max-collapse-tags","collapse-tags-tooltip","loading","placeholder","clearable"])])}}}),Le=Z(Ae,[["__scopeId","data-v-a28d5d1e"]]),Pe={class:"user-form-container"},qe={class:"test-actions"},Ee={class:"form-section"},Ye={class:"section-title"},ze={class:"form-grid"},Oe={class:"form-section"},Ke={class:"section-title"},je={class:"form-grid"},Ge={class:"role-select-container"},He={key:0,class:"permission-hint"},Qe={class:"form-section"},Je={class:"section-title"},We={class:"form-grid"},Xe={class:"form-section"},Ze={class:"section-title"},el={class:"form-grid stats-grid"},ll={class:"form-section"},ol={class:"section-title"},al={class:"form-grid"},tl={class:"dialog-footer"},sl=X({name:"UserInfoForm",__name:"UserInfoForm",setup(G,{expose:E}){const V=H({get:()=>a.value.row.color||"",set:u=>{a.value.row.color=u}}),D=de(),_=H(()=>{const u=D.authButtonListGet??[];return(D.authRoleListGet??[]).includes("admin")?!0:u.includes("sys.role.update_btn")}),v=pe({name:[{required:!0,message:"请填写姓名",trigger:"blur"}],phone:[{required:!0,message:"请填写手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"请填写邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}]}),h=g(!1),a=g({title:"",row:{groupIds:[],roleIds:[]},api:void 0,getTableList:void 0}),F=()=>{const u=["张三","李四","王五","赵六","钱七","孙八","周九","吴十"],e=["小张","小李","小王","小赵","小钱","小孙","小周","小吴"],i=["算法达人","编程高手","代码艺术家","系统架构师","全栈开发者","数据科学家","机器学习专家","前端大师"],M=["#007AFF","#FF3B30","#FF9500","#FFCC00","#34C759","#5AC8FA","#AF52DE","#FF2D92"],n=["example.com","test.com","demo.org","sample.net","mock.io"],b=["Male","Female"],$=u[Math.floor(Math.random()*u.length)],T=e[Math.floor(Math.random()*e.length)],k=i[Math.floor(Math.random()*i.length)],I=M[Math.floor(Math.random()*M.length)],s=n[Math.floor(Math.random()*n.length)],o=b[Math.floor(Math.random()*b.length)],p=Math.floor(Math.random()*7)+3,w=Math.floor(Math.random()*1e9).toString().padStart(9,"0"),C="1"+p+w,S=`${$.toLowerCase()}${Math.floor(Math.random()*999)}@${s}`,L=Math.floor(Math.random()*15)+1990,z=Math.floor(Math.random()*12)+1,d=Math.floor(Math.random()*28)+1,O=`${L}-${z.toString().padStart(2,"0")}-${d.toString().padStart(2,"0")}`,P=Math.floor(Math.random()*5)+2025,ee=Math.floor(Math.random()*12)+1,le=Math.floor(Math.random()*28)+1,oe=`${P}-${ee.toString().padStart(2,"0")}-${le.toString().padStart(2,"0")}`,ae={name:$,nickName:T,phone:C,email:S,sex:o,birthday:O,avatar:`https://i.pravatar.cc/150?u=${Math.random()}`,image:`https://picsum.photos/seed/${Math.random()}/300/200`,title:k,color:I,acNum:Math.floor(Math.random()*500)+1,integral:Math.floor(Math.random()*5e3)+100,continuousSignDay:Math.floor(Math.random()*100)+1,submitNum:Math.floor(Math.random()*1e3)+10,expirationTime:oe,remark:`这是${$}的测试账号，生成时间：${new Date().toLocaleString()}`,deptId:Math.floor(Math.random()*10)+1,groupIds:[],roleIds:[]};Object.assign(a.value.row,ae),Q.success("随机测试数据生成成功！")},Y=u=>{a.value=u,a.value.row.groupIds||(a.value.row.groupIds=[]),a.value.row.roleIds||(a.value.row.roleIds=[]);const e=a.value.row;e.roles&&Array.isArray(e.roles)&&e.roles.length>0&&(a.value.row.roleIds=e.roles.map(i=>i.id).filter(Boolean),delete e.roles),e.groups&&Array.isArray(e.groups)&&e.groups.length>0&&(a.value.row.groupIds=e.groups.map(i=>i.id).filter(Boolean),delete e.groups),h.value=!0},y=g(),R=()=>{y.value.validate(async u=>{if(u)try{await a.value.api(a.value.row),Q.success({message:`${a.value.title}成功！`}),a.value.getTableList(),h.value=!1}catch(e){console.log(e)}})};return E({acceptParams:Y}),(u,e)=>{const i=c("el-icon"),M=c("el-button"),n=c("el-form-item"),b=c("el-input"),$=c("el-date-picker"),T=c("el-text"),k=c("el-input-number"),I=c("el-form"),s=c("el-dialog");return m(),U(s,{modelValue:h.value,"onUpdate:modelValue":e[18]||(e[18]=o=>h.value=o),title:a.value.title,"destroy-on-close":!0,width:"650px",draggable:"",class:"apple-dialog"},{footer:t(()=>[r("div",tl,[l(M,{onClick:e[17]||(e[17]=o=>h.value=!1),class:"cancel-btn"},{default:t(()=>e[26]||(e[26]=[N(" 取消 ")])),_:1}),l(M,{type:"primary",onClick:R,class:"submit-btn"},{default:t(()=>[l(i,null,{default:t(()=>[l(f(me))]),_:1}),e[27]||(e[27]=N(" 确定 "))]),_:1})])]),default:t(()=>[r("div",Pe,[r("div",qe,[l(M,{type:"primary",size:"small",onClick:F,class:"test-btn"},{default:t(()=>[l(i,null,{default:t(()=>[l(f(ce))]),_:1}),e[19]||(e[19]=N(" 生成测试数据 "))]),_:1})]),l(I,{ref_key:"ruleFormRef",ref:y,"label-width":"90px","label-suffix":"",rules:v,model:a.value.row,onSubmit:fe(R,["prevent"]),class:"apple-form"},{default:t(()=>[r("div",Ee,[r("div",Ye,[l(i,null,{default:t(()=>[l(f(q))]),_:1}),e[20]||(e[20]=r("span",null,"基础信息",-1))]),r("div",ze,[l(n,{label:"头像",prop:"avatar",class:"avatar-item"},{default:t(()=>[l(J,{"image-url":a.value.row.avatar,"onUpdate:imageUrl":e[0]||(e[0]=o=>a.value.row.avatar=o),width:"60px",height:"60px",limit:1,"file-size":2,dir:"avatar",accept:"image/*",placeholder:"上传头像"},null,8,["image-url"])]),_:1}),l(n,{label:"姓名",prop:"name"},{default:t(()=>[l(b,{modelValue:a.value.row.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.row.name=o),placeholder:"请填写姓名",clearable:"",class:"apple-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"昵称",prop:"nickName"},{default:t(()=>[l(b,{modelValue:a.value.row.nickName,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.row.nickName=o),placeholder:"请填写昵称",clearable:"",class:"apple-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"手机号",prop:"phone"},{default:t(()=>[l(b,{modelValue:a.value.row.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.row.phone=o),placeholder:"请填写手机号",clearable:"",class:"apple-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"邮箱",prop:"email"},{default:t(()=>[l(b,{modelValue:a.value.row.email,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.row.email=o),placeholder:"请填写邮箱",clearable:"",class:"apple-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"性别",prop:"sex"},{default:t(()=>[l(ye,{modelValue:a.value.row.sex,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.row.sex=o),"enum-data":f(Ve),type:"select",placeholder:"请选择性别",class:"apple-enum-select"},null,8,["modelValue","enum-data"])]),_:1}),l(n,{label:"生日",prop:"birthday"},{default:t(()=>[l($,{modelValue:a.value.row.birthday,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.row.birthday=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择生日",clearable:"",class:"apple-date-picker"},null,8,["modelValue"])]),_:1})])]),r("div",Oe,[r("div",Ke,[l(i,null,{default:t(()=>[l(f(ve))]),_:1}),e[21]||(e[21]=r("span",null,"组织信息",-1))]),r("div",je,[l(n,{label:"角色",prop:"roleIds",class:"full-width"},{default:t(()=>[r("div",Ge,[l(Le,{modelValue:a.value.row.roleIds,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.row.roleIds=o),multiple:!0,disabled:!_.value,placeholder:"请选择角色",clearable:""},null,8,["modelValue","disabled"]),_.value?A("",!0):(m(),x("div",He,[l(T,{type:"info",size:"small"},{default:t(()=>[l(i,null,{default:t(()=>[l(f(ge))]),_:1}),e[22]||(e[22]=N(" 您没有修改用户角色的权限 "))]),_:1})]))])]),_:1})])]),r("div",Qe,[r("div",Je,[l(i,null,{default:t(()=>[l(f(_e))]),_:1}),e[23]||(e[23]=r("span",null,"个性化设置",-1))]),r("div",We,[l(n,{label:"称号",prop:"title"},{default:t(()=>[l(b,{modelValue:a.value.row.title,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.row.title=o),placeholder:"请填写称号",clearable:"",class:"apple-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"主题颜色",prop:"color"},{default:t(()=>[l(we,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o),"show-preview":!0,"preview-text":a.value.row.title||"预览文字"},null,8,["modelValue","preview-text"])]),_:1}),l(n,{label:"背景图片",prop:"image",class:"full-width"},{default:t(()=>[l(J,{"image-url":a.value.row.image,"onUpdate:imageUrl":e[10]||(e[10]=o=>a.value.row.image=o),width:"90px",height:"50px",limit:1,"file-size":5,dir:"user-bg",accept:"image/*",placeholder:"上传背景图片"},null,8,["image-url"])]),_:1})])]),r("div",Xe,[r("div",Ze,[l(i,null,{default:t(()=>[l(f(he))]),_:1}),e[24]||(e[24]=r("span",null,"统计信息",-1))]),r("div",el,[l(n,{label:"AC数量",prop:"acNum"},{default:t(()=>[l(k,{modelValue:a.value.row.acNum,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.row.acNum=o),precision:0,min:0,max:999999,"controls-position":"right",class:"apple-number-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"积分",prop:"integral"},{default:t(()=>[l(k,{modelValue:a.value.row.integral,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.row.integral=o),precision:0,min:0,max:999999,"controls-position":"right",class:"apple-number-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"连续签到",prop:"continuousSignDay"},{default:t(()=>[l(k,{modelValue:a.value.row.continuousSignDay,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.row.continuousSignDay=o),precision:0,min:0,max:999999,"controls-position":"right",class:"apple-number-input"},null,8,["modelValue"])]),_:1}),l(n,{label:"提交数量",prop:"submitNum"},{default:t(()=>[l(k,{modelValue:a.value.row.submitNum,"onUpdate:modelValue":e[14]||(e[14]=o=>a.value.row.submitNum=o),precision:0,min:0,max:999999,"controls-position":"right",class:"apple-number-input"},null,8,["modelValue"])]),_:1})])]),r("div",ll,[r("div",ol,[l(i,null,{default:t(()=>[l(f(be))]),_:1}),e[25]||(e[25]=r("span",null,"系统设置",-1))]),r("div",al,[l(n,{label:"过期时间",prop:"expirationTime"},{default:t(()=>[l($,{modelValue:a.value.row.expirationTime,"onUpdate:modelValue":e[15]||(e[15]=o=>a.value.row.expirationTime=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择帐号过期时间",clearable:"",class:"apple-date-picker"},null,8,["modelValue"])]),_:1}),l(n,{label:"备注",prop:"remark",class:"full-width"},{default:t(()=>[l(b,{modelValue:a.value.row.remark,"onUpdate:modelValue":e[16]||(e[16]=o=>a.value.row.remark=o),type:"textarea",rows:2,placeholder:"请填写备注信息",class:"apple-textarea"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["rules","model"])])]),_:1},8,["modelValue","title"])}}}),cl=Z(sl,[["__scopeId","data-v-2f27d0ab"]]);export{cl as default};
