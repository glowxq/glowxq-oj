import{d as G,r as d,f as D,g as J,o as r,c as U,j as k,k as o,i as f,x as p,u,a_ as A,y as s,a$ as E,D as W,b0 as X,aQ as Y,t as I,a as Z,z as ee,m as ae,b1 as te,V as L,_ as le}from"./index-DTkCE7MD.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{M as ie,g as oe,a as se,c as re,u as pe,r as T,e as de,i as ce}from"./MetaRegionForm-5FEpcwql.js";import{u as N}from"./useHandleData-BdxQ-8Ab.js";import{I as ue,u as fe,d as me}from"./common-DxSkM119.js";import"./sortable.esm-Cw1ESr5Y.js";const ge={class:"table-box"},ve=G({name:"MetaRegionView",__name:"index",setup(ye){const v=d(),S=[{type:"selection",width:80},{prop:"name",label:"地址名",width:400,align:"left"},{prop:"pinyin",label:"地址拼音",width:150},{prop:"level",label:"地址等级",width:100},{prop:"enable",label:"启用",width:80},{prop:"operation",label:"操作",fixed:"right"}],$=[{prop:"name",label:"地址名",el:"input"},{prop:"pinyin",label:"地址拼音",el:"input"},{prop:"level",label:"地址等级",el:"input"},{prop:"enable",label:"启用",el:"select",fieldNames:{label:"label",value:"value"},enum:[{label:"启用",value:!0},{label:"禁用",value:!1}]}],m=d([]),z=d(new Map),g=d(new Map),c=d([]),y=d(!1),h=d(!1),V=a=>{const e=new Map,t=new Map;a.forEach(n=>{e.set(n.id,n)}),a.forEach(n=>{const i=n.parentId||0;t.has(i)||t.set(i,[]),t.get(i).push(n)}),z.value=e,g.value=t},w=()=>(g.value.get(0)||[]).map(e=>({...e,hasChildren:g.value.has(e.id),expanded:!1,_originalData:e})),j=async(a,e,t)=>{try{m.value.length===0&&await x();const i=(g.value.get(a.id)||[]).map(l=>({...l,hasChildren:g.value.has(l.id),expanded:!1,_originalData:l}));await L(),t(i)}catch(n){console.error("加载子节点失败:",n),t([])}},B=(a,e)=>{if(e)c.value.includes(a.id)||c.value.push(a.id);else{const t=c.value.indexOf(a.id);t>-1&&c.value.splice(t,1)}},O=async()=>{if(y.value)c.value=[],y.value=!1;else{const a=[];for(const[t]of g.value.entries())t!==0&&a.push(t);const e=50;for(let t=0;t<a.length;t+=e){const n=a.slice(t,t+e);c.value.push(...n),await L()}y.value=!0}},b=async()=>{var a;c.value=[],y.value=!1,await x(),(a=v.value)==null||a.getTableList()},x=async()=>{if(!h.value)try{h.value=!0;const a=await oe();m.value=a.data||[],V(m.value)}catch(a){console.error("获取区域数据失败:",a),m.value=[]}finally{h.value=!1}},P=a=>!a||Object.keys(a).length===0?w():m.value.filter(t=>Object.entries(a).every(([n,i])=>{if(!i)return!0;const l=t[n];return typeof i=="string"?String(l||"").toLowerCase().includes(i.toLowerCase()):l===i})).map(t=>({...t,hasChildren:!1,expanded:!1,_originalData:t})),F=async a=>{try{m.value.length===0&&await x(),h.value&&await new Promise(n=>{const i=()=>{h.value?setTimeout(i,100):n(!0)};i()});let e;return a&&Object.values(a).some(n=>n!=null&&n!=="")?e=P(a):e=w(),console.log("返回数据:",e.length,"条根节点"),{data:e,total:e.length}}catch(e){return console.error("获取区域数据失败:",e),{data:[],total:0}}},R=d(),_=async(a,e={},t=!0)=>{var i;if(!t){const l=await se({id:e==null?void 0:e.id});e=l==null?void 0:l.data}const n={title:a,row:{...e},api:t?re:pe,getTableList:async()=>{var l;return await b(),(l=v.value)==null?void 0:l.getTableList()}};(i=R.value)==null||i.acceptParams(n)},H=async a=>{await N(T,{ids:[a.id]},`删除【${a.name}】区域地址`),b()},q=async a=>{var e;await N(T,{ids:a},"删除所选区域地址"),(e=v.value)==null||e.clearSelection(),b()},M=d(),K=()=>{var e;const a={title:"区域地址",templateName:"区域地址",tempApi:me,importApi:ce,getTableList:()=>{b()}};(e=M.value)==null||e.acceptParams(a)},Q=async()=>{var e;const a=((e=v.value)==null?void 0:e.searchParam)||{};fe(de,"区域地址",a)};return x(),(a,e)=>{const t=D("el-button"),n=D("el-tag"),i=J("auth");return r(),U("div",ge,[k(ne,{ref_key:"proTableRef",ref:v,title:"区域地址",indent:20,columns:S,"search-columns":$,"request-api":F,pagination:!1,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},load:j,lazy:"","expand-row-keys":c.value,onExpandChange:B},{tableHeader:o(l=>[f((r(),p(t,{type:"primary",icon:u(A),onClick:e[0]||(e[0]=C=>_("新增区域地址"))},{default:o(()=>e[1]||(e[1]=[s(" 新增 ")])),_:1},8,["icon"])),[[i,"meta.region.create"]]),f((r(),p(t,{type:"danger",icon:u(E),plain:"",disabled:!l.isSelected,onClick:C=>q(l.selectedListIds)},{default:o(()=>e[2]||(e[2]=[s(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[i,"meta.region.remove"]]),f((r(),p(t,{type:"primary",icon:u(W),plain:"",onClick:K},{default:o(()=>e[3]||(e[3]=[s(" 导入 ")])),_:1},8,["icon"])),[[i,"meta.region.import"]]),f((r(),p(t,{type:"primary",icon:u(X),plain:"",onClick:Q},{default:o(()=>e[4]||(e[4]=[s(" 导出 ")])),_:1},8,["icon"])),[[i,"meta.region.export"]]),k(t,{type:"info",icon:u(Y),plain:"",onClick:b},{default:o(()=>e[5]||(e[5]=[s(" 刷新 ")])),_:1},8,["icon"]),k(t,{type:"warning",plain:"",onClick:O},{default:o(()=>[s(I(y.value?"全部折叠":"全部展开"),1)]),_:1})]),name:o(({row:l})=>[Z("span",{style:ee({paddingLeft:(l.level||0)*10+"px"})},I(l.name),5),l.level===1?(r(),p(n,{key:0,type:"success",size:"small",class:"ml-2"},{default:o(()=>e[6]||(e[6]=[s("省")])),_:1})):l.level===2?(r(),p(n,{key:1,type:"warning",size:"small",class:"ml-2"},{default:o(()=>e[7]||(e[7]=[s("市")])),_:1})):l.level===3?(r(),p(n,{key:2,type:"info",size:"small",class:"ml-2"},{default:o(()=>e[8]||(e[8]=[s("区")])),_:1})):ae("",!0)]),operation:o(({row:l})=>[f((r(),p(t,{type:"primary",link:"",icon:u(A),onClick:C=>_("新增子区域",{parentId:l.id})},{default:o(()=>e[9]||(e[9]=[s(" 新增子级 ")])),_:2},1032,["icon","onClick"])),[[i,"meta.region.create"]]),f((r(),p(t,{type:"primary",link:"",icon:u(te),onClick:C=>_("编辑区域地址",l,!1)},{default:o(()=>e[10]||(e[10]=[s(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[i,"meta.region.update"]]),f((r(),p(t,{type:"primary",link:"",icon:u(E),onClick:C=>H(l)},{default:o(()=>e[11]||(e[11]=[s(" 删除 ")])),_:2},1032,["icon","onClick"])),[[i,"meta.region.remove"]])]),_:1},8,["expand-row-keys"]),k(ie,{ref_key:"metaRegionRef",ref:R},null,512),k(ue,{ref_key:"ImportExcelRef",ref:M},null,512)])}}}),we=le(ve,[["__scopeId","data-v-a4294eae"]]);export{we as default};
