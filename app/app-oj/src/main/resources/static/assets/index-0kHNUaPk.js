import{d as j,r as p,aB as q,e as Q,w as x,f as T,g as G,o as i,c as k,a as m,j as o,k as s,u,bp as K,y as g,P as U,Q as X,n as Y,er as Z,t as N,m as ee,i as b,x as y,a_ as ae,a$ as A,D as te,b0 as le,b1 as oe,W as re,_ as ne}from"./index-DTkCE7MD.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{a as ie,g as de,b as ce,c as ue,u as pe,r as E,i as me,e as ge}from"./metaTag-XZEJwT5o.js";import{g as fe}from"./metaTagCategory-DYsFMRBy.js";import{u as D}from"./useHandleData-BdxQ-8Ab.js";import ve from"./MetaTagForm-BzrrcbVP.js";import{I as be,d as ye,u as Ce}from"./common-DxSkM119.js";import"./sortable.esm-Cw1ESr5Y.js";import"./ColorSelect-DZmuTeqD.js";const _e={class:"main-box"},Te={class:"category-tree-container"},ke={class:"category-header"},he={class:"category-list"},Ie=["onClick"],xe={class:"item-content"},we={key:0,class:"item-count"},Pe={class:"table-box"},Me=j({name:"MetaTagView",__name:"index",setup(Le){const l=p(),C=q({}),f=p(-1),F=()=>{var a,e;f.value=-1,delete C.categoryId,(a=l.value)!=null&&a.searchParam&&(l.value.searchParam.categoryId=void 0),(e=l.value)==null||e.reset(),re.success("已重置分类筛选")},$=a=>{var e,t,r;f.value=a,a===-1?(delete C.categoryId,(e=l.value)!=null&&e.searchParam&&(l.value.searchParam.categoryId=void 0)):(C.categoryId=a,(t=l.value)!=null&&t.searchParam&&(l.value.searchParam.categoryId=a)),(r=l.value)==null||r.getTableList()},v=p([]),h=p({}),S=p(0),R=async()=>{try{const a=await fe({enable:"true",page:1,limit:100});if(a!=null&&a.data){v.value=a.data.rows||[],_();const e=I.find(t=>t.prop==="categoryId");e&&v.value.length>0&&(e.props={options:[{label:"全部",value:""},...v.value.map(t=>({label:t.name,value:t.id}))]})}}catch(a){console.error("获取标签分类失败",a)}},_=async()=>{try{const a=await ie();if(a!=null&&a.data){const e={};let t=0;a.data.forEach(r=>{r.categoryId!==void 0&&(e[r.categoryId]=r.count,t+=r.count)}),h.value=e,S.value=t}}catch(a){console.error("获取标签统计失败",a)}};Q(()=>{R(),f.value=-1,delete C.categoryId,setTimeout(()=>{var a;(a=l.value)!=null&&a.searchParam&&(l.value.searchParam.categoryId=void 0)},100)});const B=a=>a.plain?{color:a.backgroundColor||"#009688",borderColor:a.backgroundColor||"#009688",backgroundColor:"transparent",border:`1px solid ${a.backgroundColor||"#009688"}`}:{color:a.textColor||"#FFFFFF",backgroundColor:a.backgroundColor||"#009688",border:`1px solid ${a.backgroundColor||"#009688"}`},z=[{type:"selection",width:60},{prop:"name",label:"标签名字",minWidth:120,render:a=>o("div",{class:"tag-display",style:B(a.row)},[a.row.name])},{prop:"categoryId",label:"所属分类",width:120,render:a=>{const e=v.value.find(t=>Number(t.id)===Number(a.row.categoryId));return o("span",null,[e?e.name:"-"])}},{prop:"backgroundColor",label:"背景色",width:120,render:a=>o("div",{class:"color-display"},[o("div",{class:"color-block",style:{backgroundColor:a.row.backgroundColor}},null),o("span",null,[a.row.backgroundColor])])},{prop:"textColor",label:"字体颜色",width:120,render:a=>o("div",{class:"color-display"},[o("div",{class:"color-block",style:{backgroundColor:a.row.textColor}},null),o("span",null,[a.row.textColor])])},{prop:"plain",label:"镂空样式",width:100,render:a=>o(T("el-tag"),{type:"info",size:"small",effect:a.row.plain?"plain":"dark"},{default:()=>[a.row.plain?"是":"否"]})},{prop:"enable",label:"启用状态",width:100,render:a=>o(T("el-tag"),{type:a.row.enable?"success":"danger",size:"small"},{default:()=>[a.row.enable?"已启用":"已禁用"]})},{prop:"operation",label:"操作",width:150,fixed:"right"}],I=[{prop:"name",label:"标签名字",el:"input"},{prop:"enable",label:"启用状态",el:"select",props:{options:[{label:"全部",value:""},{label:"已启用",value:!0},{label:"已禁用",value:!1}]}},{prop:"plain",label:"镂空样式",el:"select",props:{options:[{label:"全部",value:""},{label:"是",value:!0},{label:"否",value:!1}]}}];x(()=>v.value,a=>{if(a.length>0){const e=I.find(t=>t.prop==="categoryId");e&&(e.props={options:[{label:"全部",value:""},...a.map(t=>({label:t.name,value:t.id}))]},l.value&&(l.value.searchParam={...l.value.searchParam}))}},{deep:!0,immediate:!0});const O=a=>{let e=w(a);return de(e)},w=a=>{let e=JSON.parse(JSON.stringify(a));return e.createTime&&(e.createTimeStart=e.createTime[0]),e.createTime&&(e.createTimeEnd=e.createTime[1]),delete e.createTime,e.updateTime&&(e.updateTimeStart=e.updateTime[0]),e.updateTime&&(e.updateTimeEnd=e.updateTime[1]),delete e.updateTime,e.categoryId===""||e.categoryId===void 0?delete e.categoryId:e.categoryId&&(e.categoryId=Number(e.categoryId)),f.value!==-1&&(e.categoryId=f.value),e},P=p(),M=async(a,e={},t=!0)=>{var d,n;if(!t){const c=await ce({id:e==null?void 0:e.id});e=c==null?void 0:c.data}const r={title:a,row:{...e},api:t?ue:pe,getTableList:(d=l.value)==null?void 0:d.getTableList};(n=P.value)==null||n.acceptParams(r)},V=async a=>{var e;await D(E,{ids:[a.id]},`删除【${a.name||a.id}】标签`),(e=l.value)==null||e.getTableList(),_()},H=async a=>{var e,t;await D(E,{ids:a},"删除所选标签"),(e=l.value)==null||e.clearSelection(),(t=l.value)==null||t.getTableList(),_()},L=p(),J=()=>{var e,t;const a={title:"标签",templateName:"标签",tempApi:ye,importApi:me,getTableList:(e=l.value)==null?void 0:e.getTableList};(t=L.value)==null||t.acceptParams(a)},W=async()=>{var e;let a=w((e=l.value)==null?void 0:e.searchParam);Ce(ge,"标签",a)};return x(()=>{var a;return(a=l.value)==null?void 0:a.tableData},()=>{_()},{deep:!0}),x(()=>{var a;return(a=l.value)==null?void 0:a.pageable},()=>{_()},{deep:!0}),(a,e)=>{const t=T("el-icon"),r=T("el-button"),d=G("auth");return i(),k("div",_e,[m("div",Te,[m("div",ke,[e[2]||(e[2]=m("h3",null,"标签分类",-1)),o(r,{class:"reset-button",type:"primary",text:"",size:"small",onClick:F},{default:s(()=>[o(t,null,{default:s(()=>[o(u(K))]),_:1}),e[1]||(e[1]=g(" 重置 "))]),_:1})]),m("div",he,[(i(!0),k(U,null,X(v.value,n=>(i(),k("div",{key:n.id,class:Y(["category-item",{active:f.value===Number(n.id)}]),onClick:c=>$(Number(n.id||0))},[m("div",xe,[o(t,null,{default:s(()=>[o(u(Z))]),_:1}),m("span",null,N(n.name),1)]),n.id!==void 0&&h.value[n.id]?(i(),k("span",we,N(h.value[n.id]),1)):ee("",!0)],10,Ie))),128))])]),m("div",Pe,[o(se,{ref_key:"proTableRef",ref:l,title:"标签",indent:20,columns:z,"search-columns":I,"request-api":O,"init-param":C,"row-key":"id"},{tableHeader:s(n=>[b((i(),y(r,{type:"primary",icon:u(ae),onClick:e[0]||(e[0]=c=>M("新增标签")),class:"primary-button"},{default:s(()=>e[3]||(e[3]=[g(" 新增 ")])),_:1},8,["icon"])),[[d,"meta.tag.create"]]),b((i(),y(r,{type:"danger",icon:u(A),plain:"",disabled:!n.isSelected,onClick:c=>H(n.selectedListIds)},{default:s(()=>e[4]||(e[4]=[g(" 批量删除 ")])),_:2},1032,["icon","disabled","onClick"])),[[d,"meta.tag.remove"]]),b((i(),y(r,{type:"primary",icon:u(te),plain:"",onClick:J},{default:s(()=>e[5]||(e[5]=[g(" 导入 ")])),_:1},8,["icon"])),[[d,"meta.tag.import"]]),b((i(),y(r,{type:"primary",icon:u(le),plain:"",onClick:W},{default:s(()=>e[6]||(e[6]=[g(" 导出 ")])),_:1},8,["icon"])),[[d,"meta.tag.export"]])]),operation:s(({row:n})=>[b((i(),y(r,{type:"primary",link:"",icon:u(oe),onClick:c=>M("编辑标签",n,!1)},{default:s(()=>e[7]||(e[7]=[g(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[d,"meta.tag.update"]]),b((i(),y(r,{type:"primary",link:"",icon:u(A),onClick:c=>V(n)},{default:s(()=>e[8]||(e[8]=[g(" 删除 ")])),_:2},1032,["icon","onClick"])),[[d,"meta.tag.remove"]])]),_:1},8,["init-param"]),o(ve,{ref_key:"metaTagRef",ref:P},null,512),o(be,{ref_key:"ImportExcelRef",ref:L},null,512)])])}}}),ze=ne(Me,[["__scopeId","data-v-0462c056"]]);export{ze as default};
