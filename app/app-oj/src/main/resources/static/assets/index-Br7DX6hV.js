import{d as z,r as m,bc as G,aG as k,b as K,f as h,g as W,o as i,c as Z,j as v,k as s,i as _,x as c,u as p,a_ as N,y as f,eo as J,a0 as X,m as w,en as E,b1 as Y,a$ as ee,ep as te,ef as ae,ax as L,em as q,W as g,aa as M,_ as ne}from"./index-DTkCE7MD.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-v8dVln4N.js";import{M as oe,g as se,a as ie,b as ue,e as ce,d as re,c as de,f as pe,h as F}from"./MenuForm-BLrCjXAi.js";import{u as me}from"./useHandleData-BdxQ-8Ab.js";import{_ as fe}from"./index.vue_vue_type_script_setup_true_lang-DXdJYPv-.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-BNLs1B-2.js";import"./EnumSelect-C2fXZs6G.js";import"./sortable.esm-Cw1ESr5Y.js";import"./index-BfHlaA6M.js";const _e={class:"table-box"},be=z({name:"MenuManage",__name:"index",setup(ve){const C=m(!1),S=m(""),D=m({}),V=G(),y=m(),B=t=>se(t),I=[{prop:"keywords",label:"关键字",el:"input"},{prop:"type",label:"菜单类型",el:"select",props:{placeholder:"请选择菜单类型"},enum:Object.values(k),fieldNames:{label:"name",value:"code"}}],T=m(!1),A=[{type:"index",label:"#"},{prop:"meta.title",width:200,label:"名称",align:"left"},{prop:"menuTypeCd",label:"类型",width:100,tag:!0,enum:V.getDictOptions("menu_type"),fieldNames:{label:"codeName",value:"id",tagType:"callbackShowStyle"}},{prop:"type",label:"菜单类型",width:120,formatter:t=>{const e=Object.values(k).find(a=>a.code===t.type);return(e==null?void 0:e.name)||"-"},tag:!0,enum:Object.values(k),fieldNames:{label:"name",value:"code",tagType:"success"}},{prop:"meta.icon",label:"图标",width:100},{prop:"sort",label:"排序",width:100},{prop:"name",label:"路由名称"},{prop:"path",label:"路由地址"},{prop:"component",label:"组件路径"},{prop:"useDataScope",label:"数据权限支持",width:100},{prop:"permissions",label:"权限",tag:!0,width:200},{prop:"operation",label:"操作",width:300,fixed:"right"}],b=m(!1),$=m(),x=async(t,e={},a=!0)=>{var u,r;let l={};if(a){let n=e.id||"0";const d=R(e,n);l={pid:n,icon:"",sort:d,type:k.ADMIN.code,menuTypeCd:e.menuTypeCd===L?q:e.menuTypeCd===q?E:L,isLink:"F",isHidden:"F",isFull:"F",isAffix:"F",isKeepAlive:"F"}}else{const{data:n}=await ie({id:e.id});if(!n){g.error({message:"获取菜单详情失败！"});return}l=n}const o={title:t,row:{...l},api:a?ue:ce,getTableList:(u=y.value)==null?void 0:u.getTableList};(r=$.value)==null||r.acceptParams(o)},R=(t={},e)=>{var l,o,u;let a;return e==0?a=((o=(l=y.value)==null?void 0:l.tableData)==null?void 0:o.length)||0:a=((u=t==null?void 0:t.children)==null?void 0:u.length)||0,(a+1)*100},U=async t=>{var e,a;await me(re,{ids:[t.id]},`删除【${(e=t==null?void 0:t.meta)==null?void 0:e.title}】菜单及以下菜单`),(a=y.value)==null||a.getTableList()},O=async(t={})=>{D.value=t;const{data:e}=await de({ids:[t.id]});C.value=!0,S.value=e},P=async(t={})=>{var e,a;try{const{value:l}=await M.prompt("请输入权限代码","生成权限按钮",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[a-zA-Z0-9_\.]+$/,inputErrorMessage:"权限代码格式不正确，只能包含字母、数字、下划线和点",inputPlaceholder:"例如：sys.menu.create_btn"});if(!l)return g.warning("权限代码不能为空");await M.confirm(`确定要为【${(e=t==null?void 0:t.meta)==null?void 0:e.title}】生成权限按钮吗？`,"温馨提示",{type:"warning"});const{data:o}=await pe({ids:[t.id],code:l});g.success("生成权限按钮成功"),(a=y.value)==null||a.getTableList()}catch(l){if(l==="cancel"||(l==null?void 0:l.type)==="cancel")return;console.error("生成权限按钮失败:",l),g.error("生成权限按钮失败")}},Q=K(()=>{var t,e;return"SQL ["+((e=(t=D.value)==null?void 0:t.meta)==null?void 0:e.title)+" ]"||"SQL []"}),j=()=>{var t;T.value=!T.value,(t=y.value)==null||t.refresh()},H=t=>{b.value=!0;const e=t.id,a=o=>{setTimeout(()=>{b.value=!1,g.success("切换数据权限成功"),o(!0)},200)},l=o=>{setTimeout(()=>{b.value=!1,o()},200)};return new Promise((o,u)=>{t.meta.useDataScope==="T"?M.confirm(`您确认要关闭菜单 [${t.meta.title}] 数据权限支持吗? 此操作有可能导致数据权限失效 ！！`,"温馨提示",{type:"warning"}).then(()=>{F({id:e}).then(()=>a(o)).catch(()=>l(u))}).catch(()=>{b.value=!1}):F({id:e}).then(()=>a(o)).catch(()=>l(u))})};return(t,e)=>{const a=h("el-button"),l=h("el-icon"),o=h("el-switch"),u=h("el-dialog"),r=W("auth");return i(),Z("div",_e,[v(le,{ref_key:"proTableRef",ref:y,title:"菜单列表","row-key":"id",indent:20,columns:A,"request-api":B,"search-columns":I,pagination:!1,"default-expand-all":T.value},{tableHeader:s(()=>[_((i(),c(a,{type:"primary",icon:p(N),onClick:e[0]||(e[0]=n=>x("新增菜单"))},{default:s(()=>e[2]||(e[2]=[f(" 新增菜单 ")])),_:1},8,["icon"])),[[r,"sys.menu.create_btn"]]),v(a,{type:"info",icon:p(J),onClick:j},{default:s(()=>e[3]||(e[3]=[f(" 展开/折叠 ")])),_:1},8,["icon"])]),icon:s(n=>[n.row.meta.icon?(i(),c(l,{key:0,size:18},{default:s(()=>[n.row.meta.icon.startsWith("svg-")?(i(),c(ye,{key:0,name:n.row.meta.icon.substring(4)},null,8,["name"])):(i(),c(X(n.row.meta.icon),{key:1}))]),_:2},1024)):w("",!0)]),useDataScope:s(n=>[n.row.menuTypeCd=="1002002"?(i(),c(o,{key:0,modelValue:n.row.meta.useDataScope,"onUpdate:modelValue":d=>n.row.meta.useDataScope=d,"active-value":"T","inactive-value":"F",loading:b.value,"before-change":()=>H(n.row)},null,8,["modelValue","onUpdate:modelValue","loading","before-change"])):w("",!0)]),operation:s(({row:n})=>[n.menuTypeCd!==p(E)?_((i(),c(a,{key:0,type:"primary",link:"",icon:p(N),onClick:d=>x("新增菜单",n)},{default:s(()=>e[4]||(e[4]=[f(" 新增 ")])),_:2},1032,["icon","onClick"])),[[r,"sys.menu.create_btn"]]):w("",!0),_((i(),c(a,{type:"primary",link:"",icon:p(Y),onClick:d=>x("编辑菜单",n,!1)},{default:s(()=>e[5]||(e[5]=[f(" 编辑 ")])),_:2},1032,["icon","onClick"])),[[r,"sys.menu.update_btn"]]),_((i(),c(a,{type:"primary",link:"",icon:p(ee),onClick:d=>U(n)},{default:s(()=>e[6]||(e[6]=[f(" 删除 ")])),_:2},1032,["icon","onClick"])),[[r,"sys.menu.delete_btn"]]),_((i(),c(a,{type:"primary",link:"",icon:p(te),onClick:d=>P(n)},{default:s(()=>e[7]||(e[7]=[f(" 生成权限 ")])),_:2},1032,["icon","onClick"])),[[r,"sys.menu.gen_btn"]]),_((i(),c(a,{type:"primary",link:"",icon:p(ae),onClick:d=>O(n)},{default:s(()=>e[8]||(e[8]=[f(" SQL ")])),_:2},1032,["icon","onClick"])),[[r,"sys.menu.sql_btn"]])]),_:1},8,["default-expand-all"]),v(oe,{ref_key:"menuFormRef",ref:$},null,512),v(u,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=n=>C.value=n),title:Q.value,width:"80%"},{default:s(()=>[v(fe,{code:S.value,language:"sql",title:"菜单SQL",class:"sql-box"},null,8,["code"])]),_:1},8,["modelValue","title"])])}}}),De=ne(be,[["__scopeId","data-v-94bb1e82"]]);export{De as default};
